/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, ViewEncapsulation } from '@angular/core';
import { Node } from '@alfresco/js-api';
import { Subject, of, zip } from 'rxjs';
import { NodesApiService, LogService, CardViewUpdateService, AlfrescoApiService, TranslationService, AppConfigService } from '@alfresco/adf-core';
import { ContentMetadataService } from '../../services/content-metadata.service';
import { takeUntil, debounceTime, catchError, map } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/content-metadata.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/material/expansion';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@angular/material/progress-bar';
import * as ɵngcc6 from '@angular/material/button';
import * as ɵngcc7 from '@ngx-translate/core';

function ContentMetadataComponent_mat_expansion_panel_2_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-expansion-panel", 5);
    ɵngcc0.ɵɵelementStart(1, "mat-expansion-panel-header");
    ɵngcc0.ɵɵelementStart(2, "mat-panel-title", 6);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "adf-card-view", 7);
    ɵngcc0.ɵɵlistener("keydown", function ContentMetadataComponent_mat_expansion_panel_2_Template_adf_card_view_keydown_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r3 = ɵngcc0.ɵɵnextContext(); return ctx_r3.keyDown($event); });
    ɵngcc0.ɵɵpipe(6, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("expanded", ctx_r0.canExpandProperties());
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-metadata-group-properties");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 9, "CORE.METADATA.BASIC.HEADER"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", ɵngcc0.ɵɵpipeBind1(6, 11, ctx_r0.basicProperties$))("editable", ctx_r0.editable)("displayEmpty", ctx_r0.displayEmpty)("copyToClipboardAction", ctx_r0.copyToClipboardAction)("useChipsForMultiValueProperty", ctx_r0.useChipsForMultiValueProperty)("multiValueSeparator", ctx_r0.multiValueSeparator);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-expansion-panel", 5);
    ɵngcc0.ɵɵelementStart(1, "mat-expansion-panel-header");
    ɵngcc0.ɵɵelementStart(2, "mat-panel-title");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "adf-card-view", 7);
    ɵngcc0.ɵɵlistener("keydown", function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template_adf_card_view_keydown_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(4); return ctx_r13.keyDown($event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext();
    const group_r10 = ctx_r15.$implicit;
    const first_r11 = ctx_r15.first;
    const ctx_r12 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("expanded", ctx_r12.canExpandTheCard(group_r10) || !ctx_r12.displayDefaultProperties && first_r11);
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-metadata-group-" + group_r10.title);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 9, group_r10.title), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", group_r10.properties)("editable", ctx_r12.editable)("displayEmpty", ctx_r12.displayEmpty)("copyToClipboardAction", ctx_r12.copyToClipboardAction)("useChipsForMultiValueProperty", ctx_r12.useChipsForMultiValueProperty)("multiValueSeparator", ctx_r12.multiValueSeparator);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 11);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template, 6, 11, "mat-expansion-panel", 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const group_r10 = ctx.$implicit;
    const ctx_r9 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r9.showGroup(group_r10) || ctx_r9.editable);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_div_1_Template, 2, 1, "div", 10);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const groupedProperties_r8 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", groupedProperties_r8);
} }
function ContentMetadataComponent_ng_container_3_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "mat-progress-bar", 12);
} }
function ContentMetadataComponent_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_Template, 2, 1, "ng-container", 8);
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵtemplate(3, ContentMetadataComponent_ng_container_3_ng_template_3_Template, 1, 0, "ng-template", null, 9, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const _r6 = ɵngcc0.ɵɵreference(4);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(2, 2, ctx_r1.groupedProperties$))("ngIfElse", _r6);
} }
function ContentMetadataComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    const _r17 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵelementStart(1, "button", 14);
    ɵngcc0.ɵɵlistener("click", function ContentMetadataComponent_div_4_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r17); const ctx_r16 = ɵngcc0.ɵɵnextContext(); return ctx_r16.cancelChanges(); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "button", 15);
    ɵngcc0.ɵɵlistener("click", function ContentMetadataComponent_div_4_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r17); const ctx_r18 = ɵngcc0.ɵɵnextContext(); return ctx_r18.saveChanges(); });
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r2.hasMetadataChanged);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, "CORE.METADATA.ACTIONS.CANCEL"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r2.hasMetadataChanged);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 6, "CORE.METADATA.ACTIONS.SAVE"), " ");
} }
export class ContentMetadataComponent {
    constructor(contentMetadataService, cardViewUpdateService, nodesApiService, logService, alfrescoApiService, translationService, appConfig) {
        this.contentMetadataService = contentMetadataService;
        this.cardViewUpdateService = cardViewUpdateService;
        this.nodesApiService = nodesApiService;
        this.logService = logService;
        this.alfrescoApiService = alfrescoApiService;
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.onDestroy$ = new Subject();
        this.editable = false;
        this.displayEmpty = false;
        this.expanded = false;
        this.multi = false;
        this.displayDefaultProperties = true;
        this.displayAspect = null;
        this.copyToClipboardAction = true;
        this.useChipsForMultiValueProperty = true;
        this.changedProperties = {};
        this.hasMetadataChanged = false;
        this.copyToClipboardAction = this.appConfig.get('content-metadata.copy-to-clipboard-action');
        this.multiValueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator') || ContentMetadataComponent.DEFAULT_SEPARATOR;
        this.useChipsForMultiValueProperty = this.appConfig.get('content-metadata.multi-value-chips');
    }
    ngOnInit() {
        this.cardViewUpdateService.itemUpdated$
            .pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((updatedNode) => {
            this.hasMetadataChanged = true;
            this.targetProperty = updatedNode.target;
            this.updateChanges(updatedNode.changed);
        });
        this.cardViewUpdateService.updatedAspect$.pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((node) => this.loadProperties(node));
        this.loadProperties(this.node);
    }
    handleUpdateError(error) {
        this.logService.error(error);
        let statusCode = 0;
        try {
            statusCode = JSON.parse(error.message).error.statusCode;
        }
        catch (_a) {
        }
        let message = `METADATA.ERRORS.${statusCode}`;
        if (this.translationService.instant(message) === message) {
            message = 'METADATA.ERRORS.GENERIC';
        }
        this.contentMetadataService.error.next({
            statusCode,
            message
        });
    }
    ngOnChanges(changes) {
        if (changes.node && !changes.node.firstChange) {
            this.loadProperties(changes.node.currentValue);
        }
    }
    loadProperties(node) {
        if (node) {
            this.basicProperties$ = this.getProperties(node);
            this.groupedProperties$ = this.contentMetadataService.getGroupedProperties(node, this.preset);
        }
    }
    getProperties(node) {
        const properties$ = this.contentMetadataService.getBasicProperties(node);
        const contentTypeProperty$ = this.contentMetadataService.getContentTypeProperty(node);
        return zip(properties$, contentTypeProperty$)
            .pipe(map(([properties, contentTypeProperty]) => {
            const filteredProperties = contentTypeProperty.filter((property) => properties.findIndex((baseProperty) => baseProperty.key === property.key) === -1);
            return [...properties, ...filteredProperties];
        }));
    }
    updateChanges(updatedNodeChanges) {
        Object.keys(updatedNodeChanges).map((propertyGroup) => {
            if (typeof updatedNodeChanges[propertyGroup] === 'object') {
                this.changedProperties[propertyGroup] = Object.assign(Object.assign({}, this.changedProperties[propertyGroup]), updatedNodeChanges[propertyGroup]);
            }
            else {
                this.changedProperties[propertyGroup] = updatedNodeChanges[propertyGroup];
            }
        });
    }
    saveChanges() {
        if (this.hasContentTypeChanged(this.changedProperties)) {
            this.contentMetadataService.openConfirmDialog(this.changedProperties).subscribe(() => {
                this.updateNode();
            });
        }
        else {
            this.updateNode();
        }
    }
    updateNode() {
        this.nodesApiService.updateNode(this.node.id, this.changedProperties).pipe(catchError((err) => {
            this.cardViewUpdateService.updateElement(this.targetProperty);
            this.handleUpdateError(err);
            return of(null);
        }))
            .subscribe((updatedNode) => {
            if (updatedNode) {
                if (this.hasContentTypeChanged(this.changedProperties)) {
                    this.cardViewUpdateService.updateNodeAspect(this.node);
                }
                this.revertChanges();
                Object.assign(this.node, updatedNode);
                this.alfrescoApiService.nodeUpdated.next(this.node);
            }
        });
    }
    hasContentTypeChanged(changedProperties) {
        return !!(changedProperties === null || changedProperties === void 0 ? void 0 : changedProperties.nodeType);
    }
    revertChanges() {
        this.changedProperties = {};
        this.hasMetadataChanged = false;
    }
    cancelChanges() {
        this.revertChanges();
        this.loadProperties(this.node);
    }
    showGroup(group) {
        const properties = group.properties.filter((property) => {
            return !this.isEmpty(property.displayValue);
        });
        return properties.length > 0;
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    canExpandTheCard(group) {
        return group.title === this.displayAspect;
    }
    canExpandProperties() {
        return !this.expanded || this.displayAspect === 'Properties';
    }
    keyDown(event) {
        if (event.keyCode === 37 || event.keyCode === 39) {
            event.stopPropagation();
        }
    }
    isEmpty(value) {
        return value === undefined || value === null || value === '';
    }
}
ContentMetadataComponent.ɵfac = function ContentMetadataComponent_Factory(t) { return new (t || ContentMetadataComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ContentMetadataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.CardViewUpdateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NodesApiService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LogService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AlfrescoApiService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AppConfigService)); };
ContentMetadataComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ContentMetadataComponent, selectors: [["adf-content-metadata"]], hostAttrs: [1, "adf-content-metadata"], inputs: { editable: "editable", displayEmpty: "displayEmpty", expanded: "expanded", multi: "multi", displayDefaultProperties: "displayDefaultProperties", displayAspect: "displayAspect", copyToClipboardAction: "copyToClipboardAction", useChipsForMultiValueProperty: "useChipsForMultiValueProperty", node: "node", preset: "preset" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 5, vars: 4, consts: [[1, "adf-metadata-properties"], ["displayMode", "flat", 3, "multi"], [3, "expanded", 4, "ngIf"], [4, "ngIf"], ["class", "adf-metadata-action-buttons", 4, "ngIf"], [3, "expanded"], ["role", "heading"], [3, "properties", "editable", "displayEmpty", "copyToClipboardAction", "useChipsForMultiValueProperty", "multiValueSeparator", "keydown"], [4, "ngIf", "ngIfElse"], ["loading", ""], ["class", "adf-metadata-grouped-properties-container", 4, "ngFor", "ngForOf"], [1, "adf-metadata-grouped-properties-container"], ["mode", "indeterminate"], [1, "adf-metadata-action-buttons"], ["mat-button", "", "data-automation-id", "reset-metadata", 3, "disabled", "click"], ["mat-raised-button", "", "color", "primary", "data-automation-id", "save-metadata", 3, "disabled", "click"]], template: function ContentMetadataComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "mat-accordion", 1);
        ɵngcc0.ɵɵtemplate(2, ContentMetadataComponent_mat_expansion_panel_2_Template, 7, 13, "mat-expansion-panel", 2);
        ɵngcc0.ɵɵtemplate(3, ContentMetadataComponent_ng_container_3_Template, 5, 4, "ng-container", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, ContentMetadataComponent_div_4_Template, 7, 8, "div", 4);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("multi", ctx.multi);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.displayDefaultProperties);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expanded);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.editable);
    } }, directives: [ɵngcc3.MatAccordion, ɵngcc4.NgIf, ɵngcc3.MatExpansionPanel, ɵngcc3.MatExpansionPanelHeader, ɵngcc3.MatExpansionPanelTitle, ɵngcc2.CardViewComponent, ɵngcc4.NgForOf, ɵngcc5.MatProgressBar, ɵngcc6.MatButton], pipes: [ɵngcc7.TranslatePipe, ɵngcc4.AsyncPipe], encapsulation: 2 });
ContentMetadataComponent.DEFAULT_SEPARATOR = ', ';
ContentMetadataComponent.ctorParameters = () => [
    { type: ContentMetadataService },
    { type: CardViewUpdateService },
    { type: NodesApiService },
    { type: LogService },
    { type: AlfrescoApiService },
    { type: TranslationService },
    { type: AppConfigService }
];
ContentMetadataComponent.propDecorators = {
    node: [{ type: Input }],
    editable: [{ type: Input }],
    displayEmpty: [{ type: Input }],
    expanded: [{ type: Input }],
    multi: [{ type: Input }],
    preset: [{ type: Input }],
    displayDefaultProperties: [{ type: Input }],
    displayAspect: [{ type: Input }],
    copyToClipboardAction: [{ type: Input }],
    useChipsForMultiValueProperty: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ContentMetadataComponent, [{
        type: Component,
        args: [{
                selector: 'adf-content-metadata',
                template: "<div class=\"adf-metadata-properties\">\n    <mat-accordion displayMode=\"flat\"\n                   [multi]=\"multi\">\n        <mat-expansion-panel *ngIf=\"displayDefaultProperties\"\n                             [expanded]=\"canExpandProperties()\"\n                             [attr.data-automation-id]=\"'adf-metadata-group-properties'\">\n            <mat-expansion-panel-header>\n                <mat-panel-title role=\"heading\">\n                    {{ 'CORE.METADATA.BASIC.HEADER' | translate }}\n                </mat-panel-title>\n            </mat-expansion-panel-header>\n            <adf-card-view\n                (keydown)=\"keyDown($event)\"\n                [properties]=\"basicProperties$ | async\"\n                [editable]=\"editable\"\n                [displayEmpty]=\"displayEmpty\"\n                [copyToClipboardAction]=\"copyToClipboardAction\"\n                [useChipsForMultiValueProperty]=\"useChipsForMultiValueProperty\"\n                [multiValueSeparator]=\"multiValueSeparator\">\n            </adf-card-view>\n        </mat-expansion-panel>\n\n        <ng-container *ngIf=\"expanded\">\n            <ng-container *ngIf=\"groupedProperties$ | async; else loading; let groupedProperties\">\n                <div *ngFor=\"let group of groupedProperties; let first = first;\"\n                     class=\"adf-metadata-grouped-properties-container\">\n                    <mat-expansion-panel *ngIf=\"showGroup(group) || editable\"\n                                         [attr.data-automation-id]=\"'adf-metadata-group-' + group.title\"\n                                         [expanded]=\"canExpandTheCard(group) || !displayDefaultProperties && first\">\n                        <mat-expansion-panel-header>\n                            <mat-panel-title>\n                                {{ group.title | translate }}\n                            </mat-panel-title>\n                        </mat-expansion-panel-header>\n\n                        <adf-card-view\n                            (keydown)=\"keyDown($event)\"\n                            [properties]=\"group.properties\"\n                            [editable]=\"editable\"\n                            [displayEmpty]=\"displayEmpty\"\n                            [copyToClipboardAction]=\"copyToClipboardAction\"\n                            [useChipsForMultiValueProperty]=\"useChipsForMultiValueProperty\"\n                            [multiValueSeparator]=\"multiValueSeparator\">\n                        </adf-card-view>\n                    </mat-expansion-panel>\n\n                </div>\n            </ng-container>\n            <ng-template #loading>\n                <mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>\n            </ng-template>\n        </ng-container>\n    </mat-accordion>\n\n    <div class=\"adf-metadata-action-buttons\"\n         *ngIf=\"editable\">\n        <button mat-button\n                (click)=\"cancelChanges()\"\n                data-automation-id=\"reset-metadata\"\n                [disabled]=\"!hasMetadataChanged\">\n                {{ 'CORE.METADATA.ACTIONS.CANCEL' | translate }}\n        </button>\n        <button mat-raised-button\n                (click)=\"saveChanges()\"\n                color=\"primary\"\n                data-automation-id=\"save-metadata\"\n                [disabled]=\"!hasMetadataChanged\">\n                {{ 'CORE.METADATA.ACTIONS.SAVE' | translate }}\n            </button>\n    </div>\n\n</div>\n",
                host: { 'class': 'adf-content-metadata' },
                encapsulation: ViewEncapsulation.None
            }]
    }], function () { return [{ type: ɵngcc1.ContentMetadataService }, { type: ɵngcc2.CardViewUpdateService }, { type: ɵngcc2.NodesApiService }, { type: ɵngcc2.LogService }, { type: ɵngcc2.AlfrescoApiService }, { type: ɵngcc2.TranslationService }, { type: ɵngcc2.AppConfigService }]; }, { editable: [{
            type: Input
        }], displayEmpty: [{
            type: Input
        }], expanded: [{
            type: Input
        }], multi: [{
            type: Input
        }], displayDefaultProperties: [{
            type: Input
        }], displayAspect: [{
            type: Input
        }], copyToClipboardAction: [{
            type: Input
        }], useChipsForMultiValueProperty: [{
            type: Input
        }], node: [{
            type: Input
        }], preset: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC1tZXRhZGF0YS5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy9saWIvY29udGVudC1tZXRhZGF0YS9jb21wb25lbnRzL2NvbnRlbnQtbWV0YWRhdGEvY29udGVudC1tZXRhZGF0YS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUErQyxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqSCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxFQUFjLE9BQU8sRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFFSCxlQUFlLEVBQ2YsVUFBVSxFQUNWLHFCQUFxQixFQUNyQixrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLGdCQUFnQixFQUduQixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRWpGLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUTFFLE1BQU0sT0FBTyx3QkFBd0I7QUFBRyxJ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QUdHLEtBQUs7QUFDUix1Q0FHRyxLQUFLO0FBQ1IsNEJBR0csS0FBSztBQUNSLG9DQUdHLEtBQUs7QUFDUiw0Q0FHRyxLQUFLO0FBQ1Q7Ozs7OytzRkFsRG1ELGtCQUNoRCxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsa0JBQ3pDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJLGNBQ3hDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBK0NFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YsIHppcCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgICBDYXJkVmlld0l0ZW0sXG4gICAgTm9kZXNBcGlTZXJ2aWNlLFxuICAgIExvZ1NlcnZpY2UsXG4gICAgQ2FyZFZpZXdVcGRhdGVTZXJ2aWNlLFxuICAgIEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICBUcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgQXBwQ29uZmlnU2VydmljZSxcbiAgICBDYXJkVmlld0Jhc2VJdGVtTW9kZWwsXG4gICAgVXBkYXRlTm90aWZpY2F0aW9uXG59IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBDb250ZW50TWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29udGVudC1tZXRhZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IENhcmRWaWV3R3JvdXAgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2NvbnRlbnQtbWV0YWRhdGEuaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwsIGRlYm91bmNlVGltZSwgY2F0Y2hFcnJvciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1jb250ZW50LW1ldGFkYXRhJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29udGVudC1tZXRhZGF0YS5jb21wb25lbnQuaHRtbCcsXG4gICAgaG9zdDogeyAnY2xhc3MnOiAnYWRmLWNvbnRlbnQtbWV0YWRhdGEnIH0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBDb250ZW50TWV0YWRhdGFDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIHN0YXRpYyBERUZBVUxUX1NFUEFSQVRPUiA9ICcsICc7XG5cbiAgICBwcm90ZWN0ZWQgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBUaGUgbm9kZSBlbnRpdHkgdG8gZmV0Y2ggbWV0YWRhdGEgYWJvdXQgKi9cbiAgICBASW5wdXQoKVxuICAgIG5vZGU6IE5vZGU7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRoZSBlZGl0IGJ1dHRvbiBzaG91bGQgYmUgc2hvd24gKi9cbiAgICBASW5wdXQoKVxuICAgIGVkaXRhYmxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRvIGRpc3BsYXkgZW1wdHkgdmFsdWVzIGluIHRoZSBjYXJkIHZpZXcgKi9cbiAgICBASW5wdXQoKVxuICAgIGRpc3BsYXlFbXB0eTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgYmV0d2VlbiBleHBhbmRlZCAoaWUsIGZ1bGwgaW5mb3JtYXRpb24pIGFuZCBjb2xsYXBzZWRcbiAgICAgKiAoaWUsIHJlZHVjZWQgaW5mb3JtYXRpb24pIGluIHRoZSBkaXNwbGF5XG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBleHBhbmRlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRoZSBtdWx0aSBwYXJhbWV0ZXIgb2YgdGhlIHVuZGVybHlpbmcgbWF0ZXJpYWwgZXhwYW5zaW9uIHBhbmVsLCBzZXQgdG8gdHJ1ZSB0byBhbGxvdyBtdWx0aSBhY2NvcmRpb24gdG8gYmUgZXhwYW5kZWQgYXQgdGhlIHNhbWUgdGltZSAqL1xuICAgIEBJbnB1dCgpXG4gICAgbXVsdGkgPSBmYWxzZTtcblxuICAgIC8qKiBOYW1lIG9mIHRoZSBtZXRhZGF0YSBwcmVzZXQsIHdoaWNoIGRlZmluZXMgYXNwZWN0cyBhbmQgdGhlaXIgcHJvcGVydGllcyAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJlc2V0OiBzdHJpbmc7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRoZSBtZXRhZGF0YSBwcm9wZXJ0aWVzIHNob3VsZCBiZSBzaG93biAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGlzcGxheURlZmF1bHRQcm9wZXJ0aWVzOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiAob3B0aW9uYWwpIHNob3dzIHRoZSBnaXZlbiBhc3BlY3QgaW4gdGhlIGV4cGFuZGVkICBjYXJkICovXG4gICAgQElucHV0KClcbiAgICBkaXNwbGF5QXNwZWN0OiBzdHJpbmcgPSBudWxsO1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciBvciBub3QgdG8gZW5hYmxlIGNvcHkgdG8gY2xpcGJvYXJkIGFjdGlvbi4gKi9cbiAgICBASW5wdXQoKVxuICAgIGNvcHlUb0NsaXBib2FyZEFjdGlvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIG9yIG5vdCB0byBlbmFibGUgY2hpcHMgZm9yIG11bHRpdmFsdWVkIHByb3BlcnRpZXMuICovXG4gICAgQElucHV0KClcbiAgICB1c2VDaGlwc0Zvck11bHRpVmFsdWVQcm9wZXJ0eTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBtdWx0aVZhbHVlU2VwYXJhdG9yOiBzdHJpbmc7XG4gICAgYmFzaWNQcm9wZXJ0aWVzJDogT2JzZXJ2YWJsZTxDYXJkVmlld0l0ZW1bXT47XG4gICAgZ3JvdXBlZFByb3BlcnRpZXMkOiBPYnNlcnZhYmxlPENhcmRWaWV3R3JvdXBbXT47XG5cbiAgICBjaGFuZ2VkUHJvcGVydGllcyA9IHt9O1xuICAgIGhhc01ldGFkYXRhQ2hhbmdlZCA9IGZhbHNlO1xuICAgIHByaXZhdGUgdGFyZ2V0UHJvcGVydHk6IENhcmRWaWV3QmFzZUl0ZW1Nb2RlbDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGNvbnRlbnRNZXRhZGF0YVNlcnZpY2U6IENvbnRlbnRNZXRhZGF0YVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY2FyZFZpZXdVcGRhdGVTZXJ2aWNlOiBDYXJkVmlld1VwZGF0ZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbm9kZXNBcGlTZXJ2aWNlOiBOb2Rlc0FwaVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5jb3B5VG9DbGlwYm9hcmRBY3Rpb24gPSB0aGlzLmFwcENvbmZpZy5nZXQ8Ym9vbGVhbj4oJ2NvbnRlbnQtbWV0YWRhdGEuY29weS10by1jbGlwYm9hcmQtYWN0aW9uJyk7XG4gICAgICAgIHRoaXMubXVsdGlWYWx1ZVNlcGFyYXRvciA9IHRoaXMuYXBwQ29uZmlnLmdldDxzdHJpbmc+KCdjb250ZW50LW1ldGFkYXRhLm11bHRpLXZhbHVlLXBpcGUtc2VwYXJhdG9yJykgfHwgQ29udGVudE1ldGFkYXRhQ29tcG9uZW50LkRFRkFVTFRfU0VQQVJBVE9SO1xuICAgICAgICB0aGlzLnVzZUNoaXBzRm9yTXVsdGlWYWx1ZVByb3BlcnR5ID0gdGhpcy5hcHBDb25maWcuZ2V0PGJvb2xlYW4+KCdjb250ZW50LW1ldGFkYXRhLm11bHRpLXZhbHVlLWNoaXBzJyk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuY2FyZFZpZXdVcGRhdGVTZXJ2aWNlLml0ZW1VcGRhdGVkJFxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDUwMCksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICh1cGRhdGVkTm9kZTogVXBkYXRlTm90aWZpY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzTWV0YWRhdGFDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHVwZGF0ZWROb2RlLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDaGFuZ2VzKHVwZGF0ZWROb2RlLmNoYW5nZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5jYXJkVmlld1VwZGF0ZVNlcnZpY2UudXBkYXRlZEFzcGVjdCQucGlwZShcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MDApLFxuICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChub2RlKSA9PiB0aGlzLmxvYWRQcm9wZXJ0aWVzKG5vZGUpKTtcblxuICAgICAgICB0aGlzLmxvYWRQcm9wZXJ0aWVzKHRoaXMubm9kZSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGhhbmRsZVVwZGF0ZUVycm9yKGVycm9yOiBFcnJvcikge1xuICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuXG4gICAgICAgIGxldCBzdGF0dXNDb2RlID0gMDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc3RhdHVzQ29kZSA9IEpTT04ucGFyc2UoZXJyb3IubWVzc2FnZSkuZXJyb3Iuc3RhdHVzQ29kZTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWVzc2FnZSA9IGBNRVRBREFUQS5FUlJPUlMuJHtzdGF0dXNDb2RlfWA7XG5cbiAgICAgICAgaWYgKHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQobWVzc2FnZSkgPT09IG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSAnTUVUQURBVEEuRVJST1JTLkdFTkVSSUMnO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb250ZW50TWV0YWRhdGFTZXJ2aWNlLmVycm9yLm5leHQoe1xuICAgICAgICAgICAgc3RhdHVzQ29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlcy5ub2RlICYmICFjaGFuZ2VzLm5vZGUuZmlyc3RDaGFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFByb3BlcnRpZXMoY2hhbmdlcy5ub2RlLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWRQcm9wZXJ0aWVzKG5vZGU6IE5vZGUpIHtcbiAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuYmFzaWNQcm9wZXJ0aWVzJCA9IHRoaXMuZ2V0UHJvcGVydGllcyhub2RlKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBlZFByb3BlcnRpZXMkID0gdGhpcy5jb250ZW50TWV0YWRhdGFTZXJ2aWNlLmdldEdyb3VwZWRQcm9wZXJ0aWVzKG5vZGUsIHRoaXMucHJlc2V0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UHJvcGVydGllcyhub2RlOiBOb2RlKSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMkID0gdGhpcy5jb250ZW50TWV0YWRhdGFTZXJ2aWNlLmdldEJhc2ljUHJvcGVydGllcyhub2RlKTtcbiAgICAgICAgY29uc3QgY29udGVudFR5cGVQcm9wZXJ0eSQgPSB0aGlzLmNvbnRlbnRNZXRhZGF0YVNlcnZpY2UuZ2V0Q29udGVudFR5cGVQcm9wZXJ0eShub2RlKTtcbiAgICAgICAgcmV0dXJuIHppcChwcm9wZXJ0aWVzJCwgY29udGVudFR5cGVQcm9wZXJ0eSQpXG4gICAgICAgICAgICAucGlwZShtYXAoKFtwcm9wZXJ0aWVzLCBjb250ZW50VHlwZVByb3BlcnR5XSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvcGVydGllcyA9IGNvbnRlbnRUeXBlUHJvcGVydHkuZmlsdGVyKChwcm9wZXJ0eSkgPT4gcHJvcGVydGllcy5maW5kSW5kZXgoKGJhc2VQcm9wZXJ0eSkgPT4gYmFzZVByb3BlcnR5LmtleSA9PT0gcHJvcGVydHkua2V5KSA9PT0gLTEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbLi4ucHJvcGVydGllcywgLi4uZmlsdGVyZWRQcm9wZXJ0aWVzXTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICB1cGRhdGVDaGFuZ2VzKHVwZGF0ZWROb2RlQ2hhbmdlcykge1xuICAgICAgICBPYmplY3Qua2V5cyh1cGRhdGVkTm9kZUNoYW5nZXMpLm1hcCgocHJvcGVydHlHcm91cDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVwZGF0ZWROb2RlQ2hhbmdlc1twcm9wZXJ0eUdyb3VwXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzW3Byb3BlcnR5R3JvdXBdID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNoYW5nZWRQcm9wZXJ0aWVzW3Byb3BlcnR5R3JvdXBdLFxuICAgICAgICAgICAgICAgICAgICAuLi51cGRhdGVkTm9kZUNoYW5nZXNbcHJvcGVydHlHcm91cF1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzW3Byb3BlcnR5R3JvdXBdID0gdXBkYXRlZE5vZGVDaGFuZ2VzW3Byb3BlcnR5R3JvdXBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzYXZlQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzQ29udGVudFR5cGVDaGFuZ2VkKHRoaXMuY2hhbmdlZFByb3BlcnRpZXMpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRNZXRhZGF0YVNlcnZpY2Uub3BlbkNvbmZpcm1EaWFsb2codGhpcy5jaGFuZ2VkUHJvcGVydGllcykuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU5vZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVOb2RlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZU5vZGUoKSB7XG4gICAgICAgIHRoaXMubm9kZXNBcGlTZXJ2aWNlLnVwZGF0ZU5vZGUodGhpcy5ub2RlLmlkLCB0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYXJkVmlld1VwZGF0ZVNlcnZpY2UudXBkYXRlRWxlbWVudCh0aGlzLnRhcmdldFByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVVwZGF0ZUVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh1cGRhdGVkTm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1cGRhdGVkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNDb250ZW50VHlwZUNoYW5nZWQodGhpcy5jaGFuZ2VkUHJvcGVydGllcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FyZFZpZXdVcGRhdGVTZXJ2aWNlLnVwZGF0ZU5vZGVBc3BlY3QodGhpcy5ub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJldmVydENoYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLm5vZGUsIHVwZGF0ZWROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGZyZXNjb0FwaVNlcnZpY2Uubm9kZVVwZGF0ZWQubmV4dCh0aGlzLm5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFzQ29udGVudFR5cGVDaGFuZ2VkKGNoYW5nZWRQcm9wZXJ0aWVzKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhIWNoYW5nZWRQcm9wZXJ0aWVzPy5ub2RlVHlwZTtcbiAgICB9XG5cbiAgICByZXZlcnRDaGFuZ2VzKCkge1xuICAgICAgICB0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzID0ge307XG4gICAgICAgIHRoaXMuaGFzTWV0YWRhdGFDaGFuZ2VkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgY2FuY2VsQ2hhbmdlcygpIHtcbiAgICAgICAgdGhpcy5yZXZlcnRDaGFuZ2VzKCk7XG4gICAgICAgIHRoaXMubG9hZFByb3BlcnRpZXModGhpcy5ub2RlKTtcbiAgICB9XG5cbiAgICBzaG93R3JvdXAoZ3JvdXA6IENhcmRWaWV3R3JvdXApOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IGdyb3VwLnByb3BlcnRpZXMuZmlsdGVyKChwcm9wZXJ0eSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzRW1wdHkocHJvcGVydHkuZGlzcGxheVZhbHVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5FeHBhbmRUaGVDYXJkKGdyb3VwOiBDYXJkVmlld0dyb3VwKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBncm91cC50aXRsZSA9PT0gdGhpcy5kaXNwbGF5QXNwZWN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5FeHBhbmRQcm9wZXJ0aWVzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXRoaXMuZXhwYW5kZWQgfHwgdGhpcy5kaXNwbGF5QXNwZWN0ID09PSAnUHJvcGVydGllcyc7XG4gICAgfVxuXG4gICAga2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzcgfHwgZXZlbnQua2V5Q29kZSA9PT0gMzkpIHsgLy8gQXJyb3dMZWZ0ICYmIEFycm93UmlnaHRcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0VtcHR5KHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICcnO1xuICAgIH1cbn1cbiJdfQ==