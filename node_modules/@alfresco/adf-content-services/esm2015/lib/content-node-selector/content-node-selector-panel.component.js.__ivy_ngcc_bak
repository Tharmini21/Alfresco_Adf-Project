/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation, Inject } from '@angular/core';
import { HighlightDirective, UserPreferencesService, UserPreferenceValues, InfinitePaginationComponent, NodesApiService, SitesService, UploadService, AppConfigService, ShowHeaderMode } from '@alfresco/adf-core';
import { FormControl } from '@angular/forms';
import { Pagination, SiteEntry, SitePaging } from '@alfresco/js-api';
import { DocumentListComponent } from '../document-list/components/document-list.component';
import { debounceTime, takeUntil } from 'rxjs/operators';
import { CustomResourcesService } from '../document-list/services/custom-resources.service';
import { Subject } from 'rxjs';
import { SEARCH_QUERY_SERVICE_TOKEN } from '../search/search-query-service.token';
import { SearchQueryBuilderService } from '../search/services/search-query-builder.service';
import { ContentNodeSelectorPanelService } from './content-node-selector-panel.service';
export const defaultValidation = () => true;
export class ContentNodeSelectorPanelComponent {
    constructor(customResourcesService, queryBuilderService, userPreferencesService, nodesApiService, uploadService, sitesService, appConfigService, contentNodeSelectorPanelService) {
        this.customResourcesService = customResourcesService;
        this.queryBuilderService = queryBuilderService;
        this.userPreferencesService = userPreferencesService;
        this.nodesApiService = nodesApiService;
        this.uploadService = uploadService;
        this.sitesService = sitesService;
        this.appConfigService = appConfigService;
        this.contentNodeSelectorPanelService = contentNodeSelectorPanelService;
        this.DEFAULT_PAGINATION = new Pagination({
            maxItems: 25,
            skipCount: 0
        });
        this.showSiteList = true;
        this.showSearchField = true;
        this.showCounter = false;
        this.restrictRootToCurrentFolderId = false;
        this.currentFolderId = null;
        this.dropdownHideMyFiles = false;
        this.dropdownSiteList = null;
        this._rowFilter = defaultValidation;
        this._excludeSiteContent = [];
        this.imageResolver = null;
        this.pageSize = this.DEFAULT_PAGINATION.maxItems;
        this.selectionMode = 'single';
        this.isSelectionValid = defaultValidation;
        this.select = new EventEmitter();
        this.navigationChange = new EventEmitter();
        this.siteChange = new EventEmitter();
        this.showingSearch = new EventEmitter();
        this.currentFolder = new EventEmitter();
        this.folderLoaded = new EventEmitter();
        this.nodePaging = null;
        this.searchTerm = '';
        this.showingSearchResults = false;
        this.loadingSearchResults = false;
        this.inDialog = false;
        this._chosenNode = null;
        this.folderIdToShow = null;
        this.breadcrumbFolderTitle = null;
        this.startSiteGuid = null;
        this.hasValidQuery = false;
        this.showHeader = ShowHeaderMode.Never;
        this.infiniteScroll = false;
        this.debounceSearch = 200;
        this.searchInput = new FormControl();
        this.preselectedNodes = [];
        this.currentUploadBatch = [];
        this.searchPanelExpanded = false;
        this.onDestroy$ = new Subject();
    }
    set rowFilter(rowFilter) {
        this.createRowFilter(rowFilter);
    }
    get rowFilter() {
        return this._rowFilter;
    }
    set excludeSiteContent(excludeSiteContent) {
        this._excludeSiteContent = excludeSiteContent;
        this.createRowFilter(this._rowFilter);
    }
    get excludeSiteContent() {
        return this._excludeSiteContent;
    }
    set showSearch(value) {
        if (value !== undefined && value !== null) {
            this.showSearchField = value;
        }
    }
    get showSearch() {
        return this.showSearchField;
    }
    set showDropdownSiteList(value) {
        if (value !== undefined && value !== null) {
            this.showSiteList = value;
        }
    }
    get showDropdownSiteList() {
        return this.showSiteList;
    }
    set showFilesInResult(value) {
        if (value !== undefined && value !== null) {
            const showFilesQuery = `TYPE:'cm:folder'${value ? " OR TYPE:'cm:content'" : ''}`;
            this.queryBuilderService.addFilterQuery(showFilesQuery);
        }
    }
    set showNodeCounter(value) {
        this.showCounter = value !== null && value !== void 0 ? value : false;
    }
    get showNodeCounter() {
        return this.showCounter;
    }
    set chosenNode(value) {
        this._chosenNode = value;
        this.select.next(value);
    }
    get chosenNode() {
        return this._chosenNode;
    }
    getSelectedCount() {
        var _a;
        return ((_a = this.chosenNode) === null || _a === void 0 ? void 0 : _a.length) || 0;
    }
    ngOnInit() {
        this.searchInput.valueChanges
            .pipe(debounceTime(this.debounceSearch), takeUntil(this.onDestroy$))
            .subscribe((searchValue) => {
            this.searchTerm = searchValue;
            this.queryBuilderService.userQuery = searchValue.length > 0 ? `${searchValue}*` : searchValue;
            this.queryBuilderService.update();
        });
        this.queryBuilderService.updated
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((queryBody) => {
            if (queryBody) {
                this.hasValidQuery = true;
                this.prepareDialogForNewSearch(queryBody);
                this.queryBuilderService.execute(queryBody);
            }
            else {
                this.hasValidQuery = false;
                this.resetFolderToShow();
                this.clearSearch();
            }
        });
        this.queryBuilderService.executed
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((results) => {
            if (this.hasValidQuery) {
                this.showSearchResults(results);
            }
        });
        this.userPreferencesService
            .select(UserPreferenceValues.PaginationSize)
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(pagSize => this.pageSize = pagSize);
        this.target = this.documentList;
        this.folderIdToShow = this.currentFolderId;
        if (this.currentFolderId) {
            if (this.restrictRootToCurrentFolderId) {
                this.breadcrumbRootId = this.currentFolderId;
                this.siteId = this.currentFolderId;
            }
            else {
                this.getStartSite();
            }
        }
        this.breadcrumbTransform = this.breadcrumbTransform ? this.breadcrumbTransform : null;
        this.isSelectionValid = this.isSelectionValid ? this.isSelectionValid : defaultValidation;
        this.onFileUploadEvent();
        this.onFileUploadDeletedEvent();
        this.resetPagination();
        this.setSearchScopeToNodes();
        this.documentList.$folderNode
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((currentNode) => {
            this.currentFolder.emit(currentNode);
        });
        this.sorting = this.appConfigService.get('adf-content-node-selector.sorting', ['createdAt', 'desc']);
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    toggleSearchPanel() {
        this.searchPanelExpanded = !this.searchPanelExpanded;
    }
    hasCustomModels() {
        var _a, _b;
        return ((_b = (_a = this.contentNodeSelectorPanelService) === null || _a === void 0 ? void 0 : _a.customModels) === null || _b === void 0 ? void 0 : _b.length) > 0;
    }
    onFileUploadEvent() {
        this.uploadService.fileUploadComplete
            .pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((fileUploadEvent) => {
            this.currentUploadBatch.push(fileUploadEvent.data);
            if (!this.uploadService.isUploading()) {
                this.preselectedNodes = this.getPreselectNodesBasedOnSelectionMode();
                this.currentUploadBatch = [];
                this.documentList.reloadWithoutResettingSelection();
            }
        });
    }
    onFileUploadDeletedEvent() {
        this.uploadService.fileUploadDeleted
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((deletedFileEvent) => {
            this.documentList.unselectRowFromNodeId(deletedFileEvent.file.data.entry.id);
            this.documentList.reloadWithoutResettingSelection();
        });
    }
    getStartSite() {
        this.nodesApiService.getNode(this.currentFolderId).subscribe((startNodeEntry) => {
            this.startSiteGuid = this.sitesService.getSiteNameFromNodePath(startNodeEntry);
            if (this.startSiteGuid) {
                this.sitesService.getSite(this.startSiteGuid).subscribe((startSiteEntry) => {
                    if (startSiteEntry instanceof SiteEntry) {
                        this.siteChange.emit(startSiteEntry.entry.title);
                    }
                });
            }
        });
    }
    createRowFilter(filter) {
        if (!filter) {
            filter = () => true;
        }
        this._rowFilter = (value, index, array) => {
            return filter(value, index, array) &&
                !this.isExcludedSiteContent(value);
        };
    }
    isExcludedSiteContent(row) {
        const entry = row.node.entry;
        if (this._excludeSiteContent && this._excludeSiteContent.length &&
            entry &&
            entry.properties &&
            entry.properties['st:componentId']) {
            const excludedItem = this._excludeSiteContent.find((id) => entry.properties['st:componentId'] === id);
            return !!excludedItem;
        }
        return false;
    }
    siteChanged(chosenSite) {
        this.siteId = chosenSite.entry.guid;
        this.setTitleIfCustomSite(chosenSite);
        this.siteChange.emit(chosenSite.entry.title);
        this.queryBuilderService.update();
    }
    get breadcrumbFolderNode() {
        let folderNode;
        if (this.showingSearchResults && this.chosenNode) {
            folderNode = this.chosenNode[0];
        }
        else {
            folderNode = this.documentList.folderNode;
        }
        return folderNode;
    }
    prepareDialogForNewSearch(queryBody) {
        this.target = queryBody ? null : this.documentList;
        if (this.target) {
            this.infinitePaginationComponent.reset();
        }
        this.folderIdToShow = null;
        this.preselectedNodes = [];
        this.loadingSearchResults = true;
        this.addCorrespondingNodeIdsQuery();
        this.resetChosenNode();
    }
    clear() {
        this.searchTerm = '';
        this.queryBuilderService.userQuery = '';
        this.queryBuilderService.update();
    }
    resetFolderToShow() {
        this.folderIdToShow = this.siteId || this.currentFolderId;
    }
    clearSearch() {
        this.searchTerm = '';
        this.nodePaging = null;
        this.resetPagination();
        this.resetChosenNode();
        this.showingSearchResults = false;
        this.showingSearch.emit(this.showingSearchResults);
    }
    addCorrespondingNodeIdsQuery() {
        let extraParentFiltering = '';
        if (this.customResourcesService.hasCorrespondingNodeIds(this.siteId)) {
            this.customResourcesService.getCorrespondingNodeIds(this.siteId)
                .subscribe((nodeIds) => {
                if (nodeIds && nodeIds.length) {
                    nodeIds
                        .filter((id) => id !== this.siteId)
                        .forEach((extraId) => {
                        extraParentFiltering += ` OR ANCESTOR:'workspace://SpacesStore/${extraId}'`;
                    });
                }
                const parentFiltering = this.siteId ? `ANCESTOR:'workspace://SpacesStore/${this.siteId}'${extraParentFiltering}` : '';
                this.queryBuilderService.addFilterQuery(parentFiltering);
            });
        }
        else {
            const parentFiltering = this.siteId ? `ANCESTOR:'workspace://SpacesStore/${this.siteId}'` : '';
            this.queryBuilderService.addFilterQuery(parentFiltering);
        }
    }
    setSearchScopeToNodes() {
        const scope = {
            locations: 'nodes'
        };
        this.queryBuilderService.setScope(scope);
    }
    showSearchResults(results) {
        this.showingSearchResults = true;
        this.loadingSearchResults = false;
        this.showingSearch.emit(this.showingSearchResults);
        this.nodePaging = results;
    }
    onFolderChange($event) {
        this.folderIdToShow = $event.value.id;
        this.showingSearchResults = false;
        this.infiniteScroll = false;
        this.breadcrumbFolderTitle = null;
        this.preselectedNodes = [];
        this.clearSearch();
        this.navigationChange.emit($event);
    }
    onFolderLoaded(nodePaging) {
        this.updatePaginationAfterRowFilter(nodePaging);
        if (!this.showingSearchResults) {
            this.attemptNodeSelection(this.documentList.folderNode);
        }
        this.folderLoaded.emit();
    }
    updatePaginationAfterRowFilter(nodePaging) {
        if (this.documentList.data.getRows().length < nodePaging.list.pagination.maxItems) {
            nodePaging.list.pagination.hasMoreItems = false;
        }
    }
    showBreadcrumbs() {
        return !this.showingSearchResults || this.chosenNode;
    }
    getNextPageOfSearch(pagination) {
        this.infiniteScroll = true;
        this.queryBuilderService.paging.maxItems = pagination.maxItems;
        this.queryBuilderService.paging.skipCount = pagination.skipCount;
        if (this.searchTerm.length > 0) {
            this.queryBuilderService.update();
        }
    }
    attemptNodeSelection(entry) {
        if (entry && this.isSelectionValid(entry)) {
            this.chosenNode = [entry];
        }
    }
    resetChosenNode() {
        this.chosenNode = null;
    }
    onCurrentSelection(nodesEntries) {
        const validNodesEntity = nodesEntries.filter((node) => this.isSelectionValid(node.entry));
        this.chosenNode = validNodesEntity.map((node) => node.entry);
    }
    setTitleIfCustomSite(site) {
        if (this.customResourcesService.isCustomSource(site.entry.guid)) {
            this.breadcrumbFolderTitle = site.entry.title;
            if (this.documentList.folderNode.path.elements) {
                this.breadcrumbFolderNode.name = site.entry.title;
                this.documentList.folderNode.path.elements = null;
            }
        }
        else {
            this.breadcrumbFolderTitle = null;
        }
    }
    hasPreselectNodes() {
        var _a;
        return ((_a = this.preselectedNodes) === null || _a === void 0 ? void 0 : _a.length) > 0;
    }
    isSingleSelectionMode() {
        return this.selectionMode === 'single';
    }
    getPreselectNodesBasedOnSelectionMode() {
        var _a;
        let selectedNodes = [];
        if ((_a = this.currentUploadBatch) === null || _a === void 0 ? void 0 : _a.length) {
            if (this.isSingleSelectionMode()) {
                selectedNodes = [this.currentUploadBatch[this.currentUploadBatch.length - 1]];
            }
            else {
                selectedNodes = this.currentUploadBatch;
            }
        }
        return selectedNodes;
    }
    resetPagination() {
        this.queryBuilderService.paging = {
            maxItems: this.pageSize,
            skipCount: this.DEFAULT_PAGINATION.skipCount
        };
    }
}
ContentNodeSelectorPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-content-node-selector-panel',
                template: "<div class=\"adf-content-node-selector-content\">\n    <mat-form-field floatPlaceholder=\"never\" class=\"adf-content-node-selector-content-input\" *ngIf=\"showSearch\">\n        <input matInput\n            id=\"searchInput\"\n            [formControl]=\"searchInput\"\n            type=\"text\"\n            placeholder=\"{{'NODE_SELECTOR.SEARCH' | translate}}\"\n            [value]=\"searchTerm\"\n            data-automation-id=\"content-node-selector-search-input\">\n\n        <mat-icon *ngIf=\"searchTerm.length > 0\"\n            matSuffix (click)=\"clear()\"\n            class=\"adf-content-node-selector-content-input-icon\"\n            data-automation-id=\"content-node-selector-search-clear\">clear\n        </mat-icon>\n\n        <mat-icon *ngIf=\"searchTerm.length === 0\"\n            matSuffix\n            class=\"adf-content-node-selector-content-input-icon\"\n            data-automation-id=\"content-node-selector-search-icon\">search\n        </mat-icon>\n\n    </mat-form-field>\n    <adf-sites-dropdown\n        *ngIf=\"showDropdownSiteList\"\n        class=\"full-width\"\n        (change)=\"siteChanged($event)\"\n        [placeholder]=\"'NODE_SELECTOR.SELECT_LOCATION'\"\n        [hideMyFiles]=\"dropdownHideMyFiles\"\n        [siteList]=\"dropdownSiteList\"\n        [value]=\"startSiteGuid\"\n        data-automation-id=\"content-node-selector-sites-combo\">\n    </adf-sites-dropdown>\n    <button *ngIf=\"hasCustomModels()\"\n        data-automation-id=\"adf-toggle-search-panel-button\"\n        mat-icon-button\n        (click)=\"toggleSearchPanel()\">\n        <mat-icon>filter_list</mat-icon>\n        {{ 'SEARCH.SEARCH_HEADER.TITLE' | translate }}\n    </button>\n    <div class=\"adf-content-node-selector-search-panel-container\">\n        <adf-search-panel *ngIf=\"searchPanelExpanded\">\n        </adf-search-panel>\n        <div class=\"adf-content-node-selector-document-list-container\">\n    <adf-toolbar>\n        <adf-toolbar-title>\n            <ng-container *ngIf=\"!showBreadcrumbs()\">\n                <span role=\"heading\" aria-level=\"3\" class=\"adf-search-results-label\">{{ 'NODE_SELECTOR.SEARCH_RESULTS' | translate }}</span>\n            </ng-container>\n            <adf-dropdown-breadcrumb *ngIf=\"showBreadcrumbs()\"\n                class=\"adf-content-node-selector-content-breadcrumb\"\n                (navigate)=\"clearSearch()\"\n                [target]=\"documentList\"\n                [rootId]=\"breadcrumbRootId\"\n                [transform]=\"breadcrumbTransform\"\n                [folderNode]=\"breadcrumbFolderNode\"\n                [root]=\"breadcrumbFolderTitle\"\n                data-automation-id=\"content-node-selector-content-breadcrumb\">\n            </adf-dropdown-breadcrumb>\n            <ng-container *ngIf=\"showNodeCounter\" [adf-node-counter]=\"getSelectedCount()\"></ng-container>\n        </adf-toolbar-title>\n    </adf-toolbar>\n\n    <div\n        class=\"adf-content-node-selector-content-list\"\n        [class.adf-content-node-selector-content-list-searchLayout]=\"showingSearchResults\"\n        data-automation-id=\"content-node-selector-content-list\">\n        <adf-document-list\n            #documentList\n            [adf-highlight]=\"searchTerm\"\n            adf-highlight-selector=\".adf-name-location-cell-name\"\n            [showHeader]=\"showHeader\"\n            [node]=\"nodePaging\"\n            [preselectNodes]=\"preselectedNodes\"\n            [maxItems]=\"pageSize\"\n            [rowFilter]=\"_rowFilter\"\n            [imageResolver]=\"imageResolver\"\n            [currentFolderId]=\"folderIdToShow\"\n            [selectionMode]=\"selectionMode\"\n            [contextMenuActions]=\"false\"\n            [contentActions]=\"false\"\n            [allowDropFiles]=\"false\"\n            [sorting]=\"sorting\"\n            sortingMode=\"server\"\n            [where]=\"where\"\n            (folderChange)=\"onFolderChange($event)\"\n            (ready)=\"onFolderLoaded($event)\"\n            (nodeSelected)=\"onCurrentSelection($event)\"\n            data-automation-id=\"content-node-selector-document-list\">\n\n            <adf-custom-empty-content-template>\n                <div>{{ 'NODE_SELECTOR.NO_RESULTS' | translate }}</div>\n            </adf-custom-empty-content-template>\n\n            <data-columns>\n                <data-column key=\"$thumbnail\" type=\"image\"></data-column>\n                <data-column key=\"name\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.NAME\" class=\"adf-full-width adf-ellipsis-cell\">\n                    <ng-template let-context>\n                        <adf-name-location-cell [row]=\"context.row\"></adf-name-location-cell>\n                    </ng-template>\n                </data-column>\n                <data-column key=\"modifiedAt\" type=\"date\" title=\"ADF-DOCUMENT-LIST.LAYOUT.MODIFIED_ON\" format=\"timeAgo\" class=\"adf-content-selector-modified-cell\"></data-column>\n                <data-column key=\"createdByUser.displayName\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.CREATED_BY\" class=\"adf-content-selector-modifier-cell\"></data-column>\n                <data-column key=\"visibility\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.STATUS\" class=\"adf-content-selector-visibility-cell\"></data-column>\n            </data-columns>\n\n        </adf-document-list>\n\n        <adf-infinite-pagination\n            [target]=\"target\"\n            [loading]=\"loadingSearchResults\"\n            (loadMore)=\"getNextPageOfSearch($event)\"\n            data-automation-id=\"content-node-selector-search-pagination\">\n            {{ 'ADF-DOCUMENT-LIST.LAYOUT.LOAD_MORE' | translate }}\n        </adf-infinite-pagination>\n    </div>\n        </div>\n    </div>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                host: { 'class': 'adf-content-node-selector-panel' },
                providers: [{
                        provide: SEARCH_QUERY_SERVICE_TOKEN,
                        useClass: SearchQueryBuilderService
                    }]
            },] }
];
ContentNodeSelectorPanelComponent.ctorParameters = () => [
    { type: CustomResourcesService },
    { type: SearchQueryBuilderService, decorators: [{ type: Inject, args: [SEARCH_QUERY_SERVICE_TOKEN,] }] },
    { type: UserPreferencesService },
    { type: NodesApiService },
    { type: UploadService },
    { type: SitesService },
    { type: AppConfigService },
    { type: ContentNodeSelectorPanelService }
];
ContentNodeSelectorPanelComponent.propDecorators = {
    restrictRootToCurrentFolderId: [{ type: Input }],
    currentFolderId: [{ type: Input }],
    dropdownHideMyFiles: [{ type: Input }],
    dropdownSiteList: [{ type: Input }],
    where: [{ type: Input }],
    rowFilter: [{ type: Input }],
    excludeSiteContent: [{ type: Input }],
    imageResolver: [{ type: Input }],
    pageSize: [{ type: Input }],
    selectionMode: [{ type: Input }],
    isSelectionValid: [{ type: Input }],
    breadcrumbTransform: [{ type: Input }],
    showSearch: [{ type: Input }],
    showDropdownSiteList: [{ type: Input }],
    showFilesInResult: [{ type: Input }],
    showNodeCounter: [{ type: Input }],
    select: [{ type: Output }],
    navigationChange: [{ type: Output }],
    siteChange: [{ type: Output }],
    showingSearch: [{ type: Output }],
    currentFolder: [{ type: Output }],
    folderLoaded: [{ type: Output }],
    documentList: [{ type: ViewChild, args: ['documentList', { static: true },] }],
    highlighter: [{ type: ViewChild, args: [HighlightDirective, { static: true },] }],
    infinitePaginationComponent: [{ type: ViewChild, args: [InfinitePaginationComponent, { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvbnRlbnQtc2VydmljZXMvc3JjLyIsInNvdXJjZXMiOlsibGliL2NvbnRlbnQtbm9kZS1zZWxlY3Rvci9jb250ZW50LW5vZGUtc2VsZWN0b3ItcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVILE9BQU8sRUFDSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUNULGlCQUFpQixFQUVqQixNQUFNLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILGtCQUFrQixFQUNsQixzQkFBc0IsRUFDdEIsb0JBQW9CLEVBQ3BCLDJCQUEyQixFQUMzQixlQUFlLEVBQ2YsWUFBWSxFQUNaLGFBQWEsRUFHYixnQkFBZ0IsRUFFaEIsY0FBYyxFQUNqQixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQW9CLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFzQyxNQUFNLGtCQUFrQixDQUFDO0FBQzNILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRzVGLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFFNUYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNsRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpREFB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QyxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUU7Z0JBQ3BELFNBQVMsRUFBRSxDQUFDO3dCQUNSLE9BQU8sRUFBRSwwQkFBMEI7d0JBQ25DLFFBQVEsRUFBRSx5QkFBeUI7cUJBQ3RDLENBQUM7YUFDTDs7O1lBcEJRLHNCQUFzQjtZQUl0Qix5QkFBeUIsdUJBK05qQixNQUFNLFNBQUMsMEJBQTBCO1lBclA5QyxzQkFBc0I7WUFHdEIsZUFBZTtZQUVmLGFBQWE7WUFEYixZQUFZO1lBSVosZ0JBQWdCO1lBZVgsK0JBQStCOzs7NENBNEJuQyxLQUFLOzhCQUlMLEtBQUs7a0NBT0wsS0FBSzsrQkFPTCxLQUFLO29CQVNMLEtBQUs7d0JBUUwsS0FBSztpQ0FjTCxLQUFLOzRCQWVMLEtBQUs7dUJBSUwsS0FBSzs0QkFJTCxLQUFLOytCQU1MLEtBQUs7a0NBUUwsS0FBSzt5QkFJTCxLQUFLO21DQVlMLEtBQUs7Z0NBWUwsS0FBSzs4QkFTTCxLQUFLO3FCQVVMLE1BQU07K0JBSU4sTUFBTTt5QkFJTixNQUFNOzRCQUlOLE1BQU07NEJBSU4sTUFBTTsyQkFJTixNQUFNOzJCQUdOLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzBCQUcxQyxTQUFTLFNBQUMsa0JBQWtCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzBDQWlCOUMsU0FBUyxTQUFDLDJCQUEyQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgQ29tcG9uZW50LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkluaXQsXG4gICAgT3V0cHV0LFxuICAgIFZpZXdDaGlsZCxcbiAgICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgICBPbkRlc3Ryb3ksXG4gICAgSW5qZWN0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBIaWdobGlnaHREaXJlY3RpdmUsXG4gICAgVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICBVc2VyUHJlZmVyZW5jZVZhbHVlcyxcbiAgICBJbmZpbml0ZVBhZ2luYXRpb25Db21wb25lbnQsIFBhZ2luYXRlZENvbXBvbmVudCxcbiAgICBOb2Rlc0FwaVNlcnZpY2UsXG4gICAgU2l0ZXNTZXJ2aWNlLFxuICAgIFVwbG9hZFNlcnZpY2UsXG4gICAgRmlsZVVwbG9hZENvbXBsZXRlRXZlbnQsXG4gICAgRmlsZVVwbG9hZERlbGV0ZUV2ZW50LFxuICAgIEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgRGF0YVNvcnRpbmcsXG4gICAgU2hvd0hlYWRlck1vZGVcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTm9kZSwgTm9kZVBhZ2luZywgUGFnaW5hdGlvbiwgU2l0ZUVudHJ5LCBTaXRlUGFnaW5nLCBOb2RlRW50cnksIFF1ZXJ5Qm9keSwgUmVxdWVzdFNjb3BlIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBEb2N1bWVudExpc3RDb21wb25lbnQgfSBmcm9tICcuLi9kb2N1bWVudC1saXN0L2NvbXBvbmVudHMvZG9jdW1lbnQtbGlzdC5jb21wb25lbnQnO1xuaW1wb3J0IHsgUm93RmlsdGVyIH0gZnJvbSAnLi4vZG9jdW1lbnQtbGlzdC9kYXRhL3Jvdy1maWx0ZXIubW9kZWwnO1xuaW1wb3J0IHsgSW1hZ2VSZXNvbHZlciB9IGZyb20gJy4uL2RvY3VtZW50LWxpc3QvZGF0YS9pbWFnZS1yZXNvbHZlci5tb2RlbCc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEN1c3RvbVJlc291cmNlc1NlcnZpY2UgfSBmcm9tICcuLi9kb2N1bWVudC1saXN0L3NlcnZpY2VzL2N1c3RvbS1yZXNvdXJjZXMuc2VydmljZSc7XG5pbXBvcnQgeyBOb2RlRW50cnlFdmVudCwgU2hhcmVEYXRhUm93IH0gZnJvbSAnLi4vZG9jdW1lbnQtbGlzdCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBTRUFSQ0hfUVVFUllfU0VSVklDRV9UT0tFTiB9IGZyb20gJy4uL3NlYXJjaC9zZWFyY2gtcXVlcnktc2VydmljZS50b2tlbic7XG5pbXBvcnQgeyBTZWFyY2hRdWVyeUJ1aWxkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VhcmNoL3NlcnZpY2VzL3NlYXJjaC1xdWVyeS1idWlsZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29udGVudE5vZGVTZWxlY3RvclBhbmVsU2VydmljZSB9IGZyb20gJy4vY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsLnNlcnZpY2UnO1xuXG5leHBvcnQgdHlwZSBWYWxpZGF0aW9uRnVuY3Rpb24gPSAoZW50cnk6IE5vZGUpID0+IGJvb2xlYW47XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0VmFsaWRhdGlvbiA9ICgpID0+IHRydWU7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWNvbnRlbnQtbm9kZS1zZWxlY3Rvci1wYW5lbCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NvbnRlbnQtbm9kZS1zZWxlY3Rvci1wYW5lbC5jb21wb25lbnQuaHRtbCcsXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBob3N0OiB7ICdjbGFzcyc6ICdhZGYtY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsJyB9LFxuICAgIHByb3ZpZGVyczogW3tcbiAgICAgICAgcHJvdmlkZTogU0VBUkNIX1FVRVJZX1NFUlZJQ0VfVE9LRU4sXG4gICAgICAgIHVzZUNsYXNzOiBTZWFyY2hRdWVyeUJ1aWxkZXJTZXJ2aWNlXG4gICAgfV1cbn0pXG5leHBvcnQgY2xhc3MgQ29udGVudE5vZGVTZWxlY3RvclBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgREVGQVVMVF9QQUdJTkFUSU9OOiBQYWdpbmF0aW9uID0gbmV3IFBhZ2luYXRpb24oe1xuICAgICAgICBtYXhJdGVtczogMjUsXG4gICAgICAgIHNraXBDb3VudDogMFxuICAgIH0pO1xuXG4gICAgcHJpdmF0ZSBzaG93U2l0ZUxpc3QgPSB0cnVlO1xuICAgIHByaXZhdGUgc2hvd1NlYXJjaEZpZWxkID0gdHJ1ZTtcbiAgICBwcml2YXRlIHNob3dDb3VudGVyID0gZmFsc2U7XG5cbiAgICAvKiogSWYgdHJ1ZSB3aWxsIHJlc3RyaWN0IHRoZSBzZWFyY2ggYW5kIGJyZWFkY3J1bWJzIHRvIHRoZSBjdXJyZW50Rm9sZGVySWQgKi9cbiAgICBASW5wdXQoKVxuICAgIHJlc3RyaWN0Um9vdFRvQ3VycmVudEZvbGRlcklkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogTm9kZSBJRCBvZiB0aGUgZm9sZGVyIGN1cnJlbnRseSBsaXN0ZWQuICovXG4gICAgQElucHV0KClcbiAgICBjdXJyZW50Rm9sZGVySWQ6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogSGlkZSB0aGUgXCJNeSBGaWxlc1wiIG9wdGlvbiBhZGRlZCB0byB0aGUgc2l0ZSBsaXN0IGJ5IGRlZmF1bHQuXG4gICAgICogU2VlIHRoZSBbU2l0ZXMgRHJvcGRvd24gY29tcG9uZW50XShzaXRlcy1kcm9wZG93bi5jb21wb25lbnQubWQpXG4gICAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBkcm9wZG93bkhpZGVNeUZpbGVzOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogQ3VzdG9tIHNpdGUgZm9yIHNpdGUgZHJvcGRvd24uIFRoaXMgaXMgdGhlIHNhbWUgYXMgdGhlIGBzaXRlTGlzdGAuXG4gICAgICogcHJvcGVydHkgb2YgdGhlIFNpdGVzIERyb3Bkb3duIGNvbXBvbmVudCAoc2VlIGl0cyBkb2MgcGFnZVxuICAgICAqIGZvciBtb3JlIGluZm9ybWF0aW9uKS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGRyb3Bkb3duU2l0ZUxpc3Q6IFNpdGVQYWdpbmcgPSBudWxsO1xuXG4gICAgX3Jvd0ZpbHRlcjogUm93RmlsdGVyID0gZGVmYXVsdFZhbGlkYXRpb247XG5cbiAgICAvKiogQ3VzdG9tICp3aGVyZSogZmlsdGVyIGZ1bmN0aW9uLiBTZWUgdGhlXG4gICAgICogRG9jdW1lbnQgTGlzdCBjb21wb25lbnRcbiAgICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHdoZXJlOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBDdXN0b20gcm93IGZpbHRlciBmdW5jdGlvbi4gU2VlIHRoZVxuICAgICAqIFtSb3cgRmlsdGVyIE1vZGVsXShyb3ctZmlsdGVyLm1vZGVsLm1kKSBwYWdlXG4gICAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBzZXQgcm93RmlsdGVyKHJvd0ZpbHRlcjogUm93RmlsdGVyKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlUm93RmlsdGVyKHJvd0ZpbHRlcik7XG4gICAgfVxuXG4gICAgZ2V0IHJvd0ZpbHRlcigpOiBSb3dGaWx0ZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fcm93RmlsdGVyO1xuICAgIH1cblxuICAgIF9leGNsdWRlU2l0ZUNvbnRlbnQ6IHN0cmluZ1tdID0gW107XG5cbiAgICAvKiogQ3VzdG9tIGxpc3Qgb2Ygc2l0ZSBjb250ZW50IGNvbXBvbmVudElkcy5cbiAgICAgKiBVc2VkIHRvIGZpbHRlciBvdXQgdGhlIGNvcnJlc3BvbmRpbmcgaXRlbXMgZnJvbSB0aGUgZGlzcGxheWVkIG5vZGVzXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBzZXQgZXhjbHVkZVNpdGVDb250ZW50KGV4Y2x1ZGVTaXRlQ29udGVudDogc3RyaW5nW10pIHtcbiAgICAgICAgdGhpcy5fZXhjbHVkZVNpdGVDb250ZW50ID0gZXhjbHVkZVNpdGVDb250ZW50O1xuICAgICAgICB0aGlzLmNyZWF0ZVJvd0ZpbHRlcih0aGlzLl9yb3dGaWx0ZXIpO1xuICAgIH1cblxuICAgIGdldCBleGNsdWRlU2l0ZUNvbnRlbnQoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZXhjbHVkZVNpdGVDb250ZW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEN1c3RvbSBpbWFnZSByZXNvbHZlciBmdW5jdGlvbi4gU2VlIHRoZVxuICAgICAqIFtJbWFnZSBSZXNvbHZlciBNb2RlbF0oaW1hZ2UtcmVzb2x2ZXIubW9kZWwubWQpIHBhZ2VcbiAgICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGltYWdlUmVzb2x2ZXI6IEltYWdlUmVzb2x2ZXIgPSBudWxsO1xuXG4gICAgLyoqIE51bWJlciBvZiBpdGVtcyBzaG93biBwZXIgcGFnZSBpbiB0aGUgbGlzdC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHBhZ2VTaXplOiBudW1iZXIgPSB0aGlzLkRFRkFVTFRfUEFHSU5BVElPTi5tYXhJdGVtcztcblxuICAgIC8qKiBEZWZpbmUgdGhlIHNlbGVjdGlvbiBtb2RlIGZvciBkb2N1bWVudCBsaXN0LiBUaGUgYWxsb3dlZCB2YWx1ZXMgYXJlIHNpbmdsZSBvciBtdWx0aXBsZSAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2VsZWN0aW9uTW9kZTogJ3NpbmdsZScgfCAnbXVsdGlwbGUnID0gJ3NpbmdsZSc7XG5cbiAgICAvKiogRnVuY3Rpb24gdXNlZCB0byBkZWNpZGUgaWYgdGhlIHNlbGVjdGVkIG5vZGUgaGFzIHBlcm1pc3Npb24gdG8gYmUgc2VsZWN0ZWQuXG4gICAgICogRGVmYXVsdCB2YWx1ZSBpcyBhIGZ1bmN0aW9uIHRoYXQgYWx3YXlzIHJldHVybnMgdHJ1ZS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGlzU2VsZWN0aW9uVmFsaWQ6IFZhbGlkYXRpb25GdW5jdGlvbiA9IGRlZmF1bHRWYWxpZGF0aW9uO1xuXG4gICAgLyoqIFRyYW5zZm9ybWF0aW9uIHRvIGJlIHBlcmZvcm1lZCBvbiB0aGUgY2hvc2VuL2ZvbGRlciBub2RlIGJlZm9yZSBidWlsZGluZyB0aGVcbiAgICAgKiBicmVhZGNydW1iIFVJLiBDYW4gYmUgdXNlZnVsIHdoZW4gY3VzdG9tIGZvcm1hdHRpbmcgaXMgbmVlZGVkIGZvciB0aGUgYnJlYWRjcnVtYi5cbiAgICAgKiBZb3UgY2FuIGNoYW5nZSB0aGUgcGF0aCBlbGVtZW50cyBmcm9tIHRoZSBub2RlIHRoYXQgYXJlIHVzZWQgdG8gYnVpbGQgdGhlXG4gICAgICogYnJlYWRjcnVtYiB1c2luZyB0aGlzIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgYnJlYWRjcnVtYlRyYW5zZm9ybTogKG5vZGUpID0+IGFueTtcblxuICAgIC8qKiBUb2dnbGUgc2VhcmNoIGlucHV0IHJlbmRlcmluZyAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHNob3dTZWFyY2godmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1NlYXJjaEZpZWxkID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgc2hvd1NlYXJjaCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd1NlYXJjaEZpZWxkO1xuICAgIH1cblxuICAgIC8qKiBUb2dnbGUgc2l0ZXMgbGlzdCBkcm9wZG93biByZW5kZXJpbmcgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBzaG93RHJvcGRvd25TaXRlTGlzdCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zaG93U2l0ZUxpc3QgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBzaG93RHJvcGRvd25TaXRlTGlzdCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd1NpdGVMaXN0O1xuICAgIH1cblxuICAgIC8qKiBTaG93cyB0aGUgZmlsZXMgYW5kIGZvbGRlcnMgaW4gdGhlIHNlYXJjaCByZXN1bHQgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBzaG93RmlsZXNJblJlc3VsdCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3Qgc2hvd0ZpbGVzUXVlcnkgPSBgVFlQRTonY206Zm9sZGVyJyR7dmFsdWUgPyBcIiBPUiBUWVBFOidjbTpjb250ZW50J1wiIDogJyd9YDtcbiAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5hZGRGaWx0ZXJRdWVyeShzaG93RmlsZXNRdWVyeSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogU2hvd3MgdGhlIG5vZGUgY291bnRlciBpbiB0aGUgYnJlYWRjcnVtYiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHNob3dOb2RlQ291bnRlcih2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnNob3dDb3VudGVyID0gdmFsdWUgPz8gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0IHNob3dOb2RlQ291bnRlcigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0NvdW50ZXI7XG4gICAgfVxuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgdXNlciBoYXMgY2hvc2VuIGFuIGl0ZW0uICovXG4gICAgQE91dHB1dCgpXG4gICAgc2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcjxOb2RlW10+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBuYXZpZ2F0aW9uIGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgbmF2aWdhdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Tm9kZUVudHJ5RXZlbnQ+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBzZWxlY3Qgc2l0ZSBjaGFuZ2VzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNpdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gc2VhcmNoIGlzIHJ1bm5pbmcuICovXG4gICAgQE91dHB1dCgpXG4gICAgc2hvd2luZ1NlYXJjaCA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gY3VycmVudCBmb2xkZXIgbG9hZGVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGN1cnJlbnRGb2xkZXIgPSBuZXcgRXZlbnRFbWl0dGVyPE5vZGU+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGZvbGRlciBsb2FkZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgZm9sZGVyTG9hZGVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQFZpZXdDaGlsZCgnZG9jdW1lbnRMaXN0JywgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBkb2N1bWVudExpc3Q6IERvY3VtZW50TGlzdENvbXBvbmVudDtcblxuICAgIEBWaWV3Q2hpbGQoSGlnaGxpZ2h0RGlyZWN0aXZlLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIGhpZ2hsaWdodGVyOiBIaWdobGlnaHREaXJlY3RpdmU7XG5cbiAgICBub2RlUGFnaW5nOiBOb2RlUGFnaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgc2l0ZUlkOiBudWxsIHwgc3RyaW5nO1xuICAgIGJyZWFkY3J1bWJSb290SWQ6IG51bGwgfCBzdHJpbmc7XG4gICAgc2VhcmNoVGVybTogc3RyaW5nID0gJyc7XG4gICAgc2hvd2luZ1NlYXJjaFJlc3VsdHM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBsb2FkaW5nU2VhcmNoUmVzdWx0czogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGluRGlhbG9nOiBib29sZWFuID0gZmFsc2U7XG4gICAgX2Nob3Nlbk5vZGU6IE5vZGUgW10gPSBudWxsO1xuICAgIGZvbGRlcklkVG9TaG93OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICBicmVhZGNydW1iRm9sZGVyVGl0bGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIHN0YXJ0U2l0ZUd1aWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGhhc1ZhbGlkUXVlcnk6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBzaG93SGVhZGVyID0gU2hvd0hlYWRlck1vZGUuTmV2ZXI7XG5cbiAgICBAVmlld0NoaWxkKEluZmluaXRlUGFnaW5hdGlvbkNvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBpbmZpbml0ZVBhZ2luYXRpb25Db21wb25lbnQ6IEluZmluaXRlUGFnaW5hdGlvbkNvbXBvbmVudDtcblxuICAgIGluZmluaXRlU2Nyb2xsOiBib29sZWFuID0gZmFsc2U7XG4gICAgZGVib3VuY2VTZWFyY2g6IG51bWJlciA9IDIwMDtcbiAgICBzZWFyY2hJbnB1dDogRm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAgIHRhcmdldDogUGFnaW5hdGVkQ29tcG9uZW50O1xuICAgIHByZXNlbGVjdGVkTm9kZXM6IE5vZGVFbnRyeVtdID0gW107XG4gICAgY3VycmVudFVwbG9hZEJhdGNoOiBOb2RlRW50cnlbXSA9IFtdO1xuXG4gICAgc29ydGluZzogc3RyaW5nW10gfCBEYXRhU29ydGluZztcblxuICAgIHNlYXJjaFBhbmVsRXhwYW5kZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByaXZhdGUgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGN1c3RvbVJlc291cmNlc1NlcnZpY2U6IEN1c3RvbVJlc291cmNlc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgQEluamVjdChTRUFSQ0hfUVVFUllfU0VSVklDRV9UT0tFTikgcHVibGljIHF1ZXJ5QnVpbGRlclNlcnZpY2U6IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2VyUHJlZmVyZW5jZXNTZXJ2aWNlOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbm9kZXNBcGlTZXJ2aWNlOiBOb2Rlc0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB1cGxvYWRTZXJ2aWNlOiBVcGxvYWRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgc2l0ZXNTZXJ2aWNlOiBTaXRlc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWdTZXJ2aWNlOiBBcHBDb25maWdTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgY29udGVudE5vZGVTZWxlY3RvclBhbmVsU2VydmljZTogQ29udGVudE5vZGVTZWxlY3RvclBhbmVsU2VydmljZSkge1xuICAgIH1cblxuICAgIHNldCBjaG9zZW5Ob2RlKHZhbHVlOiBOb2RlW10pIHtcbiAgICAgICAgdGhpcy5fY2hvc2VuTm9kZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnNlbGVjdC5uZXh0KHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXQgY2hvc2VuTm9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Nob3Nlbk5vZGU7XG4gICAgfVxuXG4gICAgZ2V0U2VsZWN0ZWRDb3VudCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5jaG9zZW5Ob2RlPy5sZW5ndGggfHwgMDtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC52YWx1ZUNoYW5nZXNcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSh0aGlzLmRlYm91bmNlU2VhcmNoKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoc2VhcmNoVmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IHNlYXJjaFZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS51c2VyUXVlcnkgPSBzZWFyY2hWYWx1ZS5sZW5ndGggPiAwID8gYCR7c2VhcmNoVmFsdWV9KmAgOiBzZWFyY2hWYWx1ZSA7XG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnVwZGF0ZWRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocXVlcnlCb2R5OiBRdWVyeUJvZHkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocXVlcnlCb2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzVmFsaWRRdWVyeSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlcGFyZURpYWxvZ0Zvck5ld1NlYXJjaChxdWVyeUJvZHkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UuZXhlY3V0ZShxdWVyeUJvZHkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzVmFsaWRRdWVyeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Rm9sZGVyVG9TaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWFyY2goKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UuZXhlY3V0ZWRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzdWx0czogTm9kZVBhZ2luZykgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1ZhbGlkUXVlcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U2VhcmNoUmVzdWx0cyhyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVzZXJQcmVmZXJlbmNlc1NlcnZpY2VcbiAgICAgICAgICAgIC5zZWxlY3QoVXNlclByZWZlcmVuY2VWYWx1ZXMuUGFnaW5hdGlvblNpemUpXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocGFnU2l6ZSA9PiB0aGlzLnBhZ2VTaXplID0gcGFnU2l6ZSk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLmRvY3VtZW50TGlzdDtcbiAgICAgICAgdGhpcy5mb2xkZXJJZFRvU2hvdyA9IHRoaXMuY3VycmVudEZvbGRlcklkO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50Rm9sZGVySWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlc3RyaWN0Um9vdFRvQ3VycmVudEZvbGRlcklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5icmVhZGNydW1iUm9vdElkID0gdGhpcy5jdXJyZW50Rm9sZGVySWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5zaXRlSWQgPSB0aGlzLmN1cnJlbnRGb2xkZXJJZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRTdGFydFNpdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYnJlYWRjcnVtYlRyYW5zZm9ybSA9IHRoaXMuYnJlYWRjcnVtYlRyYW5zZm9ybSA/IHRoaXMuYnJlYWRjcnVtYlRyYW5zZm9ybSA6IG51bGw7XG4gICAgICAgIHRoaXMuaXNTZWxlY3Rpb25WYWxpZCA9IHRoaXMuaXNTZWxlY3Rpb25WYWxpZCA/IHRoaXMuaXNTZWxlY3Rpb25WYWxpZCA6IGRlZmF1bHRWYWxpZGF0aW9uO1xuICAgICAgICB0aGlzLm9uRmlsZVVwbG9hZEV2ZW50KCk7XG4gICAgICAgIHRoaXMub25GaWxlVXBsb2FkRGVsZXRlZEV2ZW50KCk7XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMuc2V0U2VhcmNoU2NvcGVUb05vZGVzKCk7XG5cbiAgICAgICAgdGhpcy5kb2N1bWVudExpc3QuJGZvbGRlck5vZGVcbiAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKGN1cnJlbnROb2RlOiBOb2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGb2xkZXIuZW1pdChjdXJyZW50Tm9kZSk7XG4gICAgfSk7XG5cbiAgICAgICAgdGhpcy5zb3J0aW5nID0gdGhpcy5hcHBDb25maWdTZXJ2aWNlLmdldCgnYWRmLWNvbnRlbnQtbm9kZS1zZWxlY3Rvci5zb3J0aW5nJywgWydjcmVhdGVkQXQnLCAnZGVzYyddKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIHRvZ2dsZVNlYXJjaFBhbmVsKCkge1xuICAgICAgICB0aGlzLnNlYXJjaFBhbmVsRXhwYW5kZWQgPSAhdGhpcy5zZWFyY2hQYW5lbEV4cGFuZGVkO1xuICAgIH1cblxuICAgIGhhc0N1c3RvbU1vZGVscygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudE5vZGVTZWxlY3RvclBhbmVsU2VydmljZT8uY3VzdG9tTW9kZWxzPy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25GaWxlVXBsb2FkRXZlbnQoKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5maWxlVXBsb2FkQ29tcGxldGVcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MDApLFxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChmaWxlVXBsb2FkRXZlbnQ6IEZpbGVVcGxvYWRDb21wbGV0ZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXBsb2FkQmF0Y2gucHVzaChmaWxlVXBsb2FkRXZlbnQuZGF0YSk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnVwbG9hZFNlcnZpY2UuaXNVcGxvYWRpbmcoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXNlbGVjdGVkTm9kZXMgPSB0aGlzLmdldFByZXNlbGVjdE5vZGVzQmFzZWRPblNlbGVjdGlvbk1vZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXBsb2FkQmF0Y2ggPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudExpc3QucmVsb2FkV2l0aG91dFJlc2V0dGluZ1NlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25GaWxlVXBsb2FkRGVsZXRlZEV2ZW50KCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuZmlsZVVwbG9hZERlbGV0ZWRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoZGVsZXRlZEZpbGVFdmVudDogRmlsZVVwbG9hZERlbGV0ZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudExpc3QudW5zZWxlY3RSb3dGcm9tTm9kZUlkKGRlbGV0ZWRGaWxlRXZlbnQuZmlsZS5kYXRhLmVudHJ5LmlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50TGlzdC5yZWxvYWRXaXRob3V0UmVzZXR0aW5nU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFN0YXJ0U2l0ZSgpIHtcbiAgICAgICAgdGhpcy5ub2Rlc0FwaVNlcnZpY2UuZ2V0Tm9kZSh0aGlzLmN1cnJlbnRGb2xkZXJJZCkuc3Vic2NyaWJlKChzdGFydE5vZGVFbnRyeSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGFydFNpdGVHdWlkID0gdGhpcy5zaXRlc1NlcnZpY2UuZ2V0U2l0ZU5hbWVGcm9tTm9kZVBhdGgoc3RhcnROb2RlRW50cnkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRTaXRlR3VpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2l0ZXNTZXJ2aWNlLmdldFNpdGUodGhpcy5zdGFydFNpdGVHdWlkKS5zdWJzY3JpYmUoKHN0YXJ0U2l0ZUVudHJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydFNpdGVFbnRyeSBpbnN0YW5jZW9mIFNpdGVFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaXRlQ2hhbmdlLmVtaXQoc3RhcnRTaXRlRW50cnkuZW50cnkudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlUm93RmlsdGVyKGZpbHRlcj86IFJvd0ZpbHRlcikge1xuICAgICAgICBpZiAoIWZpbHRlcikge1xuICAgICAgICAgICAgZmlsdGVyID0gKCkgPT4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yb3dGaWx0ZXIgPSAodmFsdWU6IFNoYXJlRGF0YVJvdywgaW5kZXg6IG51bWJlciwgYXJyYXk6IFNoYXJlRGF0YVJvd1tdKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyKHZhbHVlLCBpbmRleCwgYXJyYXkpICYmXG4gICAgICAgICAgICAgICAgIXRoaXMuaXNFeGNsdWRlZFNpdGVDb250ZW50KHZhbHVlKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRXhjbHVkZWRTaXRlQ29udGVudChyb3c6IFNoYXJlRGF0YVJvdyk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBlbnRyeSA9IHJvdy5ub2RlLmVudHJ5O1xuICAgICAgICBpZiAodGhpcy5fZXhjbHVkZVNpdGVDb250ZW50ICYmIHRoaXMuX2V4Y2x1ZGVTaXRlQ29udGVudC5sZW5ndGggJiZcbiAgICAgICAgICAgIGVudHJ5ICYmXG4gICAgICAgICAgICBlbnRyeS5wcm9wZXJ0aWVzICYmXG4gICAgICAgICAgICBlbnRyeS5wcm9wZXJ0aWVzWydzdDpjb21wb25lbnRJZCddKSB7XG4gICAgICAgICAgICBjb25zdCBleGNsdWRlZEl0ZW0gPSB0aGlzLl9leGNsdWRlU2l0ZUNvbnRlbnQuZmluZChcbiAgICAgICAgICAgICAgICAoaWQ6IHN0cmluZykgPT4gZW50cnkucHJvcGVydGllc1snc3Q6Y29tcG9uZW50SWQnXSA9PT0gaWRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gISFleGNsdWRlZEl0ZW07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHNpdGUgYXR0cmlidXRlIGFuZCBzdGFydHMgYSBuZXcgc2VhcmNoXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2hvc2VuU2l0ZSBTaXRlRW50cnkgdG8gc2VhcmNoIHdpdGhpblxuICAgICAqL1xuICAgIHNpdGVDaGFuZ2VkKGNob3NlblNpdGU6IFNpdGVFbnRyeSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNpdGVJZCA9IGNob3NlblNpdGUuZW50cnkuZ3VpZDtcbiAgICAgICAgdGhpcy5zZXRUaXRsZUlmQ3VzdG9tU2l0ZShjaG9zZW5TaXRlKTtcbiAgICAgICAgdGhpcy5zaXRlQ2hhbmdlLmVtaXQoY2hvc2VuU2l0ZS5lbnRyeS50aXRsZSk7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS51cGRhdGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBhY3R1YWxseSBzZWxlY3RlZHxlbnRlcmVkIGZvbGRlciBub2RlIG9yIG51bGwgaW4gY2FzZSBvZiBzZWFyY2hpbmcgZm9yIHRoZSBicmVhZGNydW1iXG4gICAgICovXG4gICAgZ2V0IGJyZWFkY3J1bWJGb2xkZXJOb2RlKCk6IE5vZGUgfCBudWxsIHtcbiAgICAgICAgbGV0IGZvbGRlck5vZGU6IE5vZGU7XG5cbiAgICAgICAgaWYgKHRoaXMuc2hvd2luZ1NlYXJjaFJlc3VsdHMgJiYgdGhpcy5jaG9zZW5Ob2RlKSB7XG4gICAgICAgICAgICBmb2xkZXJOb2RlID0gdGhpcy5jaG9zZW5Ob2RlWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9sZGVyTm9kZSA9IHRoaXMuZG9jdW1lbnRMaXN0LmZvbGRlck5vZGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9sZGVyTm9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmVwYXJlcyB0aGUgZGlhbG9nIGZvciBhIG5ldyBzZWFyY2hcbiAgICAgKi9cbiAgICBwcmVwYXJlRGlhbG9nRm9yTmV3U2VhcmNoKHF1ZXJ5Qm9keTogUXVlcnlCb2R5KTogdm9pZCB7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gcXVlcnlCb2R5ID8gbnVsbCA6IHRoaXMuZG9jdW1lbnRMaXN0O1xuICAgICAgICBpZiAodGhpcy50YXJnZXQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5maW5pdGVQYWdpbmF0aW9uQ29tcG9uZW50LnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mb2xkZXJJZFRvU2hvdyA9IG51bGw7XG4gICAgICAgIHRoaXMucHJlc2VsZWN0ZWROb2RlcyA9IFtdO1xuICAgICAgICB0aGlzLmxvYWRpbmdTZWFyY2hSZXN1bHRzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hZGRDb3JyZXNwb25kaW5nTm9kZUlkc1F1ZXJ5KCk7XG4gICAgICAgIHRoaXMucmVzZXRDaG9zZW5Ob2RlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIHNlYXJjaCBpbnB1dCBhbmQgcmVzZXQgdG8gbGFzdCBmb2xkZXIgbm9kZSBpbiB3aGljaCBzZWFyY2ggd2FzIHBlcmZvcm1lZFxuICAgICAqL1xuICAgIGNsZWFyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSAnJztcbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnVzZXJRdWVyeSA9ICcnO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBmb2xkZXIgdG8gYmUgc2hvd24gd2l0aCB0aGUgc2l0ZSBzZWxlY3Rpb24gb3IgdGhlIGluaXRpYWwgbGFuZGluZyBmb2xkZXJcbiAgICAgKi9cbiAgICByZXNldEZvbGRlclRvU2hvdygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb2xkZXJJZFRvU2hvdyA9IHRoaXMuc2l0ZUlkIHx8IHRoaXMuY3VycmVudEZvbGRlcklkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFyIHRoZSBzZWFyY2ggaW5wdXQgYW5kIHNlYXJjaCByZWxhdGVkIGRhdGFcbiAgICAgKi9cbiAgICBjbGVhclNlYXJjaCgpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gJyc7XG4gICAgICAgIHRoaXMubm9kZVBhZ2luZyA9IG51bGw7XG4gICAgICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMucmVzZXRDaG9zZW5Ob2RlKCk7XG4gICAgICAgIHRoaXMuc2hvd2luZ1NlYXJjaFJlc3VsdHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93aW5nU2VhcmNoLmVtaXQodGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRDb3JyZXNwb25kaW5nTm9kZUlkc1F1ZXJ5KCkge1xuICAgICAgICBsZXQgZXh0cmFQYXJlbnRGaWx0ZXJpbmcgPSAnJztcblxuICAgICAgICBpZiAodGhpcy5jdXN0b21SZXNvdXJjZXNTZXJ2aWNlLmhhc0NvcnJlc3BvbmRpbmdOb2RlSWRzKHRoaXMuc2l0ZUlkKSkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21SZXNvdXJjZXNTZXJ2aWNlLmdldENvcnJlc3BvbmRpbmdOb2RlSWRzKHRoaXMuc2l0ZUlkKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKG5vZGVJZHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVJZHMgJiYgbm9kZUlkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVJZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChpZCkgPT4gaWQgIT09IHRoaXMuc2l0ZUlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChleHRyYUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhUGFyZW50RmlsdGVyaW5nICs9IGAgT1IgQU5DRVNUT1I6J3dvcmtzcGFjZTovL1NwYWNlc1N0b3JlLyR7ZXh0cmFJZH0nYDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRGaWx0ZXJpbmcgPSB0aGlzLnNpdGVJZCA/IGBBTkNFU1RPUjond29ya3NwYWNlOi8vU3BhY2VzU3RvcmUvJHt0aGlzLnNpdGVJZH0nJHtleHRyYVBhcmVudEZpbHRlcmluZ31gIDogJyc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5hZGRGaWx0ZXJRdWVyeShwYXJlbnRGaWx0ZXJpbmcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50RmlsdGVyaW5nID0gdGhpcy5zaXRlSWQgPyBgQU5DRVNUT1I6J3dvcmtzcGFjZTovL1NwYWNlc1N0b3JlLyR7dGhpcy5zaXRlSWR9J2AgOiAnJztcbiAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5hZGRGaWx0ZXJRdWVyeShwYXJlbnRGaWx0ZXJpbmcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRTZWFyY2hTY29wZVRvTm9kZXMoKSB7XG4gICAgICAgIGNvbnN0IHNjb3BlOiBSZXF1ZXN0U2NvcGUgPSB7XG4gICAgICAgICAgICBsb2NhdGlvbnM6ICdub2RlcydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnNldFNjb3BlKHNjb3BlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSByZXN1bHRzIG9mIHRoZSBzZWFyY2hcbiAgICAgKlxuICAgICAqIEBwYXJhbSByZXN1bHRzIFNlYXJjaCByZXN1bHRzXG4gICAgICovXG4gICAgcHJpdmF0ZSBzaG93U2VhcmNoUmVzdWx0cyhyZXN1bHRzOiBOb2RlUGFnaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2hvd2luZ1NlYXJjaFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICB0aGlzLmxvYWRpbmdTZWFyY2hSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd2luZ1NlYXJjaC5lbWl0KHRoaXMuc2hvd2luZ1NlYXJjaFJlc3VsdHMpO1xuXG4gICAgICAgIHRoaXMubm9kZVBhZ2luZyA9IHJlc3VsdHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBzaG93aW5nU2VhcmNoUmVzdWx0cyBzdGF0ZSB0byBiZSBhYmxlIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBzZWFyY2ggcmVzdWx0cyBvciBmb2xkZXIgcmVzdWx0c1xuICAgICAqL1xuICAgIG9uRm9sZGVyQ2hhbmdlKCRldmVudDogTm9kZUVudHJ5RXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb2xkZXJJZFRvU2hvdyA9ICRldmVudC52YWx1ZS5pZDtcbiAgICAgICAgdGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmluZmluaXRlU2Nyb2xsID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYnJlYWRjcnVtYkZvbGRlclRpdGxlID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcmVzZWxlY3RlZE5vZGVzID0gW107XG4gICAgICAgIHRoaXMuY2xlYXJTZWFyY2goKTtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uQ2hhbmdlLmVtaXQoJGV2ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBdHRlbXB0cyB0byBzZXQgdGhlIGN1cnJlbnRseSBsb2FkZWQgbm9kZVxuICAgICAqL1xuICAgIG9uRm9sZGVyTG9hZGVkKG5vZGVQYWdpbmc6IE5vZGVQYWdpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGVQYWdpbmF0aW9uQWZ0ZXJSb3dGaWx0ZXIobm9kZVBhZ2luZyk7XG4gICAgICAgIGlmICghdGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cykge1xuICAgICAgICAgICAgdGhpcy5hdHRlbXB0Tm9kZVNlbGVjdGlvbih0aGlzLmRvY3VtZW50TGlzdC5mb2xkZXJOb2RlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZvbGRlckxvYWRlZC5lbWl0KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBwYWdpbmF0aW9uLmhhc01vcmVJdGVtcyB0byBmYWxzZSBhZnRlciBmaWx0ZXJpbmcgb25seSBmb2xkZXJzIGR1cmluZyAnQ09QWScgYW5kICdNT1ZFJyBhY3Rpb25cbiAgICAgKi9cbiAgICB1cGRhdGVQYWdpbmF0aW9uQWZ0ZXJSb3dGaWx0ZXIobm9kZVBhZ2luZzogTm9kZVBhZ2luZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5kb2N1bWVudExpc3QuZGF0YS5nZXRSb3dzKCkubGVuZ3RoIDwgbm9kZVBhZ2luZy5saXN0LnBhZ2luYXRpb24ubWF4SXRlbXMpIHtcbiAgICAgICAgICAgIG5vZGVQYWdpbmcubGlzdC5wYWdpbmF0aW9uLmhhc01vcmVJdGVtcyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIGJyZWFkY3J1bWIgaGFzIHRvIGJlIHNob3duIG9yIG5vdFxuICAgICAqL1xuICAgIHNob3dCcmVhZGNydW1icygpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLnNob3dpbmdTZWFyY2hSZXN1bHRzIHx8IHRoaXMuY2hvc2VuTm9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgbmV4dCBiYXRjaCBvZiBzZWFyY2ggcmVzdWx0c1xuICAgICAqXG4gICAgICogQHBhcmFtIHBhZ2luYXRpb24gUGFnaW5hdGlvbiBvYmplY3RcbiAgICAgKi9cbiAgICBnZXROZXh0UGFnZU9mU2VhcmNoKHBhZ2luYXRpb246IFBhZ2luYXRpb24pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbmZpbml0ZVNjcm9sbCA9IHRydWU7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5wYWdpbmcubWF4SXRlbXMgPSBwYWdpbmF0aW9uLm1heEl0ZW1zO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UucGFnaW5nLnNraXBDb3VudCA9IHBhZ2luYXRpb24uc2tpcENvdW50O1xuXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaFRlcm0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0cyBub2RlIGFzIGNob3NlbiBpZiBpdCBoYXMgdGhlIHJpZ2h0IHBlcm1pc3Npb24sIGNsZWFycyB0aGUgc2VsZWN0aW9uIG90aGVyd2lzZVxuICAgICAqXG4gICAgICogQHBhcmFtIGVudHJ5XG4gICAgICovXG4gICAgcHJpdmF0ZSBhdHRlbXB0Tm9kZVNlbGVjdGlvbihlbnRyeTogTm9kZSk6IHZvaWQge1xuICAgICAgICBpZiAoZW50cnkgJiYgdGhpcy5pc1NlbGVjdGlvblZhbGlkKGVudHJ5KSkge1xuICAgICAgICAgICAgdGhpcy5jaG9zZW5Ob2RlID0gW2VudHJ5XTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFycyB0aGUgY2hvc2VuIG5vZGVcbiAgICAgKi9cbiAgICByZXNldENob3Nlbk5vZGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2hvc2VuTm9kZSA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSXQgZmlsdGVycyBhbmQgZW1pdCB0aGUgc2VsZWN0aW9uIGNvbWluZyBmcm9tIHRoZSBkb2N1bWVudCBsaXN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbm9kZXNFbnRyaWVzXG4gICAgICovXG4gICAgb25DdXJyZW50U2VsZWN0aW9uKG5vZGVzRW50cmllczogTm9kZUVudHJ5W10pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgdmFsaWROb2Rlc0VudGl0eSA9IG5vZGVzRW50cmllcy5maWx0ZXIoKG5vZGUpID0+IHRoaXMuaXNTZWxlY3Rpb25WYWxpZChub2RlLmVudHJ5KSk7XG4gICAgICAgIHRoaXMuY2hvc2VuTm9kZSA9IHZhbGlkTm9kZXNFbnRpdHkubWFwKChub2RlKSA9PiBub2RlLmVudHJ5KTtcbiAgICB9XG5cbiAgICBzZXRUaXRsZUlmQ3VzdG9tU2l0ZShzaXRlOiBTaXRlRW50cnkpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tUmVzb3VyY2VzU2VydmljZS5pc0N1c3RvbVNvdXJjZShzaXRlLmVudHJ5Lmd1aWQpKSB7XG4gICAgICAgICAgICB0aGlzLmJyZWFkY3J1bWJGb2xkZXJUaXRsZSA9IHNpdGUuZW50cnkudGl0bGU7XG4gICAgICAgICAgICBpZiAodGhpcy5kb2N1bWVudExpc3QuZm9sZGVyTm9kZS5wYXRoLmVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5icmVhZGNydW1iRm9sZGVyTm9kZS5uYW1lID0gc2l0ZS5lbnRyeS50aXRsZTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50TGlzdC5mb2xkZXJOb2RlLnBhdGguZWxlbWVudHMgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5icmVhZGNydW1iRm9sZGVyVGl0bGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzUHJlc2VsZWN0Tm9kZXMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXNlbGVjdGVkTm9kZXM/Lmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgaXNTaW5nbGVTZWxlY3Rpb25Nb2RlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25Nb2RlID09PSAnc2luZ2xlJztcbiAgICB9XG5cbiAgICBnZXRQcmVzZWxlY3ROb2Rlc0Jhc2VkT25TZWxlY3Rpb25Nb2RlKCk6IE5vZGVFbnRyeVtdIHtcbiAgICAgICAgbGV0IHNlbGVjdGVkTm9kZXM6IE5vZGVFbnRyeVtdID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFVwbG9hZEJhdGNoPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU2luZ2xlU2VsZWN0aW9uTW9kZSgpKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWROb2RlcyA9IFt0aGlzLmN1cnJlbnRVcGxvYWRCYXRjaFt0aGlzLmN1cnJlbnRVcGxvYWRCYXRjaC5sZW5ndGggLSAxXV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkTm9kZXMgPSB0aGlzLmN1cnJlbnRVcGxvYWRCYXRjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZWxlY3RlZE5vZGVzO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzZXRQYWdpbmF0aW9uKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UucGFnaW5nID0ge1xuICAgICAgICAgICAgbWF4SXRlbXM6IHRoaXMucGFnZVNpemUsXG4gICAgICAgICAgICBza2lwQ291bnQ6IHRoaXMuREVGQVVMVF9QQUdJTkFUSU9OLnNraXBDb3VudFxuICAgICAgICB9O1xuICAgIH1cbn1cbiJdfQ==