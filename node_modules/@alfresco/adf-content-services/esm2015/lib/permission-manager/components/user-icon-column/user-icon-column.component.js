/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { NodeEntry } from '@alfresco/js-api';
import { Component, Input } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { NodePermissionService } from '../../services/node-permission.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/node-permission.service';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@angular/material/icon';
import * as ɵngcc4 from '@alfresco/adf-core';

function UserIconColumnComponent_div_0_ng_container_1_mat_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-icon", 5);
    ɵngcc0.ɵɵtext(1, "people_alt_outline");
    ɵngcc0.ɵɵelementEnd();
} }
function UserIconColumnComponent_div_0_ng_container_1_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 6);
    ɵngcc0.ɵɵpipe(1, "usernameInitials");
} if (rf & 2) {
    const user_r3 = ɵngcc0.ɵɵnextContext().ngIf;
    ɵngcc0.ɵɵproperty("outerHTML", ɵngcc0.ɵɵpipeBind2(1, 1, user_r3, "adf-people-initial"), ɵngcc0.ɵɵsanitizeHtml);
} }
function UserIconColumnComponent_div_0_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, UserIconColumnComponent_div_0_ng_container_1_mat_icon_1_Template, 2, 0, "mat-icon", 3);
    ɵngcc0.ɵɵtemplate(2, UserIconColumnComponent_div_0_ng_container_1_div_2_Template, 2, 4, "div", 4);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.group);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.group);
} }
function UserIconColumnComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 1);
    ɵngcc0.ɵɵtemplate(1, UserIconColumnComponent_div_0_ng_container_1_Template, 3, 2, "ng-container", 2);
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵattribute("id", ctx_r0.group ? "group-icon" : "person-icon");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(2, 2, ctx_r0.displayText$));
} }
function UserIconColumnComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 1);
    ɵngcc0.ɵɵelement(1, "mat-icon", 7);
    ɵngcc0.ɵɵelementEnd();
} }
export class UserIconColumnComponent {
    constructor(nodePermissionService) {
        this.nodePermissionService = nodePermissionService;
        this.selected = false;
        this.displayText$ = new BehaviorSubject(null);
        this.group = false;
    }
    get isSelected() {
        var _a, _b;
        return ((_b = (_a = this.context) === null || _a === void 0 ? void 0 : _a.row) === null || _b === void 0 ? void 0 : _b.isSelected) || this.selected;
    }
    ngOnInit() {
        var _a, _b;
        if (this.context) {
            const { person, group, authorityId } = (_b = (_a = this.context.row.obj) === null || _a === void 0 ? void 0 : _a.entry) !== null && _b !== void 0 ? _b : this.context.row.obj;
            this.group = this.isGroup(group, authorityId);
            this.displayText$.next(person || group || { displayName: authorityId });
        }
        if (this.node) {
            const { person, group } = this.nodePermissionService.transformNodeToUserPerson(this.node.entry);
            this.group = this.isGroup(group, null);
            this.displayText$.next(person || group);
        }
    }
    isGroup(group, authorityId) {
        return !!group || (authorityId === null || authorityId === void 0 ? void 0 : authorityId.startsWith('GROUP_')) || (authorityId === null || authorityId === void 0 ? void 0 : authorityId.startsWith('ROLE_'));
    }
}
UserIconColumnComponent.ɵfac = function UserIconColumnComponent_Factory(t) { return new (t || UserIconColumnComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.NodePermissionService)); };
UserIconColumnComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: UserIconColumnComponent, selectors: [["adf-user-icon-column"]], hostAttrs: [1, "adf-user-icon-column", "adf-datatable-content-cell"], inputs: { selected: "selected", context: "context", node: "node" }, decls: 2, vars: 2, consts: [["class", "adf-cell-value", 4, "ngIf"], [1, "adf-cell-value"], [4, "ngIf"], ["class", "adf-group-icon", 4, "ngIf"], [3, "outerHTML", 4, "ngIf"], [1, "adf-group-icon"], [3, "outerHTML"], ["svgIcon", "selected", 1, "adf-people-select-icon", "adf-datatable-selected"]], template: function UserIconColumnComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, UserIconColumnComponent_div_0_Template, 3, 4, "div", 0);
        ɵngcc0.ɵɵtemplate(1, UserIconColumnComponent_div_1_Template, 2, 0, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.isSelected);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isSelected);
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.MatIcon], pipes: [ɵngcc2.AsyncPipe, ɵngcc4.InitialUsernamePipe], encapsulation: 2 });
UserIconColumnComponent.ctorParameters = () => [
    { type: NodePermissionService }
];
UserIconColumnComponent.propDecorators = {
    context: [{ type: Input }],
    node: [{ type: Input }],
    selected: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UserIconColumnComponent, [{
        type: Component,
        args: [{
                selector: 'adf-user-icon-column',
                template: `
        <div class="adf-cell-value" [attr.id]="group ? 'group-icon' : 'person-icon'"  *ngIf="!isSelected">
            <ng-container *ngIf="displayText$ | async as user">
                <mat-icon *ngIf="group" class="adf-group-icon">people_alt_outline</mat-icon>
                <div *ngIf="!group" [outerHTML]="user | usernameInitials: 'adf-people-initial'"></div>
            </ng-container>
        </div>
        <div class="adf-cell-value" *ngIf="isSelected">
            <mat-icon class="adf-people-select-icon adf-datatable-selected" svgIcon="selected"></mat-icon>
        </div>
    `,
                host: { class: 'adf-user-icon-column adf-datatable-content-cell' }
            }]
    }], function () { return [{ type: ɵngcc1.NodePermissionService }]; }, { selected: [{
            type: Input
        }], context: [{
            type: Input
        }], node: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1pY29uLWNvbHVtbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy9saWIvcGVybWlzc2lvbi1tYW5hZ2VyL2NvbXBvbmVudHMvdXNlci1pY29uLWNvbHVtbi91c2VyLWljb24tY29sdW1uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBR0gsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUIvRSxNQUFNLE9BQU8sdUJBQXVCO0FBQUcsSUFpQm5DLFlBQW9CLHFCQUE0QztBQUFJLFFBQWhELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBdUI7QUFBQyxRQVRqRSxhQUFRLEdBQVksS0FBSyxDQUFDO0FBQzlCLFFBQ0ksaUJBQVksR0FBRyxJQUFJLGVBQWUsQ0FBTyxJQUFJLENBQUMsQ0FBQztBQUNuRCxRQUFJLFVBQUssR0FBRyxLQUFLLENBQUM7QUFDbEIsSUFLdUUsQ0FBQztBQUN4RSxJQUxJLElBQUksVUFBVTtBQUFLO0FBQ1osUUFBSCxPQUFPLGFBQUEsSUFBSSxDQUFDLE9BQU8sMENBQUUsR0FBRywwQ0FBRSxVQUFVLEtBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQztBQUM5RCxJQUFJLENBQUM7QUFDTCxJQUdJLFFBQVE7QUFDWjtBQUFvQixRQUFaLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtBQUMxQixZQUFZLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxlQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsMENBQUUsS0FBSyxtQ0FBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7QUFDdkcsWUFBWSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQzFELFlBQVksSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLEtBQUssSUFBSSxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0FBQ3BGLFNBQVM7QUFDVCxRQUNRLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtBQUN2QixZQUFZLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUcsWUFBWSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ25ELFlBQVksSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxDQUFDO0FBQ3BELFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDTCxJQUNZLE9BQU8sQ0FBQyxLQUFLLEVBQUUsV0FBVztBQUFJLFFBQ2xDLE9BQU8sQ0FBQyxDQUFDLEtBQUssS0FBSSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsVUFBVSxDQUFDLFFBQVEsRUFBQyxLQUFJLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxVQUFVLENBQUMsT0FBTyxFQUFDLENBQUM7QUFDaEcsSUFBSSxDQUFDO0FBQ0w7bURBbkRDLFNBQVMsU0FBQyxrQkFDUCxRQUFRLEVBQUUsc0JBQXNCLGtCQUNoQyxRQUFRLEVBQUU7bWpCQVVULGtCQUNELElBQUksRUFBRSxFQUFFLEtBQUssRUFBRTtPQUFpRCxFQUFFLGNBQ3JFOzs7Ozs7K0hBQ0k7QUFBQztBQUFpRCxZQWpCOUMscUJBQXFCO0FBQUc7QUFBRztBQUEyQyxzQkFrQjFFLEtBQUs7QUFDUixtQkFFRyxLQUFLO0FBQ1IsdUJBRUcsS0FBSztBQUNUOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IFVzZXIgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgTm9kZUVudHJ5IH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTm9kZVBlcm1pc3Npb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbm9kZS1wZXJtaXNzaW9uLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi11c2VyLWljb24tY29sdW1uJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWRmLWNlbGwtdmFsdWVcIiBbYXR0ci5pZF09XCJncm91cCA/ICdncm91cC1pY29uJyA6ICdwZXJzb24taWNvbidcIiAgKm5nSWY9XCIhaXNTZWxlY3RlZFwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImRpc3BsYXlUZXh0JCB8IGFzeW5jIGFzIHVzZXJcIj5cbiAgICAgICAgICAgICAgICA8bWF0LWljb24gKm5nSWY9XCJncm91cFwiIGNsYXNzPVwiYWRmLWdyb3VwLWljb25cIj5wZW9wbGVfYWx0X291dGxpbmU8L21hdC1pY29uPlxuICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCIhZ3JvdXBcIiBbb3V0ZXJIVE1MXT1cInVzZXIgfCB1c2VybmFtZUluaXRpYWxzOiAnYWRmLXBlb3BsZS1pbml0aWFsJ1wiPjwvZGl2PlxuICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWRmLWNlbGwtdmFsdWVcIiAqbmdJZj1cImlzU2VsZWN0ZWRcIj5cbiAgICAgICAgICAgIDxtYXQtaWNvbiBjbGFzcz1cImFkZi1wZW9wbGUtc2VsZWN0LWljb24gYWRmLWRhdGF0YWJsZS1zZWxlY3RlZFwiIHN2Z0ljb249XCJzZWxlY3RlZFwiPjwvbWF0LWljb24+XG4gICAgICAgIDwvZGl2PlxuICAgIGAsXG4gICAgaG9zdDogeyBjbGFzczogJ2FkZi11c2VyLWljb24tY29sdW1uIGFkZi1kYXRhdGFibGUtY29udGVudC1jZWxsJyB9XG59KVxuZXhwb3J0IGNsYXNzIFVzZXJJY29uQ29sdW1uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBASW5wdXQoKVxuICAgIGNvbnRleHQ6IGFueTtcblxuICAgIEBJbnB1dCgpXG4gICAgbm9kZTogTm9kZUVudHJ5O1xuXG4gICAgQElucHV0KClcbiAgICBzZWxlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgZGlzcGxheVRleHQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxVc2VyPihudWxsKTtcbiAgICBncm91cCA9IGZhbHNlO1xuXG4gICAgZ2V0IGlzU2VsZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRleHQ/LnJvdz8uaXNTZWxlY3RlZCB8fCB0aGlzLnNlbGVjdGVkO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbm9kZVBlcm1pc3Npb25TZXJ2aWNlOiBOb2RlUGVybWlzc2lvblNlcnZpY2UpIHt9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGV4dCkge1xuICAgICAgICAgICAgY29uc3QgeyBwZXJzb24sIGdyb3VwLCBhdXRob3JpdHlJZCB9ID0gdGhpcy5jb250ZXh0LnJvdy5vYmo/LmVudHJ5ID8/IHRoaXMuY29udGV4dC5yb3cub2JqO1xuICAgICAgICAgICAgdGhpcy5ncm91cCA9IHRoaXMuaXNHcm91cChncm91cCwgYXV0aG9yaXR5SWQpO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5VGV4dCQubmV4dChwZXJzb24gfHwgZ3JvdXAgfHwgeyBkaXNwbGF5TmFtZTogYXV0aG9yaXR5SWQgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5ub2RlKSB7XG4gICAgICAgICAgICBjb25zdCB7IHBlcnNvbiwgZ3JvdXAgfSA9IHRoaXMubm9kZVBlcm1pc3Npb25TZXJ2aWNlLnRyYW5zZm9ybU5vZGVUb1VzZXJQZXJzb24odGhpcy5ub2RlLmVudHJ5KTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXAgPSB0aGlzLmlzR3JvdXAoZ3JvdXAsIG51bGwpO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5VGV4dCQubmV4dChwZXJzb24gfHwgZ3JvdXApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0dyb3VwKGdyb3VwLCBhdXRob3JpdHlJZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISFncm91cCB8fCBhdXRob3JpdHlJZD8uc3RhcnRzV2l0aCgnR1JPVVBfJykgfHwgYXV0aG9yaXR5SWQ/LnN0YXJ0c1dpdGgoJ1JPTEVfJyk7XG4gICAgfVxufVxuIl19