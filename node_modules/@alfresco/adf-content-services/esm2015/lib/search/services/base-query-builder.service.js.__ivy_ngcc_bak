import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { Subject, from, ReplaySubject } from 'rxjs';
import { AlfrescoApiService, AppConfigService } from '@alfresco/adf-core';
import { RequestSortDefinitionInner } from '@alfresco/js-api';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
export class BaseQueryBuilderService {
    constructor(appConfig, alfrescoApiService) {
        this.appConfig = appConfig;
        this.alfrescoApiService = alfrescoApiService;
        this.configUpdated = new Subject();
        this.updated = new Subject();
        this.executed = new Subject();
        this.error = new Subject();
        this.searchForms = new ReplaySubject(1);
        this.categories = [];
        this.queryFragments = {};
        this.filterQueries = [];
        this.paging = null;
        this.sorting = [];
        this.sortingOptions = [];
        this._userQuery = '';
        this.userFacetBuckets = {};
        this.config = {
            categories: []
        };
        this.ranges = {};
        this.resetToDefaults();
    }
    get userQuery() {
        return this._userQuery;
    }
    set userQuery(value) {
        value = (value || '').trim();
        this._userQuery = value ? `(${value})` : '';
    }
    resetToDefaults() {
        const currentConfig = this.getDefaultConfiguration();
        this.resetSearchOptions();
        this.configUpdated.next(currentConfig);
        this.searchForms.next(this.getSearchFormDetails());
        this.setUpSearchConfiguration(currentConfig);
    }
    getDefaultConfiguration() {
        const configurations = this.loadConfiguration();
        if (this.selectedConfiguration !== undefined) {
            return configurations[this.selectedConfiguration];
        }
        if (Array.isArray(configurations)) {
            return configurations.find((configuration) => configuration.default);
        }
        return configurations;
    }
    updateSelectedConfiguration(index) {
        const currentConfig = this.loadConfiguration();
        if (Array.isArray(currentConfig) && currentConfig[index] !== undefined) {
            this.selectedConfiguration = index;
            this.configUpdated.next(currentConfig[index]);
            this.searchForms.next(this.getSearchFormDetails());
            this.resetSearchOptions();
            this.setUpSearchConfiguration(currentConfig[index]);
            this.update();
        }
    }
    resetSearchOptions() {
        this.categories = [];
        this.queryFragments = {};
        this.filterQueries = [];
        this.sorting = [];
        this.sortingOptions = [];
        this.userFacetBuckets = {};
        this.scope = null;
    }
    getSearchFormDetails() {
        const configurations = this.loadConfiguration();
        if (Array.isArray(configurations)) {
            return configurations.map((configuration, index) => ({
                index,
                name: configuration.name || 'SEARCH.UNKNOWN_CONFIGURATION',
                default: configuration.default || false,
                selected: this.selectedConfiguration !== undefined ? index === this.selectedConfiguration : configuration.default
            }));
        }
        else if (!!configurations) {
            return [{ index: 0, name: configurations.name || 'SEARCH.UNKNOWN_CONFIGURATION', default: true, selected: true }];
        }
        return [];
    }
    setUpSearchConfiguration(currentConfiguration) {
        if (currentConfiguration) {
            this.config = JSON.parse(JSON.stringify(currentConfiguration));
            this.categories = (this.config.categories || []).filter(category => category.enabled);
            this.filterQueries = this.config.filterQueries || [];
            this.userFacetBuckets = {};
            if (this.config.sorting) {
                this.sorting = this.config.sorting.defaults || [];
                this.sortingOptions = this.config.sorting.options || [];
            }
        }
    }
    addUserFacetBucket(field, bucket) {
        if (field && field.field && bucket) {
            const buckets = this.userFacetBuckets[field.field] || [];
            const existing = buckets.find((facetBucket) => facetBucket.label === bucket.label);
            if (!existing) {
                buckets.push(bucket);
            }
            this.userFacetBuckets[field.field] = buckets;
        }
    }
    getUserFacetBuckets(field) {
        return this.userFacetBuckets[field] || [];
    }
    removeUserFacetBucket(field, bucket) {
        if (field && field.field && bucket) {
            const buckets = this.userFacetBuckets[field.field] || [];
            this.userFacetBuckets[field.field] = buckets
                .filter((facetBucket) => facetBucket.label !== bucket.label);
        }
    }
    addFilterQuery(query) {
        if (query) {
            const existing = this.filterQueries.find((filterQuery) => filterQuery.query === query);
            if (!existing) {
                this.filterQueries.push({ query: query });
            }
        }
    }
    removeFilterQuery(query) {
        if (query) {
            this.filterQueries = this.filterQueries
                .filter((filterQuery) => filterQuery.query !== query);
        }
    }
    getFacetQuery(label) {
        if (label && this.hasFacetQueries) {
            const result = this.config.facetQueries.queries.find((query) => query.label === label);
            if (result) {
                return Object.assign({}, result);
            }
        }
        return null;
    }
    getFacetField(label) {
        if (label) {
            const fields = this.config.facetFields.fields || [];
            const result = fields.find((field) => field.label === label);
            if (result) {
                result.label = this.getSupportedLabel(result.label);
                return Object.assign({}, result);
            }
        }
        return null;
    }
    setScope(scope) {
        this.scope = scope;
    }
    getScope() {
        return this.scope;
    }
    update(queryBody) {
        const query = queryBody ? queryBody : this.buildQuery();
        this.updated.next(query);
    }
    execute(queryBody) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const query = queryBody ? queryBody : this.buildQuery();
                if (query) {
                    const resultSetPaging = yield this.alfrescoApiService.getInstance().search.searchApi.search(query);
                    this.executed.next(resultSetPaging);
                }
            }
            catch (error) {
                this.error.next(error);
                this.executed.next({
                    list: {
                        pagination: {
                            totalItems: 0
                        },
                        entries: []
                    }
                });
            }
        });
    }
    search(queryBody) {
        const promise = this.alfrescoApiService.searchApi.search(queryBody);
        promise.then((resultSetPaging) => {
            this.executed.next(resultSetPaging);
        });
        return from(promise);
    }
    buildQuery() {
        const query = this.getFinalQuery();
        const include = this.config.include || [];
        if (include.length === 0) {
            include.push('path', 'allowableOperations');
        }
        if (query) {
            const result = {
                query: {
                    query: query,
                    language: 'afts'
                },
                include: include,
                paging: this.paging,
                fields: this.config.fields,
                filterQueries: this.filterQueries,
                facetQueries: this.facetQueries,
                facetIntervals: this.facetIntervals,
                facetFields: this.facetFields,
                sort: this.sort,
                highlight: this.highlight
            };
            if (this.scope) {
                result['scope'] = this.scope;
            }
            result['facetFormat'] = 'V2';
            return result;
        }
        return null;
    }
    getPrimarySorting() {
        if (this.sorting && this.sorting.length > 0) {
            return this.sorting[0];
        }
        return null;
    }
    getSortingOptions() {
        if (this.config && this.config.sorting) {
            return this.config.sorting.options || [];
        }
        return [];
    }
    getQueryGroup(query) {
        return query.group || this.config.facetQueries.label || 'Facet Queries';
    }
    get hasFacetQueries() {
        if (this.config
            && this.config.facetQueries
            && this.config.facetQueries.queries
            && this.config.facetQueries.queries.length > 0) {
            return true;
        }
        return false;
    }
    get hasFacetIntervals() {
        return this.config
            && this.config.facetIntervals
            && this.config.facetIntervals.intervals
            && this.config.facetIntervals.intervals.length > 0;
    }
    get hasFacetHighlight() {
        return this.config && this.config.highlight ? true : false;
    }
    get sort() {
        return this.sorting.map((def) => {
            return new RequestSortDefinitionInner({
                type: def.type,
                field: def.field,
                ascending: def.ascending
            });
        });
    }
    get facetQueries() {
        if (this.hasFacetQueries) {
            return this.config.facetQueries.queries.map((query) => {
                query.group = this.getQueryGroup(query);
                return Object.assign({}, query);
            });
        }
        return null;
    }
    get facetIntervals() {
        if (this.hasFacetIntervals) {
            const configIntervals = this.config.facetIntervals;
            return {
                intervals: configIntervals.intervals.map((interval) => ({
                    label: this.getSupportedLabel(interval.label),
                    field: interval.field,
                    sets: interval.sets.map((set) => ({
                        label: this.getSupportedLabel(set.label),
                        start: set.start,
                        end: set.end,
                        startInclusive: set.startInclusive,
                        endInclusive: set.endInclusive
                    }))
                }))
            };
        }
        return null;
    }
    get highlight() {
        return this.hasFacetHighlight ? this.config.highlight : null;
    }
    getFinalQuery() {
        let query = '';
        this.categories.forEach((facet) => {
            const customQuery = this.queryFragments[facet.id];
            if (customQuery) {
                if (query.length > 0) {
                    query += ' AND ';
                }
                query += `(${customQuery})`;
            }
        });
        let result = [this.userQuery, query]
            .filter((entry) => entry)
            .join(' AND ');
        if (this.userFacetBuckets) {
            Object.keys(this.userFacetBuckets).forEach((key) => {
                const subQuery = (this.userFacetBuckets[key] || [])
                    .filter((bucket) => bucket.filterQuery)
                    .map((bucket) => bucket.filterQuery)
                    .join(' OR ');
                if (subQuery) {
                    if (result.length > 0) {
                        result += ' AND ';
                    }
                    result += `(${subQuery})`;
                }
            });
        }
        return result;
    }
    get facetFields() {
        const facetFields = this.config.facetFields && this.config.facetFields.fields;
        if (facetFields && facetFields.length > 0) {
            return {
                facets: facetFields.map((facet) => ({
                    field: facet.field,
                    mincount: facet.mincount,
                    label: this.getSupportedLabel(facet.label),
                    limit: facet.limit,
                    offset: facet.offset,
                    prefix: facet.prefix
                }))
            };
        }
        return null;
    }
    getSupportedLabel(configLabel) {
        const spaceInsideLabelIndex = configLabel.search(/\s/g);
        if (spaceInsideLabelIndex > -1) {
            return `"${configLabel}"`;
        }
        return configLabel;
    }
}
BaseQueryBuilderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function BaseQueryBuilderService_Factory() { return new BaseQueryBuilderService(i0.ɵɵinject(i1.AppConfigService), i0.ɵɵinject(i1.AlfrescoApiService)); }, token: BaseQueryBuilderService, providedIn: "root" });
BaseQueryBuilderService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
BaseQueryBuilderService.ctorParameters = () => [
    { type: AppConfigService },
    { type: AlfrescoApiService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1xdWVyeS1idWlsZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9zZWFyY2gvc2VydmljZXMvYmFzZS1xdWVyeS1idWlsZGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQWMsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBSUgsMEJBQTBCLEVBSTdCLE1BQU0sa0JBQWtCLENBQUM7OztBQWMxQixNQUFNLE9BQWdCLHVCQUF1QjtJQTZDekMsWUFBc0IsU0FBMkIsRUFBWSxrQkFBc0M7UUFBN0UsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFBWSx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBMUNuRyxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUF1QixDQUFDO1FBR25ELFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBYSxDQUFDO1FBR25DLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBbUIsQ0FBQztRQUcxQyxVQUFLLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUd0QixnQkFBVyxHQUFHLElBQUksYUFBYSxDQUFlLENBQUMsQ0FBQyxDQUFDO1FBRWpELGVBQVUsR0FBcUIsRUFBRSxDQUFDO1FBQ2xDLG1CQUFjLEdBQTZCLEVBQUUsQ0FBQztRQUM5QyxrQkFBYSxHQUFrQixFQUFFLENBQUM7UUFDbEMsV0FBTSxHQUE4QyxJQUFJLENBQUM7UUFDekQsWUFBTyxHQUE4QixFQUFFLENBQUM7UUFDeEMsbUJBQWMsR0FB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QixnQkFBZ0I7WUFBcEMsa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSwgZnJvbSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlLCBBcHBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7XG4gICAgUXVlcnlCb2R5LFxuICAgIFJlcXVlc3RGYWNldEZpZWxkcyxcbiAgICBSZXF1ZXN0RmFjZXRGaWVsZCxcbiAgICBSZXF1ZXN0U29ydERlZmluaXRpb25Jbm5lcixcbiAgICBSZXN1bHRTZXRQYWdpbmcsXG4gICAgUmVxdWVzdEhpZ2hsaWdodCxcbiAgICBSZXF1ZXN0U2NvcGVcbn0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBTZWFyY2hDYXRlZ29yeSB9IGZyb20gJy4uL21vZGVscy9zZWFyY2gtY2F0ZWdvcnkuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZpbHRlclF1ZXJ5IH0gZnJvbSAnLi4vbW9kZWxzL2ZpbHRlci1xdWVyeS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoUmFuZ2UgfSBmcm9tICcuLi9tb2RlbHMvc2VhcmNoLXJhbmdlLmludGVyZmFjZSc7XG5pbXBvcnQgeyBTZWFyY2hDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC1jb25maWd1cmF0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBGYWNldFF1ZXJ5IH0gZnJvbSAnLi4vbW9kZWxzL2ZhY2V0LXF1ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBTZWFyY2hTb3J0aW5nRGVmaW5pdGlvbiB9IGZyb20gJy4uL21vZGVscy9zZWFyY2gtc29ydGluZy1kZWZpbml0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBGYWNldEZpZWxkIH0gZnJvbSAnLi4vbW9kZWxzL2ZhY2V0LWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBGYWNldEZpZWxkQnVja2V0IH0gZnJvbSAnLi4vbW9kZWxzL2ZhY2V0LWZpZWxkLWJ1Y2tldC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoRm9ybSB9IGZyb20gJy4uL21vZGVscy9zZWFyY2gtZm9ybS5pbnRlcmZhY2UnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VRdWVyeUJ1aWxkZXJTZXJ2aWNlIHtcblxuICAgIC8qICBTdHJlYW0gdGhhdCBlbWl0cyB0aGUgc2VhcmNoIGNvbmZpZ3VyYXRpb24gd2hlbmV2ZXIgdGhlIHVzZXIgY2hhbmdlIHRoZSBzZWFyY2ggZm9ybXMgKi9cbiAgICBjb25maWdVcGRhdGVkID0gbmV3IFN1YmplY3Q8U2VhcmNoQ29uZmlndXJhdGlvbj4oKTtcblxuICAgIC8qICBTdHJlYW0gdGhhdCBlbWl0cyB0aGUgcXVlcnkgYmVmb3JlIHNlYXJjaCB3aGVuZXZlciB1c2VyIHNlYXJjaCAgKi9cbiAgICB1cGRhdGVkID0gbmV3IFN1YmplY3Q8UXVlcnlCb2R5PigpO1xuXG4gICAgLyogIFN0cmVhbSB0aGF0IGVtaXRzIHRoZSByZXN1bHRzIHdoZW5ldmVyIHVzZXIgc2VhcmNoICAqL1xuICAgIGV4ZWN1dGVkID0gbmV3IFN1YmplY3Q8UmVzdWx0U2V0UGFnaW5nPigpO1xuXG4gICAgLyogIFN0cmVhbSB0aGF0IGVtaXRzIHRoZSBlcnJvciB3aGVuZXZlciB1c2VyIHNlYXJjaCAgKi9cbiAgICBlcnJvciA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICAvKiAgU3RyZWFtIHRoYXQgZW1pdHMgc2VhcmNoIGZvcm1zICAqL1xuICAgIHNlYXJjaEZvcm1zID0gbmV3IFJlcGxheVN1YmplY3Q8U2VhcmNoRm9ybVtdPigxKTtcblxuICAgIGNhdGVnb3JpZXM6IFNlYXJjaENhdGVnb3J5W10gPSBbXTtcbiAgICBxdWVyeUZyYWdtZW50czogeyBbaWQ6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG4gICAgZmlsdGVyUXVlcmllczogRmlsdGVyUXVlcnlbXSA9IFtdO1xuICAgIHBhZ2luZzogeyBtYXhJdGVtcz86IG51bWJlcjsgc2tpcENvdW50PzogbnVtYmVyIH0gPSBudWxsO1xuICAgIHNvcnRpbmc6IFNlYXJjaFNvcnRpbmdEZWZpbml0aW9uW10gPSBbXTtcbiAgICBzb3J0aW5nT3B0aW9uczogU2VhcmNoU29ydGluZ0RlZmluaXRpb25bXSA9IFtdO1xuICAgIHByaXZhdGUgc2NvcGU6IFJlcXVlc3RTY29wZTtcbiAgICBwcml2YXRlIHNlbGVjdGVkQ29uZmlndXJhdGlvbjogbnVtYmVyO1xuICAgIHByaXZhdGUgX3VzZXJRdWVyeSA9ICcnO1xuXG4gICAgcHJvdGVjdGVkIHVzZXJGYWNldEJ1Y2tldHM6IHsgW2tleTogc3RyaW5nXTogRmFjZXRGaWVsZEJ1Y2tldFtdIH0gPSB7fTtcblxuICAgIGdldCB1c2VyUXVlcnkoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJRdWVyeTtcbiAgICB9XG5cbiAgICBzZXQgdXNlclF1ZXJ5KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdmFsdWUgPSAodmFsdWUgfHwgJycpLnRyaW0oKTtcbiAgICAgICAgdGhpcy5fdXNlclF1ZXJ5ID0gdmFsdWUgPyBgKCR7dmFsdWV9KWAgOiAnJztcbiAgICB9XG5cbiAgICBjb25maWc6IFNlYXJjaENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgIGNhdGVnb3JpZXM6IFtdXG4gICAgfTtcblxuICAgIC8vIFRPRE86IHRvIGJlIHN1cHBvcnRlZCBpbiBmdXR1cmUgaXRlcmF0aW9uc1xuICAgIHJhbmdlczogeyBbaWQ6IHN0cmluZ106IFNlYXJjaFJhbmdlIH0gPSB7fTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UsIHByb3RlY3RlZCBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSkge1xuICAgICAgICB0aGlzLnJlc2V0VG9EZWZhdWx0cygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhYnN0cmFjdCBsb2FkQ29uZmlndXJhdGlvbigpOiBTZWFyY2hDb25maWd1cmF0aW9uIHwgU2VhcmNoQ29uZmlndXJhdGlvbltdO1xuXG4gICAgcHVibGljIGFic3RyYWN0IGlzRmlsdGVyU2VydmljZUFjdGl2ZSgpOiBib29sZWFuO1xuXG4gICAgcHVibGljIHJlc2V0VG9EZWZhdWx0cygpIHtcbiAgICAgICAgY29uc3QgY3VycmVudENvbmZpZyA9IHRoaXMuZ2V0RGVmYXVsdENvbmZpZ3VyYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZXNldFNlYXJjaE9wdGlvbnMoKTtcbiAgICAgICAgdGhpcy5jb25maWdVcGRhdGVkLm5leHQoY3VycmVudENvbmZpZyk7XG4gICAgICAgIHRoaXMuc2VhcmNoRm9ybXMubmV4dCh0aGlzLmdldFNlYXJjaEZvcm1EZXRhaWxzKCkpO1xuICAgICAgICB0aGlzLnNldFVwU2VhcmNoQ29uZmlndXJhdGlvbihjdXJyZW50Q29uZmlnKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RGVmYXVsdENvbmZpZ3VyYXRpb24oKTogU2VhcmNoQ29uZmlndXJhdGlvbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ3VyYXRpb25zID0gdGhpcy5sb2FkQ29uZmlndXJhdGlvbigpO1xuXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkQ29uZmlndXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbnNbdGhpcy5zZWxlY3RlZENvbmZpZ3VyYXRpb25dO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlndXJhdGlvbnMpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbnMuZmluZCgoY29uZmlndXJhdGlvbikgPT4gY29uZmlndXJhdGlvbi5kZWZhdWx0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbnM7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZVNlbGVjdGVkQ29uZmlndXJhdGlvbihpbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSB0aGlzLmxvYWRDb25maWd1cmF0aW9uKCk7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1cnJlbnRDb25maWcpICYmIGN1cnJlbnRDb25maWdbaW5kZXhdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDb25maWd1cmF0aW9uID0gaW5kZXg7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ1VwZGF0ZWQubmV4dChjdXJyZW50Q29uZmlnW2luZGV4XSk7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEZvcm1zLm5leHQodGhpcy5nZXRTZWFyY2hGb3JtRGV0YWlscygpKTtcbiAgICAgICAgICAgIHRoaXMucmVzZXRTZWFyY2hPcHRpb25zKCk7XG4gICAgICAgICAgICB0aGlzLnNldFVwU2VhcmNoQ29uZmlndXJhdGlvbihjdXJyZW50Q29uZmlnW2luZGV4XSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldFNlYXJjaE9wdGlvbnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2F0ZWdvcmllcyA9IFtdO1xuICAgICAgICB0aGlzLnF1ZXJ5RnJhZ21lbnRzID0ge307XG4gICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcyA9IFtdO1xuICAgICAgICB0aGlzLnNvcnRpbmcgPSBbXTtcbiAgICAgICAgdGhpcy5zb3J0aW5nT3B0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnVzZXJGYWNldEJ1Y2tldHMgPSB7fTtcbiAgICAgICAgdGhpcy5zY29wZSA9IG51bGw7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFNlYXJjaEZvcm1EZXRhaWxzKCk6IFNlYXJjaEZvcm1bXSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ3VyYXRpb25zID0gdGhpcy5sb2FkQ29uZmlndXJhdGlvbigpO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWd1cmF0aW9ucykpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWd1cmF0aW9ucy5tYXAoKGNvbmZpZ3VyYXRpb24sIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICAgIG5hbWU6IGNvbmZpZ3VyYXRpb24ubmFtZSB8fCAnU0VBUkNILlVOS05PV05fQ09ORklHVVJBVElPTicsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogY29uZmlndXJhdGlvbi5kZWZhdWx0IHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkQ29uZmlndXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRDb25maWd1cmF0aW9uIDogY29uZmlndXJhdGlvbi5kZWZhdWx0XG4gICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBlbHNlIGlmICghIWNvbmZpZ3VyYXRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gW3sgaW5kZXg6IDAsIG5hbWU6IGNvbmZpZ3VyYXRpb25zLm5hbWUgfHwgJ1NFQVJDSC5VTktOT1dOX0NPTkZJR1VSQVRJT04nLCBkZWZhdWx0OiB0cnVlLCBzZWxlY3RlZDogdHJ1ZSB9XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRVcFNlYXJjaENvbmZpZ3VyYXRpb24oY3VycmVudENvbmZpZ3VyYXRpb246IFNlYXJjaENvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgaWYgKGN1cnJlbnRDb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY3VycmVudENvbmZpZ3VyYXRpb24pKTtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcmllcyA9ICh0aGlzLmNvbmZpZy5jYXRlZ29yaWVzIHx8IFtdKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnkgPT4gY2F0ZWdvcnkuZW5hYmxlZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcyA9IHRoaXMuY29uZmlnLmZpbHRlclF1ZXJpZXMgfHwgW107XG4gICAgICAgICAgICB0aGlzLnVzZXJGYWNldEJ1Y2tldHMgPSB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nID0gdGhpcy5jb25maWcuc29ydGluZy5kZWZhdWx0cyB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRpbmdPcHRpb25zID0gdGhpcy5jb25maWcuc29ydGluZy5vcHRpb25zIHx8IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGZhY2V0IGJ1Y2tldCB0byBhIGZpZWxkLlxuICAgICAqIEBwYXJhbSBmaWVsZCBUaGUgdGFyZ2V0IGZpZWxkXG4gICAgICogQHBhcmFtIGJ1Y2tldCBCdWNrZXQgdG8gYWRkXG4gICAgICovXG4gICAgYWRkVXNlckZhY2V0QnVja2V0KGZpZWxkOiBGYWNldEZpZWxkLCBidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpIHtcbiAgICAgICAgaWYgKGZpZWxkICYmIGZpZWxkLmZpZWxkICYmIGJ1Y2tldCkge1xuICAgICAgICAgICAgY29uc3QgYnVja2V0cyA9IHRoaXMudXNlckZhY2V0QnVja2V0c1tmaWVsZC5maWVsZF0gfHwgW107XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGJ1Y2tldHMuZmluZCgoZmFjZXRCdWNrZXQpID0+IGZhY2V0QnVja2V0LmxhYmVsID09PSBidWNrZXQubGFiZWwpO1xuICAgICAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgICAgIGJ1Y2tldHMucHVzaChidWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkLmZpZWxkXSA9IGJ1Y2tldHM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBidWNrZXRzIGN1cnJlbnRseSBhZGRlZCB0byBhIGZpZWxkXG4gICAgICogQHBhcmFtIGZpZWxkIFRoZSB0YXJnZXQgZmllbGRzXG4gICAgICogQHJldHVybnMgQnVja2V0IGFycmF5XG4gICAgICovXG4gICAgZ2V0VXNlckZhY2V0QnVja2V0cyhmaWVsZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVzZXJGYWNldEJ1Y2tldHNbZmllbGRdIHx8IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYW4gZXhpc3RpbmcgYnVja2V0IGZyb20gYSBmaWVsZC5cbiAgICAgKiBAcGFyYW0gZmllbGQgVGhlIHRhcmdldCBmaWVsZFxuICAgICAqIEBwYXJhbSBidWNrZXQgQnVja2V0IHRvIHJlbW92ZVxuICAgICAqL1xuICAgIHJlbW92ZVVzZXJGYWNldEJ1Y2tldChmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5maWVsZCAmJiBidWNrZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldHMgPSB0aGlzLnVzZXJGYWNldEJ1Y2tldHNbZmllbGQuZmllbGRdIHx8IFtdO1xuICAgICAgICAgICAgdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkLmZpZWxkXSA9IGJ1Y2tldHNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChmYWNldEJ1Y2tldCkgPT4gZmFjZXRCdWNrZXQubGFiZWwgIT09IGJ1Y2tldC5sYWJlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgZmlsdGVyIHF1ZXJ5IHRvIHRoZSBjdXJyZW50IHF1ZXJ5LlxuICAgICAqIEBwYXJhbSBxdWVyeSBRdWVyeSBzdHJpbmcgdG8gYWRkXG4gICAgICovXG4gICAgYWRkRmlsdGVyUXVlcnkocXVlcnk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5maWx0ZXJRdWVyaWVzLmZpbmQoKGZpbHRlclF1ZXJ5KSA9PiBmaWx0ZXJRdWVyeS5xdWVyeSA9PT0gcXVlcnkpO1xuICAgICAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcy5wdXNoKHsgcXVlcnk6IHF1ZXJ5IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbiBleGlzdGluZyBmaWx0ZXIgcXVlcnkuXG4gICAgICogQHBhcmFtIHF1ZXJ5IFRoZSBxdWVyeSB0byByZW1vdmVcbiAgICAgKi9cbiAgICByZW1vdmVGaWx0ZXJRdWVyeShxdWVyeTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJRdWVyaWVzID0gdGhpcy5maWx0ZXJRdWVyaWVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZmlsdGVyUXVlcnkpID0+IGZpbHRlclF1ZXJ5LnF1ZXJ5ICE9PSBxdWVyeSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgZmFjZXQgcXVlcnkgYnkgbGFiZWwuXG4gICAgICogQHBhcmFtIGxhYmVsIExhYmVsIG9mIHRoZSBxdWVyeVxuICAgICAqIEByZXR1cm5zIEZhY2V0IHF1ZXJ5IGRhdGFcbiAgICAgKi9cbiAgICBnZXRGYWNldFF1ZXJ5KGxhYmVsOiBzdHJpbmcpOiBGYWNldFF1ZXJ5IHtcbiAgICAgICAgaWYgKGxhYmVsICYmIHRoaXMuaGFzRmFjZXRRdWVyaWVzKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllcy5maW5kKChxdWVyeSkgPT4gcXVlcnkubGFiZWwgPT09IGxhYmVsKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgZmFjZXQgZmllbGQgYnkgbGFiZWwuXG4gICAgICogQHBhcmFtIGxhYmVsIExhYmVsIG9mIHRoZSBmYWNldCBmaWVsZFxuICAgICAqIEByZXR1cm5zIEZhY2V0IGZpZWxkIGRhdGFcbiAgICAgKi9cbiAgICBnZXRGYWNldEZpZWxkKGxhYmVsOiBzdHJpbmcpOiBGYWNldEZpZWxkIHtcbiAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmNvbmZpZy5mYWNldEZpZWxkcy5maWVsZHMgfHwgW107XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmaWVsZHMuZmluZCgoZmllbGQpID0+IGZpZWxkLmxhYmVsID09PSBsYWJlbCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmxhYmVsID0gdGhpcy5nZXRTdXBwb3J0ZWRMYWJlbChyZXN1bHQubGFiZWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHNldFNjb3BlKHNjb3BlOiBSZXF1ZXN0U2NvcGUpIHtcbiAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuICAgIH1cblxuICAgIGdldFNjb3BlKCk6IFJlcXVlc3RTY29wZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3BlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgY3VycmVudCBxdWVyeSBhbmQgdHJpZ2dlcnMgdGhlIGB1cGRhdGVkYCBldmVudC5cbiAgICAgKi9cbiAgICB1cGRhdGUocXVlcnlCb2R5PzogUXVlcnlCb2R5KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlCb2R5ID8gcXVlcnlCb2R5IDogdGhpcy5idWlsZFF1ZXJ5KCk7XG4gICAgICAgIHRoaXMudXBkYXRlZC5uZXh0KHF1ZXJ5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgYW5kIGV4ZWN1dGVzIHRoZSBjdXJyZW50IHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIE5vdGhpbmdcbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlKHF1ZXJ5Qm9keT86IFF1ZXJ5Qm9keSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBxdWVyeUJvZHkgPyBxdWVyeUJvZHkgOiB0aGlzLmJ1aWxkUXVlcnkoKTtcbiAgICAgICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdFNldFBhZ2luZzogUmVzdWx0U2V0UGFnaW5nID0gYXdhaXQgdGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5zZWFyY2guc2VhcmNoQXBpLnNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICAgICAgdGhpcy5leGVjdXRlZC5uZXh0KHJlc3VsdFNldFBhZ2luZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yLm5leHQoZXJyb3IpO1xuXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGVkLm5leHQoe1xuICAgICAgICAgICAgICAgIGxpc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxJdGVtczogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzOiBbXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VhcmNoKHF1ZXJ5Qm9keTogUXVlcnlCb2R5KTogT2JzZXJ2YWJsZTxSZXN1bHRTZXRQYWdpbmc+IHtcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLnNlYXJjaEFwaS5zZWFyY2gocXVlcnlCb2R5KTtcblxuICAgICAgICBwcm9taXNlLnRoZW4oKHJlc3VsdFNldFBhZ2luZykgPT4ge1xuICAgICAgICAgICAgdGhpcy5leGVjdXRlZC5uZXh0KHJlc3VsdFNldFBhZ2luZyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBmcm9tKHByb21pc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgY3VycmVudCBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyBUaGUgZmluaXNoZWQgcXVlcnlcbiAgICAgKi9cbiAgICBidWlsZFF1ZXJ5KCk6IFF1ZXJ5Qm9keSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5nZXRGaW5hbFF1ZXJ5KCk7XG5cbiAgICAgICAgY29uc3QgaW5jbHVkZSA9IHRoaXMuY29uZmlnLmluY2x1ZGUgfHwgW107XG4gICAgICAgIGlmIChpbmNsdWRlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaW5jbHVkZS5wdXNoKCdwYXRoJywgJ2FsbG93YWJsZU9wZXJhdGlvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChxdWVyeSkge1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQ6IFF1ZXJ5Qm9keSA9IDxRdWVyeUJvZHk+IHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAnYWZ0cydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IGluY2x1ZGUsXG4gICAgICAgICAgICAgICAgcGFnaW5nOiB0aGlzLnBhZ2luZyxcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHRoaXMuY29uZmlnLmZpZWxkcyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJRdWVyaWVzOiB0aGlzLmZpbHRlclF1ZXJpZXMsXG4gICAgICAgICAgICAgICAgZmFjZXRRdWVyaWVzOiB0aGlzLmZhY2V0UXVlcmllcyxcbiAgICAgICAgICAgICAgICBmYWNldEludGVydmFsczogdGhpcy5mYWNldEludGVydmFscyxcbiAgICAgICAgICAgICAgICBmYWNldEZpZWxkczogdGhpcy5mYWNldEZpZWxkcyxcbiAgICAgICAgICAgICAgICBzb3J0OiB0aGlzLnNvcnQsXG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0OiB0aGlzLmhpZ2hsaWdodFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbJ3Njb3BlJ10gPSB0aGlzLnNjb3BlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHRbJ2ZhY2V0Rm9ybWF0J10gPSAnVjInO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHByaW1hcnkgc29ydGluZyBkZWZpbml0aW9uLlxuICAgICAqIEByZXR1cm5zIFRoZSBwcmltYXJ5IHNvcnRpbmcgZGVmaW5pdGlvblxuICAgICAqL1xuICAgIGdldFByaW1hcnlTb3J0aW5nKCk6IFNlYXJjaFNvcnRpbmdEZWZpbml0aW9uIHtcbiAgICAgICAgaWYgKHRoaXMuc29ydGluZyAmJiB0aGlzLnNvcnRpbmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc29ydGluZ1swXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGFsbCBwcmUtY29uZmlndXJlZCBzb3J0aW5nIG9wdGlvbnMgdGhhdCB1c2VycyBjYW4gY2hvb3NlIGZyb20uXG4gICAgICogQHJldHVybnMgUHJlLWNvbmZpZ3VyZWQgc29ydGluZyBvcHRpb25zXG4gICAgICovXG4gICAgZ2V0U29ydGluZ09wdGlvbnMoKTogU2VhcmNoU29ydGluZ0RlZmluaXRpb25bXSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5zb3J0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuc29ydGluZy5vcHRpb25zIHx8IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBxdWVyeSBncm91cC5cbiAgICAgKiBAcGFyYW0gcXVlcnkgVGFyZ2V0IHF1ZXJ5XG4gICAgICogQHJldHVybnMgUXVlcnkgZ3JvdXBcbiAgICAgKi9cbiAgICBnZXRRdWVyeUdyb3VwKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBxdWVyeS5ncm91cCB8fCB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMubGFiZWwgfHwgJ0ZhY2V0IFF1ZXJpZXMnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBGYWNldFF1ZXJpZXMgaGFzIGJlZW4gZGVmaW5lZFxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgZGVmaW5lZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgZ2V0IGhhc0ZhY2V0UXVlcmllcygpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXNcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0UXVlcmllcy5xdWVyaWVzXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIEZhY2V0SW50ZXJ2YWxzIGhhcyBiZWVuIGRlZmluZWRcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIGRlZmluZWQsIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGdldCBoYXNGYWNldEludGVydmFscygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldEludGVydmFsc1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRJbnRlcnZhbHMuaW50ZXJ2YWxzXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldEludGVydmFscy5pbnRlcnZhbHMubGVuZ3RoID4gMDtcblxuICAgIH1cblxuICAgIGdldCBoYXNGYWNldEhpZ2hsaWdodCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmhpZ2hsaWdodCA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IHNvcnQoKTogUmVxdWVzdFNvcnREZWZpbml0aW9uSW5uZXJbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRpbmcubWFwKChkZWYpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVxdWVzdFNvcnREZWZpbml0aW9uSW5uZXIoe1xuICAgICAgICAgICAgICAgIHR5cGU6IGRlZi50eXBlLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBkZWYuZmllbGQsXG4gICAgICAgICAgICAgICAgYXNjZW5kaW5nOiBkZWYuYXNjZW5kaW5nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBmYWNldFF1ZXJpZXMoKTogRmFjZXRRdWVyeVtdIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzRmFjZXRRdWVyaWVzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzLnF1ZXJpZXMubWFwKChxdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5Lmdyb3VwID0gdGhpcy5nZXRRdWVyeUdyb3VwKHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gPEZhY2V0UXVlcnk+IHsgLi4ucXVlcnkgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBmYWNldEludGVydmFscygpOiBhbnkge1xuICAgICAgICBpZiAodGhpcy5oYXNGYWNldEludGVydmFscykge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnSW50ZXJ2YWxzID0gdGhpcy5jb25maWcuZmFjZXRJbnRlcnZhbHM7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWxzOiBjb25maWdJbnRlcnZhbHMuaW50ZXJ2YWxzLm1hcCgoaW50ZXJ2YWwpID0+IDxhbnk+IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwoaW50ZXJ2YWwubGFiZWwpLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogaW50ZXJ2YWwuZmllbGQsXG4gICAgICAgICAgICAgICAgICAgIHNldHM6IGludGVydmFsLnNldHMubWFwKChzZXQpID0+IDxhbnk+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLmdldFN1cHBvcnRlZExhYmVsKHNldC5sYWJlbCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogc2V0LnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBzZXQuZW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmNsdXNpdmU6IHNldC5zdGFydEluY2x1c2l2ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEluY2x1c2l2ZTogc2V0LmVuZEluY2x1c2l2ZVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBoaWdobGlnaHQoKTogUmVxdWVzdEhpZ2hsaWdodCB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0ZhY2V0SGlnaGxpZ2h0ID8gdGhpcy5jb25maWcuaGlnaGxpZ2h0IDogbnVsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0RmluYWxRdWVyeSgpOiBzdHJpbmcge1xuICAgICAgICBsZXQgcXVlcnkgPSAnJztcblxuICAgICAgICB0aGlzLmNhdGVnb3JpZXMuZm9yRWFjaCgoZmFjZXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVF1ZXJ5ID0gdGhpcy5xdWVyeUZyYWdtZW50c1tmYWNldC5pZF07XG4gICAgICAgICAgICBpZiAoY3VzdG9tUXVlcnkpIHtcbiAgICAgICAgICAgICAgICBpZiAocXVlcnkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBxdWVyeSArPSAnIEFORCAnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxdWVyeSArPSBgKCR7Y3VzdG9tUXVlcnl9KWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCByZXN1bHQgPSBbdGhpcy51c2VyUXVlcnksIHF1ZXJ5XVxuICAgICAgICAgICAgLmZpbHRlcigoZW50cnkpID0+IGVudHJ5KVxuICAgICAgICAgICAgLmpvaW4oJyBBTkQgJyk7XG5cbiAgICAgICAgaWYgKHRoaXMudXNlckZhY2V0QnVja2V0cykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy51c2VyRmFjZXRCdWNrZXRzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJRdWVyeSA9ICh0aGlzLnVzZXJGYWNldEJ1Y2tldHNba2V5XSB8fCBbXSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoYnVja2V0KSA9PiBidWNrZXQuZmlsdGVyUXVlcnkpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKGJ1Y2tldCkgPT4gYnVja2V0LmZpbHRlclF1ZXJ5KVxuICAgICAgICAgICAgICAgICAgICAuam9pbignIE9SICcpO1xuICAgICAgICAgICAgICAgIGlmIChzdWJRdWVyeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnIEFORCAnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgKCR7c3ViUXVlcnl9KWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgZmFjZXRGaWVsZHMoKTogUmVxdWVzdEZhY2V0RmllbGRzIHtcbiAgICAgICAgY29uc3QgZmFjZXRGaWVsZHMgPSB0aGlzLmNvbmZpZy5mYWNldEZpZWxkcyAmJiB0aGlzLmNvbmZpZy5mYWNldEZpZWxkcy5maWVsZHM7XG5cbiAgICAgICAgaWYgKGZhY2V0RmllbGRzICYmIGZhY2V0RmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmFjZXRzOiBmYWNldEZpZWxkcy5tYXAoKGZhY2V0KSA9PiA8UmVxdWVzdEZhY2V0RmllbGQ+IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGZhY2V0LmZpZWxkLFxuICAgICAgICAgICAgICAgICAgICBtaW5jb3VudDogZmFjZXQubWluY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLmdldFN1cHBvcnRlZExhYmVsKGZhY2V0LmxhYmVsKSxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQ6IGZhY2V0LmxpbWl0LFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGZhY2V0Lm9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4OiBmYWNldC5wcmVmaXhcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuY2xvc2VzIGEgbGFiZWwgbmFtZSB3aXRoIGRvdWJsZSBxdW90ZXMgaWYgaXQgY29udGFpbnMgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzLlxuICAgICAqIEBwYXJhbSBjb25maWdMYWJlbCBPcmlnaW5hbCBsYWJlbCB0ZXh0XG4gICAgICogQHJldHVybnMgTGFiZWwsIHBvc3NpYmx5IHdpdGggcXVvdGVzIGlmIGl0IGNvbnRhaW5zIHNwYWNlc1xuICAgICAqL1xuICAgIGdldFN1cHBvcnRlZExhYmVsKGNvbmZpZ0xhYmVsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzcGFjZUluc2lkZUxhYmVsSW5kZXggPSBjb25maWdMYWJlbC5zZWFyY2goL1xccy9nKTtcbiAgICAgICAgaWYgKHNwYWNlSW5zaWRlTGFiZWxJbmRleCA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gYFwiJHtjb25maWdMYWJlbH1cImA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZ0xhYmVsO1xuICAgIH1cbn1cbiJdfQ==