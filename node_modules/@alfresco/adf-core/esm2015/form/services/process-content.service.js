import { AlfrescoApiService } from '../../services/alfresco-api.service';
import { LogService } from '../../services/log.service';
import { Injectable } from '@angular/core';
import { Observable, from, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../../services/alfresco-api.service";
import * as i2 from "../../services/log.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/alfresco-api.service';
import * as ɵngcc2 from '../../services/log.service';
export class ProcessContentService {
    constructor(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
    }
    get contentApi() {
        return this.apiService.getInstance().activiti.contentApi;
    }
    createTemporaryRawRelatedContent(file) {
        return from(this.contentApi.createTemporaryRawRelatedContent(file))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getFileContent(contentId) {
        return from(this.contentApi.getContent(contentId))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getFileRawContent(contentId) {
        return from(this.contentApi.getRawContent(contentId))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getContentPreview(contentId) {
        return new Observable((observer) => {
            this.contentApi.getContentPreview(contentId).then((result) => {
                observer.next(result);
                observer.complete();
            }, () => {
                this.contentApi.getRawContent(contentId).then((data) => {
                    observer.next(data);
                    observer.complete();
                }, (err) => {
                    observer.error(err);
                    observer.complete();
                });
            });
        });
    }
    getFileRawContentUrl(contentId) {
        return this.contentApi.getRawContentUrl(contentId);
    }
    getContentThumbnail(contentId) {
        return from(this.contentApi.getContentThumbnail(contentId))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getTaskRelatedContent(taskId, opts) {
        return from(this.contentApi.getRelatedContentForTask(taskId, opts))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getProcessRelatedContent(processId, opts) {
        return from(this.contentApi.getRelatedContentForProcessInstance(processId, opts))
            .pipe(catchError((err) => this.handleError(err)));
    }
    deleteRelatedContent(contentId) {
        return from(this.contentApi.deleteContent(contentId))
            .pipe(catchError((err) => this.handleError(err)));
    }
    createProcessRelatedContent(processInstanceId, content, opts) {
        return from(this.contentApi.createRelatedContentOnProcessInstance(processInstanceId, content, opts))
            .pipe(catchError((err) => this.handleError(err)));
    }
    createTaskRelatedContent(taskId, file, opts) {
        return from(this.contentApi.createRelatedContentOnTask(taskId, file, opts))
            .pipe(catchError((err) => this.handleError(err)));
    }
    toJson(res) {
        if (res) {
            return res || {};
        }
        return {};
    }
    toJsonArray(res) {
        if (res) {
            return res.data || [];
        }
        return [];
    }
    handleError(error) {
        let errMsg = ProcessContentService.UNKNOWN_ERROR_MESSAGE;
        if (error) {
            errMsg = (error.message) ? error.message :
                error.status ? `${error.status} - ${error.statusText}` : ProcessContentService.GENERIC_ERROR_MESSAGE;
        }
        this.logService.error(errMsg);
        return throwError(errMsg);
    }
}
ProcessContentService.ɵfac = function ProcessContentService_Factory(t) { return new (t || ProcessContentService)(ɵngcc0.ɵɵinject(ɵngcc1.AlfrescoApiService), ɵngcc0.ɵɵinject(ɵngcc2.LogService)); };
ProcessContentService.UNKNOWN_ERROR_MESSAGE = 'Unknown error';
ProcessContentService.GENERIC_ERROR_MESSAGE = 'Server error';
ProcessContentService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ProcessContentService_Factory() { return new ProcessContentService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i2.LogService)); }, token: ProcessContentService, providedIn: "root" });
ProcessContentService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessContentService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }, { type: ɵngcc2.LogService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1jb250ZW50LnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL2Zvcm0vc2VydmljZXMvcHJvY2Vzcy1jb250ZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUJBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUM7QUFFc0I7QUFJTDs7OztBQUZqQixNQUFNLE9BQU8scUJBQXFCO0FBQ2xDLElBSUksWUFBb0IsVUFBOEIsRUFDOUIsVUFBc0I7QUFDOUMsUUFGd0IsZUFBVSxHQUFWLFVBQVUsQ0FBb0I7QUFBQyxRQUMvQixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsSUFDM0MsQ0FBQztBQUNMLElBQ0ksSUFBWSxVQUFVO0FBQUssUUFDdkIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7QUFDakUsSUFBSSxDQUFDO0FBQ0wsSUFNSSxnQ0FBZ0MsQ0FBQyxJQUFTO0FBQUksUUFDMUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQ0FBZ0MsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMzRSxhQUFhLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFD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dGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hbGZyZXNjby1hcGkuc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVsYXRlZENvbnRlbnRSZXByZXNlbnRhdGlvbiB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBQcm9jZXNzQ29udGVudFNlcnZpY2Uge1xuXG4gICAgc3RhdGljIFVOS05PV05fRVJST1JfTUVTU0FHRTogc3RyaW5nID0gJ1Vua25vd24gZXJyb3InO1xuICAgIHN0YXRpYyBHRU5FUklDX0VSUk9SX01FU1NBR0U6IHN0cmluZyA9ICdTZXJ2ZXIgZXJyb3InO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgY29udGVudEFwaSgpOiBhbnkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkuY29udGVudEFwaTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGVtcG9yYXJ5IHJlbGF0ZWQgY29udGVudCBmcm9tIGFuIHVwbG9hZGVkIGZpbGUuXG4gICAgICogQHBhcmFtIGZpbGUgRmlsZSB0byB1c2UgZm9yIGNvbnRlbnRcbiAgICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCBjb250ZW50IGRhdGFcbiAgICAgKi9cbiAgICBjcmVhdGVUZW1wb3JhcnlSYXdSZWxhdGVkQ29udGVudChmaWxlOiBhbnkpOiBPYnNlcnZhYmxlPFJlbGF0ZWRDb250ZW50UmVwcmVzZW50YXRpb24+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jb250ZW50QXBpLmNyZWF0ZVRlbXBvcmFyeVJhd1JlbGF0ZWRDb250ZW50KGZpbGUpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBtZXRhZGF0YSBmb3IgYSByZWxhdGVkIGNvbnRlbnQgaXRlbS5cbiAgICAgKiBAcGFyYW0gY29udGVudElkIElEIG9mIHRoZSBjb250ZW50IGl0ZW1cbiAgICAgKiBAcmV0dXJucyBNZXRhZGF0YSBmb3IgdGhlIGNvbnRlbnRcbiAgICAgKi9cbiAgICBnZXRGaWxlQ29udGVudChjb250ZW50SWQ6IG51bWJlcik6IE9ic2VydmFibGU8UmVsYXRlZENvbnRlbnRSZXByZXNlbnRhdGlvbj4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNvbnRlbnRBcGkuZ2V0Q29udGVudChjb250ZW50SWQpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHJhdyBiaW5hcnkgY29udGVudCBkYXRhIGZvciBhIHJlbGF0ZWQgY29udGVudCBmaWxlLlxuICAgICAqIEBwYXJhbSBjb250ZW50SWQgSUQgb2YgdGhlIHJlbGF0ZWQgY29udGVudFxuICAgICAqIEByZXR1cm5zIEJpbmFyeSBkYXRhIG9mIHRoZSByZWxhdGVkIGNvbnRlbnRcbiAgICAgKi9cbiAgICBnZXRGaWxlUmF3Q29udGVudChjb250ZW50SWQ6IG51bWJlcik6IE9ic2VydmFibGU8QmxvYj4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNvbnRlbnRBcGkuZ2V0UmF3Q29udGVudChjb250ZW50SWQpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBwcmV2aWV3IGZvciBhIHJlbGF0ZWQgY29udGVudCBmaWxlLlxuICAgICAqIEBwYXJhbSBjb250ZW50SWQgSUQgb2YgdGhlIHJlbGF0ZWQgY29udGVudFxuICAgICAqIEByZXR1cm5zIEJpbmFyeSBkYXRhIG9mIHRoZSBjb250ZW50IHByZXZpZXdcbiAgICAgKi9cbiAgICBnZXRDb250ZW50UHJldmlldyhjb250ZW50SWQ6IG51bWJlcik6IE9ic2VydmFibGU8QmxvYj4ge1xuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRBcGkuZ2V0Q29udGVudFByZXZpZXcoY29udGVudElkKS50aGVuKFxuICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRBcGkuZ2V0UmF3Q29udGVudChjb250ZW50SWQpLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBVUkwgZm9yIGRpcmVjdCBhY2Nlc3MgdG8gYSByZWxhdGVkIGNvbnRlbnQgZmlsZS5cbiAgICAgKiBAcGFyYW0gY29udGVudElkIElEIG9mIHRoZSByZWxhdGVkIGNvbnRlbnRcbiAgICAgKiBAcmV0dXJucyBVUkwgdG8gYWNjZXNzIHRoZSBjb250ZW50XG4gICAgICovXG4gICAgZ2V0RmlsZVJhd0NvbnRlbnRVcmwoY29udGVudElkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50QXBpLmdldFJhd0NvbnRlbnRVcmwoY29udGVudElkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB0aHVtYm5haWwgZm9yIGEgcmVsYXRlZCBjb250ZW50IGZpbGUuXG4gICAgICogQHBhcmFtIGNvbnRlbnRJZCBJRCBvZiB0aGUgcmVsYXRlZCBjb250ZW50XG4gICAgICogQHJldHVybnMgQmluYXJ5IGRhdGEgb2YgdGhlIHRodW1ibmFpbCBpbWFnZVxuICAgICAqL1xuICAgIGdldENvbnRlbnRUaHVtYm5haWwoY29udGVudElkOiBudW1iZXIpOiBPYnNlcnZhYmxlPEJsb2I+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jb250ZW50QXBpLmdldENvbnRlbnRUaHVtYm5haWwoY29udGVudElkKSlcbiAgICAgICAgICAgIC5waXBlKGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyByZWxhdGVkIGNvbnRlbnQgaXRlbXMgZm9yIGEgdGFzayBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gdGFza0lkIElEIG9mIHRoZSB0YXJnZXQgdGFza1xuICAgICAqIEBwYXJhbSBvcHRzIE9wdGlvbnMgc3VwcG9ydGVkIGJ5IEpTLUFQSVxuICAgICAqIEByZXR1cm5zIE1ldGFkYXRhIGZvciB0aGUgY29udGVudFxuICAgICAqL1xuICAgIGdldFRhc2tSZWxhdGVkQ29udGVudCh0YXNrSWQ6IHN0cmluZywgb3B0cz86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY29udGVudEFwaS5nZXRSZWxhdGVkQ29udGVudEZvclRhc2sodGFza0lkLCBvcHRzKSlcbiAgICAgICAgICAgIC5waXBlKGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyByZWxhdGVkIGNvbnRlbnQgaXRlbXMgZm9yIGEgcHJvY2VzcyBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gcHJvY2Vzc0lkIElEIG9mIHRoZSB0YXJnZXQgcHJvY2Vzc1xuICAgICAqIEBwYXJhbSBvcHRzIE9wdGlvbnMgc3VwcG9ydGVkIGJ5IEpTLUFQSVxuICAgICAqIEByZXR1cm5zIE1ldGFkYXRhIGZvciB0aGUgY29udGVudFxuICAgICAqL1xuICAgIGdldFByb2Nlc3NSZWxhdGVkQ29udGVudChwcm9jZXNzSWQ6IHN0cmluZywgb3B0cz86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY29udGVudEFwaS5nZXRSZWxhdGVkQ29udGVudEZvclByb2Nlc3NJbnN0YW5jZShwcm9jZXNzSWQsIG9wdHMpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIHJlbGF0ZWQgY29udGVudC5cbiAgICAgKiBAcGFyYW0gY29udGVudElkIElkZW50aWZpZXIgb2YgdGhlIGNvbnRlbnQgdG8gZGVsZXRlXG4gICAgICogQHJldHVybnMgTnVsbCByZXNwb25zZSB0aGF0IG5vdGlmaWVzIHdoZW4gdGhlIGRlbGV0aW9uIGlzIGNvbXBsZXRlXG4gICAgICovXG4gICAgZGVsZXRlUmVsYXRlZENvbnRlbnQoY29udGVudElkOiBudW1iZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNvbnRlbnRBcGkuZGVsZXRlQ29udGVudChjb250ZW50SWQpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NvY2lhdGVzIGFuIHVwbG9hZGVkIGZpbGUgd2l0aCBhIHByb2Nlc3MgaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHByb2Nlc3NJbnN0YW5jZUlkIElEIG9mIHRoZSB0YXJnZXQgcHJvY2VzcyBpbnN0YW5jZVxuICAgICAqIEBwYXJhbSBjb250ZW50IEZpbGUgdG8gYXNzb2NpYXRlXG4gICAgICogQHBhcmFtIG9wdHMgT3B0aW9ucyBzdXBwb3J0ZWQgYnkgSlMtQVBJXG4gICAgICogQHJldHVybnMgRGV0YWlscyBvZiBjcmVhdGVkIGNvbnRlbnRcbiAgICAgKi9cbiAgICBjcmVhdGVQcm9jZXNzUmVsYXRlZENvbnRlbnQocHJvY2Vzc0luc3RhbmNlSWQ6IHN0cmluZywgY29udGVudDogYW55LCBvcHRzPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jb250ZW50QXBpLmNyZWF0ZVJlbGF0ZWRDb250ZW50T25Qcm9jZXNzSW5zdGFuY2UocHJvY2Vzc0luc3RhbmNlSWQsIGNvbnRlbnQsIG9wdHMpKVxuICAgICAgICAgICAgLnBpcGUoY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NvY2lhdGVzIGFuIHVwbG9hZGVkIGZpbGUgd2l0aCBhIHRhc2sgaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHRhc2tJZCBJRCBvZiB0aGUgdGFyZ2V0IHRhc2tcbiAgICAgKiBAcGFyYW0gZmlsZSBGaWxlIHRvIGFzc29jaWF0ZVxuICAgICAqIEBwYXJhbSBvcHRzIE9wdGlvbnMgc3VwcG9ydGVkIGJ5IEpTLUFQSVxuICAgICAqIEByZXR1cm5zIERldGFpbHMgb2YgY3JlYXRlZCBjb250ZW50XG4gICAgICovXG4gICAgY3JlYXRlVGFza1JlbGF0ZWRDb250ZW50KHRhc2tJZDogc3RyaW5nLCBmaWxlOiBhbnksIG9wdHM/OiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jb250ZW50QXBpLmNyZWF0ZVJlbGF0ZWRDb250ZW50T25UYXNrKHRhc2tJZCwgZmlsZSwgb3B0cykpXG4gICAgICAgICAgICAucGlwZShjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGRhdGEuXG4gICAgICogQHBhcmFtIHJlcyBPYmplY3QgcmVwcmVzZW50aW5nIGRhdGFcbiAgICAgKiBAcmV0dXJucyBKU09OIG9iamVjdFxuICAgICAqL1xuICAgIHRvSnNvbihyZXM6IGFueSkge1xuICAgICAgICBpZiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzIHx8IHt9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgSlNPTiBhcnJheSByZXByZXNlbnRhdGlvbiBvZiBkYXRhLlxuICAgICAqIEBwYXJhbSByZXMgT2JqZWN0IHJlcHJlc2VudGluZyBkYXRhXG4gICAgICogQHJldHVybnMgSlNPTiBhcnJheSBvYmplY3RcbiAgICAgKi9cbiAgICB0b0pzb25BcnJheShyZXM6IGFueSkge1xuICAgICAgICBpZiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLmRhdGEgfHwgW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcG9ydHMgYW4gZXJyb3IgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0gZXJyb3IgRGF0YSBvYmplY3Qgd2l0aCBvcHRpb25hbCBgbWVzc2FnZWAgYW5kIGBzdGF0dXNgIGZpZWxkcyBmb3IgdGhlIGVycm9yXG4gICAgICogQHJldHVybnMgQ2FsbGJhY2sgd2hlbiBhbiBlcnJvciBvY2N1cnNcbiAgICAgKi9cbiAgICBoYW5kbGVFcnJvcihlcnJvcjogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgbGV0IGVyck1zZyA9IFByb2Nlc3NDb250ZW50U2VydmljZS5VTktOT1dOX0VSUk9SX01FU1NBR0U7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgZXJyTXNnID0gKGVycm9yLm1lc3NhZ2UpID8gZXJyb3IubWVzc2FnZSA6XG4gICAgICAgICAgICAgICAgZXJyb3Iuc3RhdHVzID8gYCR7ZXJyb3Iuc3RhdHVzfSAtICR7ZXJyb3Iuc3RhdHVzVGV4dH1gIDogUHJvY2Vzc0NvbnRlbnRTZXJ2aWNlLkdFTkVSSUNfRVJST1JfTUVTU0FHRTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyTXNnKTtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyTXNnKTtcbiAgICB9XG5cbn1cbiJdfQ==