/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { Router, ActivatedRoute } from '@angular/router';
import { AuthenticationService } from '../../services/authentication.service';
import { LogService } from '../../services/log.service';
import { TranslationService } from '../../services/translation.service';
import { UserPreferencesService } from '../../services/user-preferences.service';
import { AlfrescoApiService } from '../../services/alfresco-api.service';
import { LoginErrorEvent } from '../models/login-error.event';
import { LoginSubmitEvent } from '../models/login-submit.event';
import { LoginSuccessEvent } from '../models/login-success.event';
import { AppConfigService, AppConfigValues } from '../../app-config/app-config.service';
import { DomSanitizer } from '@angular/platform-browser';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/forms';
import * as ɵngcc2 from '../../services/authentication.service';
import * as ɵngcc3 from '../../services/translation.service';
import * as ɵngcc4 from '../../services/log.service';
import * as ɵngcc5 from '@angular/router';
import * as ɵngcc6 from '../../app-config/app-config.service';
import * as ɵngcc7 from '../../services/user-preferences.service';
import * as ɵngcc8 from '@angular/platform-browser';
import * as ɵngcc9 from '../../services/alfresco-api.service';
import * as ɵngcc10 from '@angular/material/card';
import * as ɵngcc11 from '@angular/common';
import * as ɵngcc12 from '@angular/material/icon';
import * as ɵngcc13 from '@angular/material/form-field';
import * as ɵngcc14 from '@angular/material/input';
import * as ɵngcc15 from '@angular/material/button';
import * as ɵngcc16 from '@angular/material/progress-spinner';
import * as ɵngcc17 from '@angular/material/checkbox';
import * as ɵngcc18 from '@ngx-translate/core';

function LoginComponent_8_ng_template_0_Template(rf, ctx) { }
const _c0 = function (a0) { return [a0]; };
function LoginComponent_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, LoginComponent_8_ng_template_0_Template, 0, 0, "ng-template", 12);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpureFunction1(2, _c0, ctx_r0.data))("ngForTemplate", ctx_r0.headerTemplate);
} }
function LoginComponent_img_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "img", 13);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵpropertyInterpolate("alt", ɵngcc0.ɵɵpipeBind1(1, 2, "LOGIN.LOGO"));
    ɵngcc0.ɵɵproperty("src", ctx_r1.logoImageUrl, ɵngcc0.ɵɵsanitizeUrl);
} }
function LoginComponent_div_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 14);
    ɵngcc0.ɵɵelementStart(1, "mat-icon", 15);
    ɵngcc0.ɵɵtext(2, "warning");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "span", 16);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 1, ctx_r2.errorMsg));
} }
function LoginComponent_div_13_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 30);
    ɵngcc0.ɵɵelementStart(1, "span", 31);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, ctx_r7.formError["username"]));
} }
function LoginComponent_div_13_span_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 32);
    ɵngcc0.ɵɵelementStart(1, "span", 33);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r8 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, ctx_r8.formError["password"]));
} }
function LoginComponent_div_13_span_19_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 34);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "LOGIN.BUTTON.LOGIN"));
} }
function LoginComponent_div_13_div_20_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 35);
    ɵngcc0.ɵɵelementStart(1, "span", 34);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "div", 36);
    ɵngcc0.ɵɵelement(5, "mat-spinner", 37);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 2, "LOGIN.BUTTON.CHECKING"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("diameter", 25);
} }
function LoginComponent_div_13_div_21_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 35);
    ɵngcc0.ɵɵelementStart(1, "span", 34);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "mat-icon", 38);
    ɵngcc0.ɵɵtext(5, "done");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "LOGIN.BUTTON.WELCOME"));
} }
function LoginComponent_div_13_div_22_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 39);
    ɵngcc0.ɵɵelementStart(1, "mat-checkbox", 40);
    ɵngcc0.ɵɵlistener("change", function LoginComponent_div_13_div_22_Template_mat_checkbox_change_1_listener() { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(2); return ctx_r13.rememberMe = !ctx_r13.rememberMe; });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r12 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("checked", ctx_r12.rememberMe);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(3, 2, "LOGIN.LABEL.REMEMBER"), " ");
} }
const _c1 = function (a0) { return { "adf-is-invalid": a0 }; };
function LoginComponent_div_13_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "div", 17);
    ɵngcc0.ɵɵelementStart(2, "mat-form-field", 18);
    ɵngcc0.ɵɵelementStart(3, "input", 19);
    ɵngcc0.ɵɵlistener("blur", function LoginComponent_div_13_Template_input_blur_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.trimUsername($event); });
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(5, LoginComponent_div_13_span_5_Template, 4, 3, "span", 20);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 21);
    ɵngcc0.ɵɵelementStart(7, "mat-form-field", 18);
    ɵngcc0.ɵɵelement(8, "input", 22);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementStart(10, "button", 23);
    ɵngcc0.ɵɵlistener("click", function LoginComponent_div_13_Template_button_click_10_listener($event) { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.toggleShowPassword($event); })("keyup.enter", function LoginComponent_div_13_Template_button_keyup_enter_10_listener($event) { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r18 = ɵngcc0.ɵɵnextContext(); return ctx_r18.toggleShowPassword($event); });
    ɵngcc0.ɵɵpipe(11, "translate");
    ɵngcc0.ɵɵelementStart(12, "mat-icon", 24);
    ɵngcc0.ɵɵtext(13);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(14, LoginComponent_div_13_span_14_Template, 4, 3, "span", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵprojection(15);
    ɵngcc0.ɵɵelement(16, "br");
    ɵngcc0.ɵɵelementStart(17, "button", 26);
    ɵngcc0.ɵɵpipe(18, "translate");
    ɵngcc0.ɵɵtemplate(19, LoginComponent_div_13_span_19_Template, 3, 3, "span", 27);
    ɵngcc0.ɵɵtemplate(20, LoginComponent_div_13_div_20_Template, 6, 4, "div", 28);
    ɵngcc0.ɵɵtemplate(21, LoginComponent_div_13_div_21_Template, 6, 3, "div", 28);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(22, LoginComponent_div_13_div_22_Template, 4, 4, "div", 29);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(27, _c1, ctx_r3.isErrorStyle(ctx_r3.form.controls.username)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(4, 19, "LOGIN.LABEL.USERNAME"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.formError["username"]);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(9, 21, "LOGIN.LABEL.PASSWORD"));
    ɵngcc0.ɵɵproperty("type", ctx_r3.isPasswordShow ? "text" : "password");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(11, 23, ctx_r3.isPasswordShow ? "LOGIN.ARIA-LABEL.HIDE-PASSWORD" : "LOGIN.ARIA-LABEL.SHOW-PASSWORD"))("data-automation-id", ctx_r3.isPasswordShow ? "hide_password" : "show_password");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r3.isPasswordShow ? "visibility" : "visibility_off", " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.formError["password"]);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("adf-isChecking", ctx_r3.actualLoginStep === ctx_r3.LoginSteps.Checking)("adf-isWelcome", ctx_r3.actualLoginStep === ctx_r3.LoginSteps.Welcome);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r3.form.valid);
    ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(18, 25, "LOGIN.BUTTON.LOGIN"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.actualLoginStep === ctx_r3.LoginSteps.Landing);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.actualLoginStep === ctx_r3.LoginSteps.Checking);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.actualLoginStep === ctx_r3.LoginSteps.Welcome);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.showRememberMe);
} }
function LoginComponent_div_14_Template(rf, ctx) { if (rf & 1) {
    const _r20 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "button", 41);
    ɵngcc0.ɵɵlistener("click", function LoginComponent_div_14_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r20); const ctx_r19 = ɵngcc0.ɵɵnextContext(); return ctx_r19.implicitLogin(); });
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementStart(3, "span", 34);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(2, 2, "LOGIN.BUTTON.SSO"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 4, "LOGIN.BUTTON.SSO"));
} }
function LoginComponent_mat_card_actions_15_2_ng_template_0_Template(rf, ctx) { }
function LoginComponent_mat_card_actions_15_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, LoginComponent_mat_card_actions_15_2_ng_template_0_Template, 0, 0, "ng-template", 12);
} if (rf & 2) {
    const ctx_r21 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpureFunction1(2, _c0, ctx_r21.data))("ngForTemplate", ctx_r21.footerTemplate);
} }
function LoginComponent_mat_card_actions_15_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 44);
    ɵngcc0.ɵɵelementStart(1, "div", 45);
    ɵngcc0.ɵɵelementStart(2, "a", 46);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "div", 47);
    ɵngcc0.ɵɵelementStart(6, "a", 46);
    ɵngcc0.ɵɵtext(7);
    ɵngcc0.ɵɵpipe(8, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r22 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("href", ctx_r22.needHelpLink, ɵngcc0.ɵɵsanitizeUrl);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 4, "LOGIN.ACTION.HELP"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵpropertyInterpolate("href", ctx_r22.registerLink, ɵngcc0.ɵɵsanitizeUrl);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(8, 6, "LOGIN.ACTION.REGISTER"));
} }
function LoginComponent_mat_card_actions_15_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card-actions");
    ɵngcc0.ɵɵelementStart(1, "div", 42);
    ɵngcc0.ɵɵtemplate(2, LoginComponent_mat_card_actions_15_2_Template, 1, 4, undefined, 6);
    ɵngcc0.ɵɵtemplate(3, LoginComponent_mat_card_actions_15_div_3_Template, 9, 8, "div", 43);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.footerTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r5.footerTemplate && ctx_r5.showLoginActions);
} }
const _c2 = ["*"];
var LoginSteps;
(function (LoginSteps) {
    LoginSteps[LoginSteps["Landing"] = 0] = "Landing";
    LoginSteps[LoginSteps["Checking"] = 1] = "Checking";
    LoginSteps[LoginSteps["Welcome"] = 2] = "Welcome";
})(LoginSteps || (LoginSteps = {}));
export class LoginComponent {
    constructor(_fb, authService, translateService, logService, router, appConfig, userPreferences, route, sanitizer, alfrescoApiService) {
        this._fb = _fb;
        this.authService = authService;
        this.translateService = translateService;
        this.logService = logService;
        this.router = router;
        this.appConfig = appConfig;
        this.userPreferences = userPreferences;
        this.route = route;
        this.sanitizer = sanitizer;
        this.alfrescoApiService = alfrescoApiService;
        this.isPasswordShow = false;
        this.showRememberMe = true;
        this.showLoginActions = true;
        this.needHelpLink = '';
        this.registerLink = '';
        this.logoImageUrl = './assets/images/alfresco-logo.svg';
        this.backgroundImageUrl = './assets/images/background.svg';
        this.copyrightText = '\u00A9 2016 Alfresco Software, Inc. All Rights Reserved.';
        this.successRoute = null;
        this.success = new EventEmitter();
        this.error = new EventEmitter();
        this.executeSubmit = new EventEmitter();
        this.implicitFlow = false;
        this.isError = false;
        this.actualLoginStep = LoginSteps.Landing;
        this.LoginSteps = LoginSteps;
        this.rememberMe = true;
        this.minLength = 2;
        this.onDestroy$ = new Subject();
    }
    ngOnInit() {
        this.initFormError();
        this.initFormFieldsDefault();
        this.initFormFieldsMessages();
        this.successRoute = this.appConfig.get('successRoute', this.successRoute);
        if (this.authService.isLoggedIn()) {
            this.router.navigate([this.successRoute]);
        }
        else {
            if (this.authService.isOauth()) {
                const oauth = this.appConfig.get(AppConfigValues.OAUTHCONFIG, null);
                if (oauth && oauth.silentLogin) {
                    this.redirectToImplicitLogin();
                }
                else if (oauth && oauth.implicitFlow) {
                    this.implicitFlow = true;
                }
            }
            this.route.queryParams.subscribe((params) => {
                const url = params['redirectUrl'];
                const provider = this.appConfig.get(AppConfigValues.PROVIDERS);
                this.authService.setRedirect({ provider, url });
            });
        }
        if (this.fieldsValidation) {
            this.form = this._fb.group(this.fieldsValidation);
        }
        this.form.valueChanges
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(data => this.onValueChanged(data));
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    submit() {
        this.onSubmit(this.form.value);
    }
    redirectToImplicitLogin() {
        this.alfrescoApiService.getInstance().oauth2Auth.implicitLogin();
    }
    onSubmit(values) {
        this.disableError();
        const args = new LoginSubmitEvent({
            controls: { username: this.form.controls.username }
        });
        this.executeSubmit.emit(args);
        if (!args.defaultPrevented) {
            this.performLogin(values);
        }
    }
    implicitLogin() {
        if (this.authService.isLoggedIn()) {
            this.router.navigate([this.successRoute]);
        }
        this.authService.ssoImplicitLogin();
    }
    onValueChanged(data) {
        this.disableError();
        for (const field in this.formError) {
            if (field) {
                this.formError[field] = '';
                const hasError = (this.form.controls[field].errors && data[field] !== '') ||
                    (this.form.controls[field].dirty &&
                        !this.form.controls[field].valid);
                if (hasError) {
                    for (const key in this.form.controls[field].errors) {
                        if (key) {
                            const message = this._message[field][key];
                            if (message && message.value) {
                                const translated = this.translateService.instant(message.value, message.params);
                                this.formError[field] += translated;
                            }
                        }
                    }
                }
            }
        }
    }
    performLogin(values) {
        this.actualLoginStep = LoginSteps.Checking;
        this.authService
            .login(values.username, values.password, this.rememberMe)
            .subscribe((token) => {
            const redirectUrl = this.authService.getRedirect();
            this.actualLoginStep = LoginSteps.Welcome;
            this.userPreferences.setStoragePrefix(values.username);
            values.password = null;
            this.success.emit(new LoginSuccessEvent(token, values.username, null));
            if (redirectUrl) {
                this.authService.setRedirect(null);
                this.router.navigateByUrl(redirectUrl);
            }
            else if (this.successRoute) {
                this.router.navigate([this.successRoute]);
            }
        }, (err) => {
            this.actualLoginStep = LoginSteps.Landing;
            this.displayErrorMessage(err);
            this.isError = true;
            this.error.emit(new LoginErrorEvent(err));
        }, () => this.logService.info('Login done'));
    }
    displayErrorMessage(err) {
        if (err.error &&
            err.error.crossDomain &&
            err.error.message.indexOf('Access-Control-Allow-Origin') !== -1) {
            this.errorMsg = err.error.message;
        }
        else if (err.status === 403 &&
            err.message.indexOf('Invalid CSRF-token') !== -1) {
            this.errorMsg = 'LOGIN.MESSAGES.LOGIN-ERROR-CSRF';
        }
        else if (err.status === 403 &&
            err.message.indexOf('The system is currently in read-only mode') !==
                -1) {
            this.errorMsg = 'LOGIN.MESSAGES.LOGIN-ECM-LICENSE';
        }
        else {
            this.errorMsg = 'LOGIN.MESSAGES.LOGIN-ERROR-CREDENTIALS';
        }
    }
    addCustomFormError(field, msg) {
        this.formError[field] += msg;
    }
    addCustomValidationError(field, ruleId, msg, params) {
        this._message[field][ruleId] = {
            value: msg,
            params
        };
    }
    toggleShowPassword(event) {
        event.stopPropagation();
        this.isPasswordShow = !this.isPasswordShow;
    }
    isErrorStyle(field) {
        return !field.valid && field.dirty && !field.pristine;
    }
    trimUsername(event) {
        event.target.value = event.target.value.trim();
    }
    getBackgroundUrlImageUrl() {
        return this.sanitizer.bypassSecurityTrustStyle(`url(${this.backgroundImageUrl})`);
    }
    initFormError() {
        this.formError = {
            username: '',
            password: ''
        };
    }
    initFormFieldsMessages() {
        this._message = {
            username: {
                required: {
                    value: 'LOGIN.MESSAGES.USERNAME-REQUIRED'
                },
                minlength: {
                    value: 'LOGIN.MESSAGES.USERNAME-MIN',
                    params: {
                        minLength: this.minLength
                    }
                }
            },
            password: {
                required: {
                    value: 'LOGIN.MESSAGES.PASSWORD-REQUIRED'
                }
            }
        };
    }
    initFormFieldsDefault() {
        this.form = this._fb.group({
            username: ['', Validators.compose([Validators.required, Validators.minLength(this.minLength)])],
            password: ['', Validators.required]
        });
    }
    disableError() {
        this.isError = false;
        this.initFormError();
    }
}
LoginComponent.ɵfac = function LoginComponent_Factory(t) { return new (t || LoginComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AuthenticationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LogService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc6.AppConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc7.UserPreferencesService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc8.DomSanitizer), ɵngcc0.ɵɵdirectiveInject(ɵngcc9.AlfrescoApiService)); };
LoginComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: LoginComponent, selectors: [["adf-login"]], hostAttrs: [1, "adf-login"], inputs: { showRememberMe: "showRememberMe", showLoginActions: "showLoginActions", needHelpLink: "needHelpLink", registerLink: "registerLink", logoImageUrl: "logoImageUrl", backgroundImageUrl: "backgroundImageUrl", copyrightText: "copyrightText", successRoute: "successRoute", fieldsValidation: "fieldsValidation" }, outputs: { success: "success", error: "error", executeSubmit: "executeSubmit" }, ngContentSelectors: _c2, decls: 18, vars: 10, consts: [[1, "adf-login-content"], [1, "adf-ie11FixerParent"], [1, "adf-ie11FixerChild"], [1, "adf-login-card-wide"], ["id", "adf-login-form", "autocomplete", "off", 3, "formGroup", "submit"], [1, "adf-alfresco-logo"], [4, "ngIf"], ["id", "adf-login-img-logo", "class", "adf-img-logo", 3, "src", "alt", 4, "ngIf"], [1, "adf-login-controls"], [1, "adf-error-container"], ["id", "login-error", "data-automation-id", "login-error", "class", "adf-error  adf-error-message", 4, "ngIf"], ["data-automation-id", "login-copyright", 1, "adf-copyright"], ["ngFor", "", 3, "ngForOf", "ngForTemplate"], ["id", "adf-login-img-logo", 1, "adf-img-logo", 3, "src", "alt"], ["id", "login-error", "data-automation-id", "login-error", 1, "adf-error", "adf-error-message"], [1, "adf-error-icon"], [1, "adf-login-error-message"], [1, "adf-login__field", 3, "ngClass"], ["floatPlaceholder", "never", "color", "primary", 1, "adf-full-width"], ["matInput", "", "type", "text", "formControlName", "username", "autocapitalize", "none", "id", "username", "data-automation-id", "username", 1, "adf-full-width", 3, "placeholder", "blur"], ["class", "adf-login-validation", "for", "username", 4, "ngIf"], [1, "adf-login__field"], ["matInput", "", "formControlName", "password", "id", "password", "data-automation-id", "password", 3, "placeholder", "type"], ["matSuffix", "", "mat-icon-button", "", "type", "button", 3, "click", "keyup.enter"], [1, "adf-login-password-icon"], ["class", "adf-login-validation", "for", "password", 4, "ngIf"], ["type", "submit", "id", "login-button", "mat-raised-button", "", "color", "accent", "data-automation-id", "login-button", 1, "adf-login-button", 3, "disabled"], ["class", "adf-login-button-label", 4, "ngIf"], ["class", "adf-interactive-login-label", 4, "ngIf"], ["class", "adf-login__remember-me", 4, "ngIf"], ["for", "username", 1, "adf-login-validation"], ["id", "username-error", "data-automation-id", "username-error", 1, "adf-login-error"], ["for", "password", 1, "adf-login-validation"], ["id", "password-required", "data-automation-id", "password-required", 1, "adf-login-error"], [1, "adf-login-button-label"], [1, "adf-interactive-login-label"], [1, "adf-login-spinner-container"], ["id", "checking-spinner", 1, "adf-login-checking-spinner", 3, "diameter"], [1, "adf-welcome-icon"], [1, "adf-login__remember-me"], ["id", "adf-login-remember", "color", "primary", 1, "adf-login-remember-me", 3, "checked", "change"], ["type", "button", "id", "login-button-sso", "mat-raised-button", "", "color", "primary", "data-automation-id", "login-button-sso", 1, "adf-login-button", 3, "click"], [1, "adf-login-action-container"], ["class", "adf-login-action", 4, "ngIf"], [1, "adf-login-action"], ["id", "adf-login-action-left", 1, "adf-login-action-left"], [3, "href"], ["id", "adf-login-action-right", 1, "adf-login-action-right"]], template: function LoginComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "mat-card", 3);
        ɵngcc0.ɵɵelementStart(4, "form", 4);
        ɵngcc0.ɵɵlistener("submit", function LoginComponent_Template_form_submit_4_listener() { return ctx.onSubmit(ctx.form.value); });
        ɵngcc0.ɵɵelementStart(5, "mat-card-header");
        ɵngcc0.ɵɵelementStart(6, "mat-card-title");
        ɵngcc0.ɵɵelementStart(7, "div", 5);
        ɵngcc0.ɵɵtemplate(8, LoginComponent_8_Template, 1, 4, undefined, 6);
        ɵngcc0.ɵɵtemplate(9, LoginComponent_img_9_Template, 2, 4, "img", 7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "mat-card-content", 8);
        ɵngcc0.ɵɵelementStart(11, "div", 9);
        ɵngcc0.ɵɵtemplate(12, LoginComponent_div_12_Template, 6, 3, "div", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(13, LoginComponent_div_13_Template, 23, 29, "div", 6);
        ɵngcc0.ɵɵtemplate(14, LoginComponent_div_14_Template, 6, 6, "div", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(15, LoginComponent_mat_card_actions_15_Template, 4, 2, "mat-card-actions", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(16, "div", 11);
        ɵngcc0.ɵɵtext(17);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("background-image", ctx.getBackgroundUrlImageUrl());
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("formGroup", ctx.form);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.headerTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.headerTemplate);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isError);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.implicitFlow);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.implicitFlow);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.footerTemplate || ctx.showLoginActions);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.copyrightText, " ");
    } }, directives: [ɵngcc10.MatCard, ɵngcc1.ɵangular_packages_forms_forms_y, ɵngcc1.NgControlStatusGroup, ɵngcc1.FormGroupDirective, ɵngcc10.MatCardHeader, ɵngcc10.MatCardTitle, ɵngcc11.NgIf, ɵngcc10.MatCardContent, ɵngcc11.NgForOf, ɵngcc12.MatIcon, ɵngcc11.NgClass, ɵngcc13.MatFormField, ɵngcc14.MatInput, ɵngcc1.DefaultValueAccessor, ɵngcc1.NgControlStatus, ɵngcc1.FormControlName, ɵngcc15.MatButton, ɵngcc13.MatSuffix, ɵngcc16.MatSpinner, ɵngcc17.MatCheckbox, ɵngcc10.MatCardActions], pipes: [ɵngcc18.TranslatePipe], encapsulation: 2 });
LoginComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: AuthenticationService },
    { type: TranslationService },
    { type: LogService },
    { type: Router },
    { type: AppConfigService },
    { type: UserPreferencesService },
    { type: ActivatedRoute },
    { type: DomSanitizer },
    { type: AlfrescoApiService }
];
LoginComponent.propDecorators = {
    showRememberMe: [{ type: Input }],
    showLoginActions: [{ type: Input }],
    needHelpLink: [{ type: Input }],
    registerLink: [{ type: Input }],
    logoImageUrl: [{ type: Input }],
    backgroundImageUrl: [{ type: Input }],
    copyrightText: [{ type: Input }],
    fieldsValidation: [{ type: Input }],
    successRoute: [{ type: Input }],
    success: [{ type: Output }],
    error: [{ type: Output }],
    executeSubmit: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LoginComponent, [{
        type: Component,
        args: [{
                selector: 'adf-login',
                template: "<div class=\"adf-login-content\" [style.background-image]=\"getBackgroundUrlImageUrl()\">\n    <div class=\"adf-ie11FixerParent\">\n        <div class=\"adf-ie11FixerChild\">\n\n            <mat-card class=\"adf-login-card-wide\">\n                <form id=\"adf-login-form\" [formGroup]=\"form\" (submit)=\"onSubmit(form.value)\" autocomplete=\"off\">\n                    <mat-card-header>\n                        <mat-card-title>\n                            <div class=\"adf-alfresco-logo\">\n                                <!--HEADER TEMPLATE-->\n                                <ng-template *ngIf=\"headerTemplate\"\n                                             ngFor [ngForOf]=\"[data]\"\n                                             [ngForTemplate]=\"headerTemplate\">\n                                </ng-template>\n                                <img *ngIf=\"!headerTemplate\" id=\"adf-login-img-logo\" class=\"adf-img-logo\" [src]=\"logoImageUrl\"\n                                     alt=\"{{'LOGIN.LOGO' | translate }}\">\n                            </div>\n                        </mat-card-title>\n                    </mat-card-header>\n\n                    <mat-card-content class=\"adf-login-controls\">\n\n                        <!--ERRORS AREA-->\n                        <div class=\"adf-error-container\">\n                            <div *ngIf=\"isError\" id=\"login-error\" data-automation-id=\"login-error\"\n                                 class=\"adf-error  adf-error-message\">\n                                <mat-icon class=\"adf-error-icon\">warning</mat-icon>\n                                <span class=\"adf-login-error-message\">{{errorMsg | translate }}</span>\n                            </div>\n                        </div>\n\n                        <div *ngIf=\"!implicitFlow\">\n\n                            <!--USERNAME FIELD-->\n                            <div class=\"adf-login__field\"\n                                 [ngClass]=\"{'adf-is-invalid': isErrorStyle(form.controls.username)}\">\n                                <mat-form-field class=\"adf-full-width\" floatPlaceholder=\"never\" color=\"primary\">\n                                    <input matInput placeholder=\"{{'LOGIN.LABEL.USERNAME' | translate }}\"\n                                           type=\"text\"\n                                           class=\"adf-full-width\"\n                                           formControlName=\"username\"\n                                           autocapitalize=\"none\"\n                                           id=\"username\"\n                                           data-automation-id=\"username\"\n                                           (blur)=\"trimUsername($event)\">\n                                </mat-form-field>\n\n                                <span class=\"adf-login-validation\" for=\"username\" *ngIf=\"formError['username']\">\n                                <span id=\"username-error\" class=\"adf-login-error\" data-automation-id=\"username-error\">{{formError['username'] | translate }}</span>\n                            </span>\n                            </div>\n\n                            <!--PASSWORD FIELD-->\n                            <div class=\"adf-login__field\">\n                                <mat-form-field class=\"adf-full-width\" floatPlaceholder=\"never\" color=\"primary\">\n                                    <input matInput placeholder=\"{{'LOGIN.LABEL.PASSWORD' | translate }}\"\n                                           [type]=\"isPasswordShow ? 'text' : 'password'\"\n                                           formControlName=\"password\"\n                                           id=\"password\"\n                                           data-automation-id=\"password\">\n                                        <button\n                                            matSuffix\n                                            mat-icon-button\n                                            type=\"button\"\n                                            [attr.aria-label]=\"(isPasswordShow ?\n                                                    'LOGIN.ARIA-LABEL.HIDE-PASSWORD':\n                                                    'LOGIN.ARIA-LABEL.SHOW-PASSWORD'\n                                                ) | translate\"\n                                            (click)=\"toggleShowPassword($event)\"\n                                            (keyup.enter)=\"toggleShowPassword($event)\"\n                                            [attr.data-automation-id]=\"isPasswordShow ? 'hide_password':'show_password'\">\n                                           <mat-icon class=\"adf-login-password-icon\">\n                                               {{ isPasswordShow ? 'visibility':'visibility_off' }}\n                                            </mat-icon>\n                                       </button>\n                                </mat-form-field>\n                                <span class=\"adf-login-validation\" for=\"password\" *ngIf=\"formError['password']\">\n                                <span id=\"password-required\" class=\"adf-login-error\"\n                                      data-automation-id=\"password-required\">{{formError['password'] | translate }}</span>\n                            </span>\n                            </div>\n\n                            <!--CUSTOM CONTENT-->\n                            <ng-content></ng-content>\n\n                            <br>\n                            <button type=\"submit\" id=\"login-button\"\n                                    class=\"adf-login-button\"\n                                    mat-raised-button color=\"accent\"\n                                    [class.adf-isChecking]=\"actualLoginStep === LoginSteps.Checking\"\n                                    [class.adf-isWelcome]=\"actualLoginStep === LoginSteps.Welcome\"\n                                    data-automation-id=\"login-button\" [disabled]=\"!form.valid\"\n                                    [attr.aria-label]=\"'LOGIN.BUTTON.LOGIN' | translate\">\n\n                                <span *ngIf=\"actualLoginStep === LoginSteps.Landing\" class=\"adf-login-button-label\">{{ 'LOGIN.BUTTON.LOGIN' | translate }}</span>\n\n                                <div *ngIf=\"actualLoginStep === LoginSteps.Checking\"\n                                     class=\"adf-interactive-login-label\">\n                                    <span\n                                        class=\"adf-login-button-label\">{{ 'LOGIN.BUTTON.CHECKING' | translate }}</span>\n                                    <div class=\"adf-login-spinner-container\">\n                                        <mat-spinner id=\"checking-spinner\" class=\"adf-login-checking-spinner\"\n                                                     [diameter]=\"25\"></mat-spinner>\n                                    </div>\n                                </div>\n\n\n                                <div *ngIf=\"actualLoginStep === LoginSteps.Welcome\" class=\"adf-interactive-login-label\">\n                                    <span class=\"adf-login-button-label\">{{ 'LOGIN.BUTTON.WELCOME' | translate }}</span>\n                                    <mat-icon class=\"adf-welcome-icon\">done</mat-icon>\n                                </div>\n\n                            </button>\n                            <div *ngIf=\"showRememberMe\" class=\"adf-login__remember-me\">\n                                <mat-checkbox id=\"adf-login-remember\" color=\"primary\" class=\"adf-login-remember-me\"\n                                              [checked]=\"rememberMe\"\n                                              (change)=\"rememberMe = !rememberMe\">{{ 'LOGIN.LABEL.REMEMBER' | translate }}\n                                </mat-checkbox>\n                            </div>\n                        </div>\n\n                        <div *ngIf=\"implicitFlow\">\n                            <button type=\"button\" (click)=\"implicitLogin()\" id=\"login-button-sso\"\n                                    [attr.aria-label]=\"'LOGIN.BUTTON.SSO' | translate\"\n                                    class=\"adf-login-button\"\n                                    mat-raised-button color=\"primary\"\n                                    data-automation-id=\"login-button-sso\">\n                                <span  class=\"adf-login-button-label\">{{ 'LOGIN.BUTTON.SSO' | translate }}</span>\n                            </button>\n                        </div>\n\n                    </mat-card-content>\n\n                    <mat-card-actions *ngIf=\"footerTemplate || showLoginActions\">\n\n                        <div class=\"adf-login-action-container\">\n                            <!--FOOTER TEMPLATE-->\n                            <ng-template *ngIf=\"footerTemplate\"\n                                         ngFor [ngForOf]=\"[data]\"\n                                         [ngForTemplate]=\"footerTemplate\">\n                            </ng-template>\n                            <div class=\"adf-login-action\" *ngIf=\"!footerTemplate && showLoginActions\">\n                                <div id=\"adf-login-action-left\" class=\"adf-login-action-left\">\n                                    <a href=\"{{needHelpLink}}\">{{'LOGIN.ACTION.HELP' | translate }}</a>\n                                </div>\n                                <div id=\"adf-login-action-right\" class=\"adf-login-action-right\">\n                                    <a href=\"{{registerLink}}\">{{'LOGIN.ACTION.REGISTER' | translate }}</a>\n                                </div>\n                            </div>\n                        </div>\n                    </mat-card-actions>\n\n                </form>\n            </mat-card>\n\n            <div class=\"adf-copyright\" data-automation-id=\"login-copyright\">\n                {{ copyrightText }}\n            </div>\n\n        </div>\n    </div>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                host: {
                    class: 'adf-login'
                }
            }]
    }], function () { return [{ type: ɵngcc1.FormBuilder }, { type: ɵngcc2.AuthenticationService }, { type: ɵngcc3.TranslationService }, { type: ɵngcc4.LogService }, { type: ɵngcc5.Router }, { type: ɵngcc6.AppConfigService }, { type: ɵngcc7.UserPreferencesService }, { type: ɵngcc5.ActivatedRoute }, { type: ɵngcc8.DomSanitizer }, { type: ɵngcc9.AlfrescoApiService }]; }, { showRememberMe: [{
            type: Input
        }], showLoginActions: [{
            type: Input
        }], needHelpLink: [{
            type: Input
        }], registerLink: [{
            type: Input
        }], logoImageUrl: [{
            type: Input
        }], backgroundImageUrl: [{
            type: Input
        }], copyrightText: [{
            type: Input
        }], successRoute: [{
            type: Input
        }], success: [{
            type: Output
        }], error: [{
            type: Output
        }], executeSubmit: [{
            type: Output
        }], fieldsValidation: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4uY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS9sb2dpbi9jb21wb25lbnRzL2xvZ2luLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBRUgsT0FBTyxFQUNILFNBQVMsRUFBRSxZQUFZLEVBQ3ZCLEtBQUssRUFBVSxNQUFNLEVBQWUsaUJBQWlCLEVBQ3hELE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBbUIsV0FBVyxFQUFhLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFVLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDOUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3hELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBRXpFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNsRSxPQUFPLEVBQ0gsZ0JBQWdCLEVBQ2hCLGVBQWUsRUFDbEIsTUFBTSxxQ0FBcUMsQ0FBQztBQUU3QyxP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QUdHLEtBQUs7QUFDUiwyQkFHRyxLQUFLO0FBQ1Isc0JBR0csTUFBTTtBQUNULG9CQUdHLE1BQU07QUFDVCw0QkFHRyxNQUFNO0FBQ1Y7Ozs7OzJ1RUEzRHdDLGtCQUNyQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxrQkFDckMsSUFBSSxFQUFFLHNCQUNGLEtBQUssRUFBRSxXQUFXLGtCQUNyQixjQUNKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBc0RFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LCBPbkluaXQsIE91dHB1dCwgVGVtcGxhdGVSZWYsIFZpZXdFbmNhcHN1bGF0aW9uLCBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBSb3V0ZXIsIEFjdGl2YXRlZFJvdXRlLCBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdHJhbnNsYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdXNlci1wcmVmZXJlbmNlcy5zZXJ2aWNlJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2FsZnJlc2NvLWFwaS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgTG9naW5FcnJvckV2ZW50IH0gZnJvbSAnLi4vbW9kZWxzL2xvZ2luLWVycm9yLmV2ZW50JztcbmltcG9ydCB7IExvZ2luU3VibWl0RXZlbnQgfSBmcm9tICcuLi9tb2RlbHMvbG9naW4tc3VibWl0LmV2ZW50JztcbmltcG9ydCB7IExvZ2luU3VjY2Vzc0V2ZW50IH0gZnJvbSAnLi4vbW9kZWxzL2xvZ2luLXN1Y2Nlc3MuZXZlbnQnO1xuaW1wb3J0IHtcbiAgICBBcHBDb25maWdTZXJ2aWNlLFxuICAgIEFwcENvbmZpZ1ZhbHVlc1xufSBmcm9tICcuLi8uLi9hcHAtY29uZmlnL2FwcC1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBPYXV0aENvbmZpZ01vZGVsIH0gZnJvbSAnLi4vLi4vbW9kZWxzL29hdXRoLWNvbmZpZy5tb2RlbCc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIsIFNhZmVTdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5lbnVtIExvZ2luU3RlcHMge1xuICAgIExhbmRpbmcgPSAwLFxuICAgIENoZWNraW5nID0gMSxcbiAgICBXZWxjb21lID0gMlxufVxuXG5pbnRlcmZhY2UgVmFsaWRhdGlvbk1lc3NhZ2Uge1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgcGFyYW1zPzogYW55O1xufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1sb2dpbicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xvZ2luLmNvbXBvbmVudC5odG1sJyxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgY2xhc3M6ICdhZGYtbG9naW4nXG4gICAgfVxufSlcbmV4cG9ydCBjbGFzcyBMb2dpbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBpc1Bhc3N3b3JkU2hvdzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogU2hvdWxkIHRoZSBgUmVtZW1iZXIgbWVgIGNoZWNrYm94IGJlIHNob3duPyBXaGVuIHNlbGVjdGVkLCB0aGlzXG4gICAgICogb3B0aW9uIHdpbGwgcmVtZW1iZXIgdGhlIGxvZ2dlZC1pbiB1c2VyIGFmdGVyIHRoZSBicm93c2VyIGlzIGNsb3NlZFxuICAgICAqIHRvIGF2b2lkIGxvZ2dpbmcgaW4gcmVwZWF0ZWRseS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dSZW1lbWJlck1lOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBTaG91bGQgdGhlIGV4dHJhIGFjdGlvbnMgKGBOZWVkIEhlbHBgLCBgUmVnaXN0ZXJgLCBldGMpIGJlIHNob3duPyAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0xvZ2luQWN0aW9uczogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogU2V0cyB0aGUgVVJMIG9mIHRoZSBORUVEIEhFTFAgbGluayBpbiB0aGUgZm9vdGVyLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbmVlZEhlbHBMaW5rOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBTZXRzIHRoZSBVUkwgb2YgdGhlIFJFR0lTVEVSIGxpbmsgaW4gdGhlIGZvb3Rlci4gKi9cbiAgICBASW5wdXQoKVxuICAgIHJlZ2lzdGVyTGluazogc3RyaW5nID0gJyc7XG5cbiAgICAvKiogUGF0aCB0byBhIGN1c3RvbSBsb2dvIGltYWdlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbG9nb0ltYWdlVXJsOiBzdHJpbmcgPSAnLi9hc3NldHMvaW1hZ2VzL2FsZnJlc2NvLWxvZ28uc3ZnJztcblxuICAgIC8qKiBQYXRoIHRvIGEgY3VzdG9tIGJhY2tncm91bmQgaW1hZ2UuICovXG4gICAgQElucHV0KClcbiAgICBiYWNrZ3JvdW5kSW1hZ2VVcmw6IHN0cmluZyA9ICcuL2Fzc2V0cy9pbWFnZXMvYmFja2dyb3VuZC5zdmcnO1xuXG4gICAgLyoqIFRoZSBjb3B5cmlnaHQgdGV4dCBiZWxvdyB0aGUgbG9naW4gYm94LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29weXJpZ2h0VGV4dDogc3RyaW5nID0gJ1xcdTAwQTkgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLic7XG5cbiAgICAvKiogQ3VzdG9tIHZhbGlkYXRpb24gcnVsZXMgZm9yIHRoZSBsb2dpbiBmb3JtLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZmllbGRzVmFsaWRhdGlvbjogYW55O1xuXG4gICAgLyoqIFJvdXRlIHRvIHJlZGlyZWN0IHRvIG9uIHN1Y2Nlc3NmdWwgbG9naW4uICovXG4gICAgQElucHV0KClcbiAgICBzdWNjZXNzUm91dGU6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBsb2dpbiBpcyBzdWNjZXNzZnVsLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPExvZ2luU3VjY2Vzc0V2ZW50PigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgbG9naW4gZmFpbHMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPExvZ2luRXJyb3JFdmVudD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGxvZ2luIGZvcm0gaXMgc3VibWl0dGVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGV4ZWN1dGVTdWJtaXQgPSBuZXcgRXZlbnRFbWl0dGVyPExvZ2luU3VibWl0RXZlbnQ+KCk7XG5cbiAgICBpbXBsaWNpdEZsb3c6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGZvcm06IEZvcm1Hcm91cDtcbiAgICBpc0Vycm9yOiBib29sZWFuID0gZmFsc2U7XG4gICAgZXJyb3JNc2c6IHN0cmluZztcbiAgICBhY3R1YWxMb2dpblN0ZXA6IGFueSA9IExvZ2luU3RlcHMuTGFuZGluZztcbiAgICBMb2dpblN0ZXBzID0gTG9naW5TdGVwcztcbiAgICByZW1lbWJlck1lOiBib29sZWFuID0gdHJ1ZTtcbiAgICBmb3JtRXJyb3I6IHsgW2lkOiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgICBtaW5MZW5ndGg6IG51bWJlciA9IDI7XG4gICAgZm9vdGVyVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gICAgaGVhZGVyVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gICAgZGF0YTogYW55O1xuXG4gICAgcHJpdmF0ZSBfbWVzc2FnZTogeyBbaWQ6IHN0cmluZ106IHsgW2lkOiBzdHJpbmddOiBWYWxpZGF0aW9uTWVzc2FnZSB9IH07XG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIF9mYjogRm9ybUJ1aWxkZXIsXG4gICAgICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhlbnRpY2F0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgdXNlclByZWZlcmVuY2VzOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcixcbiAgICAgICAgcHJpdmF0ZSBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZVxuICAgICkge1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmluaXRGb3JtRXJyb3IoKTtcbiAgICAgICAgdGhpcy5pbml0Rm9ybUZpZWxkc0RlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5pbml0Rm9ybUZpZWxkc01lc3NhZ2VzKCk7XG5cbiAgICAgICAgdGhpcy5zdWNjZXNzUm91dGUgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPignc3VjY2Vzc1JvdXRlJywgdGhpcy5zdWNjZXNzUm91dGUpO1xuXG4gICAgICAgIGlmICh0aGlzLmF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW3RoaXMuc3VjY2Vzc1JvdXRlXSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmF1dGhTZXJ2aWNlLmlzT2F1dGgoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9hdXRoOiBPYXV0aENvbmZpZ01vZGVsID0gdGhpcy5hcHBDb25maWcuZ2V0PE9hdXRoQ29uZmlnTW9kZWw+KEFwcENvbmZpZ1ZhbHVlcy5PQVVUSENPTkZJRywgbnVsbCk7XG4gICAgICAgICAgICAgICAgaWYgKG9hdXRoICYmIG9hdXRoLnNpbGVudExvZ2luKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVkaXJlY3RUb0ltcGxpY2l0TG9naW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9hdXRoICYmIG9hdXRoLmltcGxpY2l0Rmxvdykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmltcGxpY2l0RmxvdyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnJvdXRlLnF1ZXJ5UGFyYW1zLnN1YnNjcmliZSgocGFyYW1zOiBQYXJhbXMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBwYXJhbXNbJ3JlZGlyZWN0VXJsJ107XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPihBcHBDb25maWdWYWx1ZXMuUFJPVklERVJTKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYXV0aFNlcnZpY2Uuc2V0UmVkaXJlY3QoeyBwcm92aWRlciwgdXJsIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5maWVsZHNWYWxpZGF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm0gPSB0aGlzLl9mYi5ncm91cCh0aGlzLmZpZWxkc1ZhbGlkYXRpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5mb3JtLnZhbHVlQ2hhbmdlc1xuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGRhdGEgPT4gdGhpcy5vblZhbHVlQ2hhbmdlZChkYXRhKSk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5uZXh0KHRydWUpO1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICBzdWJtaXQoKSB7XG4gICAgICAgIHRoaXMub25TdWJtaXQodGhpcy5mb3JtLnZhbHVlKTtcbiAgICB9XG5cbiAgICByZWRpcmVjdFRvSW1wbGljaXRMb2dpbigpIHtcbiAgICAgICAgdGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5vYXV0aDJBdXRoLmltcGxpY2l0TG9naW4oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRob2QgY2FsbGVkIG9uIHN1Ym1pdCBmb3JtXG4gICAgICogQHBhcmFtIHZhbHVlc1xuICAgICAqIEBwYXJhbSBldmVudFxuICAgICAqL1xuICAgIG9uU3VibWl0KHZhbHVlczogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlzYWJsZUVycm9yKCk7XG5cbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBMb2dpblN1Ym1pdEV2ZW50KHtcbiAgICAgICAgICAgIGNvbnRyb2xzOiB7IHVzZXJuYW1lOiB0aGlzLmZvcm0uY29udHJvbHMudXNlcm5hbWUgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5leGVjdXRlU3VibWl0LmVtaXQoYXJncyk7XG5cbiAgICAgICAgaWYgKCFhcmdzLmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGVyZm9ybUxvZ2luKHZhbHVlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbXBsaWNpdExvZ2luKCkge1xuICAgICAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFt0aGlzLnN1Y2Nlc3NSb3V0ZV0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2Uuc3NvSW1wbGljaXRMb2dpbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBtZXRob2QgY2hlY2sgdGhlIGVycm9yIGluIHRoZSBmb3JtIGFuZCBwdXNoIHRoZSBlcnJvciBpbiB0aGUgZm9ybUVycm9yIG9iamVjdFxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICovXG4gICAgb25WYWx1ZUNoYW5nZWQoZGF0YTogYW55KSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZUVycm9yKCk7XG4gICAgICAgIGZvciAoY29uc3QgZmllbGQgaW4gdGhpcy5mb3JtRXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChmaWVsZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9ybUVycm9yW2ZpZWxkXSA9ICcnO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Vycm9yID1cbiAgICAgICAgICAgICAgICAgICAgKHRoaXMuZm9ybS5jb250cm9sc1tmaWVsZF0uZXJyb3JzICYmIGRhdGFbZmllbGRdICE9PSAnJykgfHxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMuZm9ybS5jb250cm9sc1tmaWVsZF0uZGlydHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzLmZvcm0uY29udHJvbHNbZmllbGRdLnZhbGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5mb3JtLmNvbnRyb2xzW2ZpZWxkXS5lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5fbWVzc2FnZVtmaWVsZF1ba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuaW5zdGFudChtZXNzYWdlLnZhbHVlLCBtZXNzYWdlLnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybUVycm9yW2ZpZWxkXSArPSB0cmFuc2xhdGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgcGVyZm9ybUxvZ2luKHZhbHVlczogYW55KSB7XG4gICAgICAgIHRoaXMuYWN0dWFsTG9naW5TdGVwID0gTG9naW5TdGVwcy5DaGVja2luZztcbiAgICAgICAgdGhpcy5hdXRoU2VydmljZVxuICAgICAgICAgICAgLmxvZ2luKHZhbHVlcy51c2VybmFtZSwgdmFsdWVzLnBhc3N3b3JkLCB0aGlzLnJlbWVtYmVyTWUpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICh0b2tlbjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZGlyZWN0VXJsID0gdGhpcy5hdXRoU2VydmljZS5nZXRSZWRpcmVjdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0dWFsTG9naW5TdGVwID0gTG9naW5TdGVwcy5XZWxjb21lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJQcmVmZXJlbmNlcy5zZXRTdG9yYWdlUHJlZml4KHZhbHVlcy51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wYXNzd29yZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IExvZ2luU3VjY2Vzc0V2ZW50KHRva2VuLCB2YWx1ZXMudXNlcm5hbWUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZGlyZWN0VXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLnNldFJlZGlyZWN0KG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChyZWRpcmVjdFVybCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdWNjZXNzUm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFt0aGlzLnN1Y2Nlc3NSb3V0ZV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3R1YWxMb2dpblN0ZXAgPSBMb2dpblN0ZXBzLkxhbmRpbmc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheUVycm9yTWVzc2FnZShlcnIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQobmV3IExvZ2luRXJyb3JFdmVudChlcnIpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICgpID0+IHRoaXMubG9nU2VydmljZS5pbmZvKCdMb2dpbiBkb25lJylcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgYW5kIGRpc3BsYXkgdGhlIHJpZ2h0IGVycm9yIG1lc3NhZ2UgaW4gdGhlIFVJXG4gICAgICovXG4gICAgcHJpdmF0ZSBkaXNwbGF5RXJyb3JNZXNzYWdlKGVycjogYW55KTogdm9pZCB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGVyci5lcnJvciAmJlxuICAgICAgICAgICAgZXJyLmVycm9yLmNyb3NzRG9tYWluICYmXG4gICAgICAgICAgICBlcnIuZXJyb3IubWVzc2FnZS5pbmRleE9mKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nKSAhPT0gLTFcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yTXNnID0gZXJyLmVycm9yLm1lc3NhZ2U7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICBlcnIuc3RhdHVzID09PSA0MDMgJiZcbiAgICAgICAgICAgIGVyci5tZXNzYWdlLmluZGV4T2YoJ0ludmFsaWQgQ1NSRi10b2tlbicpICE9PSAtMVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNc2cgPSAnTE9HSU4uTUVTU0FHRVMuTE9HSU4tRVJST1ItQ1NSRic7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICBlcnIuc3RhdHVzID09PSA0MDMgJiZcbiAgICAgICAgICAgIGVyci5tZXNzYWdlLmluZGV4T2YoJ1RoZSBzeXN0ZW0gaXMgY3VycmVudGx5IGluIHJlYWQtb25seSBtb2RlJykgIT09XG4gICAgICAgICAgICAtMVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JNc2cgPSAnTE9HSU4uTUVTU0FHRVMuTE9HSU4tRUNNLUxJQ0VOU0UnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lcnJvck1zZyA9ICdMT0dJTi5NRVNTQUdFUy5MT0dJTi1FUlJPUi1DUkVERU5USUFMUyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBjdXN0b20gZm9ybSBlcnJvciBmb3IgYSBmaWVsZFxuICAgICAqIEBwYXJhbSBmaWVsZFxuICAgICAqIEBwYXJhbSBtc2dcbiAgICAgKi9cbiAgICBwdWJsaWMgYWRkQ3VzdG9tRm9ybUVycm9yKGZpZWxkOiBzdHJpbmcsIG1zZzogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZm9ybUVycm9yW2ZpZWxkXSArPSBtc2c7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgY3VzdG9tIHZhbGlkYXRpb24gcnVsZSBlcnJvciBmb3IgYSBmaWVsZFxuICAgICAqIEBwYXJhbSBmaWVsZFxuICAgICAqIEBwYXJhbSBydWxlSWQgLSBpLmUuIHJlcXVpcmVkIHwgbWlubGVuZ3RoIHwgbWF4bGVuZ3RoXG4gICAgICogQHBhcmFtIG1zZ1xuICAgICAqL1xuICAgIGFkZEN1c3RvbVZhbGlkYXRpb25FcnJvcihcbiAgICAgICAgZmllbGQ6IHN0cmluZyxcbiAgICAgICAgcnVsZUlkOiBzdHJpbmcsXG4gICAgICAgIG1zZzogc3RyaW5nLFxuICAgICAgICBwYXJhbXM/OiBhbnlcbiAgICApIHtcbiAgICAgICAgdGhpcy5fbWVzc2FnZVtmaWVsZF1bcnVsZUlkXSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBtc2csXG4gICAgICAgICAgICBwYXJhbXNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IGFuZCBoaWRlIHRoZSBwYXNzd29yZCB2YWx1ZS5cbiAgICAgKi9cbiAgICB0b2dnbGVTaG93UGFzc3dvcmQoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLmlzUGFzc3dvcmRTaG93ID0gIXRoaXMuaXNQYXNzd29yZFNob3c7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIG1ldGhvZCByZXR1cm4gaWYgYSBmaWVsZCBpcyB2YWxpZCBvciBub3RcbiAgICAgKiBAcGFyYW0gZmllbGRcbiAgICAgKi9cbiAgICBpc0Vycm9yU3R5bGUoZmllbGQ6IEFic3RyYWN0Q29udHJvbCkge1xuICAgICAgICByZXR1cm4gIWZpZWxkLnZhbGlkICYmIGZpZWxkLmRpcnR5ICYmICFmaWVsZC5wcmlzdGluZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmltIHVzZXJuYW1lXG4gICAgICovXG4gICAgdHJpbVVzZXJuYW1lKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICB9XG5cbiAgICBnZXRCYWNrZ3JvdW5kVXJsSW1hZ2VVcmwoKTogU2FmZVN0eWxlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShgdXJsKCR7dGhpcy5iYWNrZ3JvdW5kSW1hZ2VVcmx9KWApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlZmF1bHQgZm9ybUVycm9yIHZhbHVlc1xuICAgICAqL1xuICAgIHByaXZhdGUgaW5pdEZvcm1FcnJvcigpIHtcbiAgICAgICAgdGhpcy5mb3JtRXJyb3IgPSB7XG4gICAgICAgICAgICB1c2VybmFtZTogJycsXG4gICAgICAgICAgICBwYXNzd29yZDogJydcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0IGZvcm0gZmllbGRzIG1lc3NhZ2VzXG4gICAgICovXG4gICAgcHJpdmF0ZSBpbml0Rm9ybUZpZWxkc01lc3NhZ2VzKCkge1xuICAgICAgICB0aGlzLl9tZXNzYWdlID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDoge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ0xPR0lOLk1FU1NBR0VTLlVTRVJOQU1FLVJFUVVJUkVEJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWlubGVuZ3RoOiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnTE9HSU4uTUVTU0FHRVMuVVNFUk5BTUUtTUlOJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5MZW5ndGg6IHRoaXMubWluTGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXNzd29yZDoge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnTE9HSU4uTUVTU0FHRVMuUEFTU1dPUkQtUkVRVUlSRUQnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdEZvcm1GaWVsZHNEZWZhdWx0KCkge1xuICAgICAgICB0aGlzLmZvcm0gPSB0aGlzLl9mYi5ncm91cCh7XG4gICAgICAgICAgICB1c2VybmFtZTogWycnLCBWYWxpZGF0b3JzLmNvbXBvc2UoW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluTGVuZ3RoKHRoaXMubWluTGVuZ3RoKV0pXSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGUgdGhlIGVycm9yIGZsYWdcbiAgICAgKi9cbiAgICBwcml2YXRlIGRpc2FibGVFcnJvcigpIHtcbiAgICAgICAgdGhpcy5pc0Vycm9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5pdEZvcm1FcnJvcigpO1xuICAgIH1cbn1cbiJdfQ==