/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter } from "tslib";
import { Directive, HostListener, Input, Output, EventEmitter } from '@angular/core';
import { AlfrescoApiService } from '../services/alfresco-api.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/alfresco-api.service';
export class LibraryFavoriteDirective {
    constructor(alfrescoApiService) {
        this.alfrescoApiService = alfrescoApiService;
        this.library = null;
        this.toggle = new EventEmitter();
        this.error = new EventEmitter();
        this.targetLibrary = null;
    }
    onClick() {
        const guid = this.targetLibrary.entry.guid;
        if (this.targetLibrary.isFavorite) {
            this.removeFavorite(guid);
        }
        else {
            this.addFavorite({
                target: {
                    site: {
                        guid
                    }
                }
            });
        }
    }
    ngOnChanges(changes) {
        if (!changes.library.currentValue) {
            this.targetLibrary = null;
            return;
        }
        this.targetLibrary = changes.library.currentValue;
        this.markFavoriteLibrary(changes.library.currentValue);
    }
    isFavorite() {
        return this.targetLibrary && this.targetLibrary.isFavorite;
    }
    markFavoriteLibrary(library) {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.targetLibrary.isFavorite === undefined) {
                try {
                    yield this.alfrescoApiService.peopleApi.getFavoriteSite('-me-', library.entry.id);
                    this.targetLibrary.isFavorite = true;
                }
                catch (_a) {
                    this.targetLibrary.isFavorite = false;
                }
            }
            else {
                this.targetLibrary = library;
            }
        });
    }
    addFavorite(favoriteBody) {
        this.alfrescoApiService.peopleApi
            .addFavorite('-me-', favoriteBody)
            .then((libraryEntry) => {
            this.targetLibrary.isFavorite = true;
            this.toggle.emit(libraryEntry);
        })
            .catch((error) => this.error.emit(error));
    }
    removeFavorite(favoriteId) {
        this.alfrescoApiService.favoritesApi
            .removeFavoriteSite('-me-', favoriteId)
            .then((libraryBody) => {
            this.targetLibrary.isFavorite = false;
            this.toggle.emit(libraryBody);
        })
            .catch((error) => this.error.emit(error));
    }
}
LibraryFavoriteDirective.ɵfac = function LibraryFavoriteDirective_Factory(t) { return new (t || LibraryFavoriteDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AlfrescoApiService)); };
LibraryFavoriteDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LibraryFavoriteDirective, selectors: [["", "adf-favorite-library", ""]], hostBindings: function LibraryFavoriteDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function LibraryFavoriteDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } }, inputs: { library: ["adf-favorite-library", "library"] }, outputs: { toggle: "toggle", error: "error" }, exportAs: ["favoriteLibrary"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
LibraryFavoriteDirective.ctorParameters = () => [
    { type: AlfrescoApiService }
];
LibraryFavoriteDirective.propDecorators = {
    library: [{ type: Input, args: ['adf-favorite-library',] }],
    toggle: [{ type: Output }],
    error: [{ type: Output }],
    onClick: [{ type: HostListener, args: ['click',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LibraryFavoriteDirective, [{
        type: Directive,
        args: [{
                selector: '[adf-favorite-library]',
                exportAs: 'favoriteLibrary'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }]; }, { library: [{
            type: Input,
            args: ['adf-favorite-library']
        }], toggle: [{
            type: Output
        }], error: [{
            type: Output
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlicmFyeS1mYXZvcml0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL2RpcmVjdGl2ZXMvbGlicmFyeS1mYXZvcml0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFaEcsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7OztBQVl0RSxNQUFNLE9BQU8sd0JBQXdCO0FBQUcsSUEyQnBDLFlBQW9CLGtCQUFzQztBQUFJLFFBQTFDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7QUFBQyxRQXpCM0QsWUFBTyxHQUFrQixJQUFJLENBQUM7QUFDbEMsUUFDYyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztBQUMvQyxRQUNjLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO0FBQzlDLFFBQ1ksa0JBQWEsR0FBRyxJQUFJLENBQUM7QUFDakMsSUFrQmlFLENBQUM7QUFDbEUsSUFqQkksT0FBTztBQUNYLFFBQVEsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0FBQ25ELFFBQ1EsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRTtBQUMzQyxZQUFZLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdEMsU0FBUztBQUFDLGFBQUs7QUFDZixZQUFZLElBQUksQ0FBQyxX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LHdCQUF3QixrQkFDbEMsUUFBUSxFQUFFLGlCQUFpQjtFQUM5Qjs7NExBQ0k7QUFBQztBQUFrRCxZQVovQyxrQkFBa0I7QUFBRztBQUFHO0FBRTVCLHNCQVdBLEtBQUssU0FBQyxzQkFBc0I7QUFDNUIscUJBRUEsTUFBTTtBQUFLLG9CQUVYLE1BQU07QUFBSyxzQkFJWCxZQUFZLFNBQUMsT0FBTztBQUNyQjs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERpcmVjdGl2ZSwgSG9zdExpc3RlbmVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2l0ZUJvZHksIEZhdm9yaXRlQm9keSwgRmF2b3JpdGVFbnRyeSwgU2l0ZSB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYWxmcmVzY28tYXBpLnNlcnZpY2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIExpYnJhcnlFbnRpdHkge1xuICAgIGVudHJ5OiBTaXRlO1xuICAgIGlzTGlicmFyeTogYm9vbGVhbjtcbiAgICBpc0Zhdm9yaXRlOiBib29sZWFuO1xufVxuXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvcjogJ1thZGYtZmF2b3JpdGUtbGlicmFyeV0nLFxuICAgIGV4cG9ydEFzOiAnZmF2b3JpdGVMaWJyYXJ5J1xufSlcbmV4cG9ydCBjbGFzcyBMaWJyYXJ5RmF2b3JpdGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICAgIEBJbnB1dCgnYWRmLWZhdm9yaXRlLWxpYnJhcnknKVxuICAgIGxpYnJhcnk6IExpYnJhcnlFbnRpdHkgPSBudWxsO1xuXG4gICAgQE91dHB1dCgpIHRvZ2dsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tb3V0cHV0LW5hdGl2ZVxuICAgIEBPdXRwdXQoKSBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgcHJpdmF0ZSB0YXJnZXRMaWJyYXJ5ID0gbnVsbDtcblxuICAgIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBjb25zdCBndWlkID0gdGhpcy50YXJnZXRMaWJyYXJ5LmVudHJ5Lmd1aWQ7XG5cbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUZhdm9yaXRlKGd1aWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hZGRGYXZvcml0ZSh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNpdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGd1aWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSkge31cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcbiAgICAgICAgaWYgKCFjaGFuZ2VzLmxpYnJhcnkuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExpYnJhcnkgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50YXJnZXRMaWJyYXJ5ID0gY2hhbmdlcy5saWJyYXJ5LmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgdGhpcy5tYXJrRmF2b3JpdGVMaWJyYXJ5KGNoYW5nZXMubGlicmFyeS5jdXJyZW50VmFsdWUpO1xuICAgIH1cblxuICAgIGlzRmF2b3JpdGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhcmdldExpYnJhcnkgJiYgdGhpcy50YXJnZXRMaWJyYXJ5LmlzRmF2b3JpdGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBtYXJrRmF2b3JpdGVMaWJyYXJ5KGxpYnJhcnk6IExpYnJhcnlFbnRpdHkpIHtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UucGVvcGxlQXBpLmdldEZhdm9yaXRlU2l0ZSgnLW1lLScsIGxpYnJhcnkuZW50cnkuaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExpYnJhcnkgPSBsaWJyYXJ5O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRGYXZvcml0ZShmYXZvcml0ZUJvZHk6IEZhdm9yaXRlQm9keSkge1xuICAgICAgICB0aGlzLmFsZnJlc2NvQXBpU2VydmljZS5wZW9wbGVBcGlcbiAgICAgICAgICAgIC5hZGRGYXZvcml0ZSgnLW1lLScsIGZhdm9yaXRlQm9keSlcbiAgICAgICAgICAgIC50aGVuKChsaWJyYXJ5RW50cnk6IEZhdm9yaXRlRW50cnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldExpYnJhcnkuaXNGYXZvcml0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGUuZW1pdChsaWJyYXJ5RW50cnkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHRoaXMuZXJyb3IuZW1pdChlcnJvcikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVtb3ZlRmF2b3JpdGUoZmF2b3JpdGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLmZhdm9yaXRlc0FwaVxuICAgICAgICAgICAgLnJlbW92ZUZhdm9yaXRlU2l0ZSgnLW1lLScsIGZhdm9yaXRlSWQpXG4gICAgICAgICAgICAudGhlbigobGlicmFyeUJvZHk6IFNpdGVCb2R5KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRMaWJyYXJ5LmlzRmF2b3JpdGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZS5lbWl0KGxpYnJhcnlCb2R5KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB0aGlzLmVycm9yLmVtaXQoZXJyb3IpKTtcbiAgICB9XG59XG4iXX0=