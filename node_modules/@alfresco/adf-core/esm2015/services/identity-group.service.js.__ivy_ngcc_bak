import { Injectable } from '@angular/core';
import { of } from 'rxjs';
import { map, switchMap } from 'rxjs/operators';
import { AppConfigService } from '../app-config/app-config.service';
import { OAuth2Service } from './oauth2.service';
import * as i0 from "@angular/core";
import * as i1 from "./oauth2.service";
import * as i2 from "../app-config/app-config.service";
export class IdentityGroupService {
    constructor(oAuth2Service, appConfigService) {
        this.oAuth2Service = oAuth2Service;
        this.appConfigService = appConfigService;
    }
    get identityHost() {
        return `${this.appConfigService.get('identityHost')}`;
    }
    getGroups() {
        const url = `${this.identityHost}/groups`;
        return this.oAuth2Service.get({ url });
    }
    getAvailableRoles(groupId) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/realm/available`;
        return this.oAuth2Service.get({ url });
    }
    getAssignedRoles(groupId) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/realm`;
        return this.oAuth2Service.get({ url });
    }
    assignRoles(groupId, roles) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/realm`;
        const bodyParam = JSON.stringify(roles);
        return this.oAuth2Service.post({ url, bodyParam });
    }
    removeRoles(groupId, roles) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/realm`;
        const bodyParam = JSON.stringify(roles);
        return this.oAuth2Service.delete({ url, bodyParam });
    }
    getEffectiveRoles(groupId) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/realm/composite`;
        return this.oAuth2Service.get({ url });
    }
    queryGroups(requestQuery) {
        const url = `${this.identityHost}/groups`;
        const queryParams = { first: requestQuery.first || 0, max: requestQuery.max || 5 };
        return this.getTotalGroupsCount().pipe(switchMap((totalCount) => this.oAuth2Service.get({ url, queryParams }).pipe(map((response) => {
            return {
                entries: response,
                pagination: {
                    skipCount: requestQuery.first,
                    maxItems: requestQuery.max,
                    count: totalCount.count,
                    hasMoreItems: false,
                    totalItems: totalCount.count
                }
            };
        }))));
    }
    getTotalGroupsCount() {
        const url = `${this.identityHost}/groups/count`;
        return this.oAuth2Service.get({ url });
    }
    createGroup(newGroup) {
        const url = `${this.identityHost}/groups`;
        const bodyParam = newGroup;
        return this.oAuth2Service.post({ url, bodyParam });
    }
    updateGroup(groupId, updatedGroup) {
        const url = `${this.identityHost}/groups/${groupId}`;
        const bodyParam = JSON.stringify(updatedGroup);
        return this.oAuth2Service.put({ url, bodyParam });
    }
    deleteGroup(groupId) {
        const url = `${this.identityHost}/groups/${groupId}`;
        return this.oAuth2Service.delete({ url });
    }
    findGroupsByName(searchParams) {
        if (searchParams.name === '') {
            return of([]);
        }
        const url = `${this.identityHost}/groups`;
        const queryParams = { search: searchParams.name };
        return this.oAuth2Service.get({ url, queryParams });
    }
    getGroupRoles(groupId) {
        const url = this.buildRolesUrl(groupId);
        return this.oAuth2Service.get({ url });
    }
    checkGroupHasRole(groupId, roleNames) {
        return this.getGroupRoles(groupId).pipe(map((groupRoles) => {
            let hasRole = false;
            if (groupRoles && groupRoles.length > 0) {
                roleNames.forEach((roleName) => {
                    const role = groupRoles.find(({ name }) => roleName === name);
                    if (role) {
                        hasRole = true;
                        return;
                    }
                });
            }
            return hasRole;
        }));
    }
    getClientIdByApplicationName(applicationName) {
        const url = `${this.identityHost}/clients`;
        const queryParams = { clientId: applicationName };
        return this.oAuth2Service.get({ url, queryParams }).pipe(map((response) => response && response.length > 0 ? response[0].id : ''));
    }
    getClientRoles(groupId, clientId) {
        const url = `${this.identityHost}/groups/${groupId}/role-mappings/clients/${clientId}`;
        return this.oAuth2Service.get({ url });
    }
    checkGroupHasClientApp(groupId, clientId) {
        return this.getClientRoles(groupId, clientId).pipe(map((response) => response && response.length > 0));
    }
    checkGroupHasAnyClientAppRole(groupId, clientId, roleNames) {
        return this.getClientRoles(groupId, clientId).pipe(map((clientRoles) => {
            let hasRole = false;
            if (clientRoles.length > 0) {
                roleNames.forEach((roleName) => {
                    const role = clientRoles.find(({ name }) => name === roleName);
                    if (role) {
                        hasRole = true;
                        return;
                    }
                });
            }
            return hasRole;
        }));
    }
    buildRolesUrl(groupId) {
        return `${this.identityHost}/groups/${groupId}/role-mappings/realm/composite`;
    }
}
IdentityGroupService.ɵprov = i0.ɵɵdefineInjectable({ factory: function IdentityGroupService_Factory() { return new IdentityGroupService(i0.ɵɵinject(i1.OAuth2Service), i0.ɵɵinject(i2.AppConfigService)); }, token: IdentityGroupService, providedIn: "root" });
IdentityGroupService.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
IdentityGroupService.ctorParameters = () => [
    { type: OAuth2Service },
    { type: AppConfigService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpdHktZ3JvdXAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvIiwic291cmNlcyI6WyJzZXJ2aWNlcy9pZGVudGl0eS1ncm91cC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQVNwRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7QUFHakQsTUFBTSxPQUFPLG9CQUFvQjtJQUU3QixZQUNZLGFBQTRCLEVBQzVCLGdCQUFrQztRQURsQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0lBQzNDLENBQUM7SUFFSixJQUFZLFlBQVk7UUFDcEIsT0FBTyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztJQUMxRCxDQUFDO0lBTUQsU0FBUztRQUNMLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFlBQVksU0FBUyxDQUFDO1FBQzFDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFPRCxpQkFBaUIsQ0FBQyxPQUFlO1FBQzdCLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFlBQVksV0FBVyxPQUFPLGdDQUFnQyxDQUFDO1FBQ25GLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENB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UUosVUFBVSxTQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRTs7O1lBRnpCLGFBQWE7WUFUYixnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBcHBDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vYXBwLWNvbmZpZy9hcHAtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgICBJZGVudGl0eUdyb3VwU2VhcmNoUGFyYW0sXG4gICAgSWRlbnRpdHlHcm91cFF1ZXJ5Q2xvdWRSZXF1ZXN0TW9kZWwsXG4gICAgSWRlbnRpdHlHcm91cE1vZGVsLFxuICAgIElkZW50aXR5R3JvdXBRdWVyeVJlc3BvbnNlLFxuICAgIElkZW50aXR5R3JvdXBDb3VudE1vZGVsXG59IGZyb20gJy4uL21vZGVscy9pZGVudGl0eS1ncm91cC5tb2RlbCc7XG5pbXBvcnQgeyBJZGVudGl0eVJvbGVNb2RlbCB9IGZyb20gJy4uL21vZGVscy9pZGVudGl0eS1yb2xlLm1vZGVsJztcbmltcG9ydCB7IE9BdXRoMlNlcnZpY2UgfSBmcm9tICcuL29hdXRoMi5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBJZGVudGl0eUdyb3VwU2VydmljZSB7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBvQXV0aDJTZXJ2aWNlOiBPQXV0aDJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFwcENvbmZpZ1NlcnZpY2U6IEFwcENvbmZpZ1NlcnZpY2VcbiAgICApIHt9XG5cbiAgICBwcml2YXRlIGdldCBpZGVudGl0eUhvc3QoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQoJ2lkZW50aXR5SG9zdCcpfWA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgZ3JvdXBzLlxuICAgICAqIEByZXR1cm5zIEFycmF5IG9mIGdyb3VwIGluZm9ybWF0aW9uIG9iamVjdHNcbiAgICAgKi9cbiAgICBnZXRHcm91cHMoKTogT2JzZXJ2YWJsZTxJZGVudGl0eUdyb3VwTW9kZWxbXT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzYDtcbiAgICAgICAgcmV0dXJuIHRoaXMub0F1dGgyU2VydmljZS5nZXQoeyB1cmwgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhdmFpbGFibGUgcm9sZXNcbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBJZCBvZiB0aGUgZ3JvdXAuXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgYXZhaWxhYmxlIHJvbGVzIGluZm9ybWF0aW9uIG9iamVjdHNcbiAgICAgKi9cbiAgICBnZXRBdmFpbGFibGVSb2xlcyhncm91cElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElkZW50aXR5Um9sZU1vZGVsW10+IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5pZGVudGl0eUhvc3R9L2dyb3Vwcy8ke2dyb3VwSWR9L3JvbGUtbWFwcGluZ3MvcmVhbG0vYXZhaWxhYmxlYDtcbiAgICAgICAgcmV0dXJuIHRoaXMub0F1dGgyU2VydmljZS5nZXQoeyB1cmwgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhc3NpZ25lZCByb2xlc1xuICAgICAqIEBwYXJhbSBncm91cElkIElkIG9mIHRoZSBncm91cC5cbiAgICAgKiBAcmV0dXJucyBBcnJheSBvZiBhdmFpbGFibGUgcm9sZXNcbiAgICAgKi9cbiAgICBnZXRBc3NpZ25lZFJvbGVzKGdyb3VwSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SWRlbnRpdHlSb2xlTW9kZWxbXT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzLyR7Z3JvdXBJZH0vcm9sZS1tYXBwaW5ncy9yZWFsbWA7XG4gICAgICAgIHJldHVybiB0aGlzLm9BdXRoMlNlcnZpY2UuZ2V0KHsgdXJsIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFzc2lnbnMgcm9sZXMgdG8gdGhlIGdyb3VwXG4gICAgICogQHBhcmFtIGdyb3VwSWQgVGhlIElEIG9mIHRoZSBncm91cFxuICAgICAqIEBwYXJhbSByb2xlcyBBcnJheSBvZiByb2xlcyB0byBhc3NpZ25cbiAgICAgKi9cbiAgICBhc3NpZ25Sb2xlcyhncm91cElkOiBzdHJpbmcsIHJvbGVzOiBJZGVudGl0eVJvbGVNb2RlbFtdKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5pZGVudGl0eUhvc3R9L2dyb3Vwcy8ke2dyb3VwSWR9L3JvbGUtbWFwcGluZ3MvcmVhbG1gO1xuICAgICAgICBjb25zdCBib2R5UGFyYW0gPSBKU09OLnN0cmluZ2lmeShyb2xlcyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMub0F1dGgyU2VydmljZS5wb3N0KHsgdXJsLCBib2R5UGFyYW0gfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyByb2xlcyBmcm9tIHRoZSBncm91cFxuICAgICAqIEBwYXJhbSBncm91cElkIFRoZSBJRCBvZiB0aGUgZ3JvdXBcbiAgICAgKiBAcGFyYW0gcm9sZXMgQXJyYXkgb2Ygcm9sZXMgdG8gcmVtb3ZlXG4gICAgICovXG4gICAgcmVtb3ZlUm9sZXMoZ3JvdXBJZDogc3RyaW5nLCByb2xlczogSWRlbnRpdHlSb2xlTW9kZWxbXSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuaWRlbnRpdHlIb3N0fS9ncm91cHMvJHtncm91cElkfS9yb2xlLW1hcHBpbmdzL3JlYWxtYDtcbiAgICAgICAgY29uc3QgYm9keVBhcmFtID0gSlNPTi5zdHJpbmdpZnkocm9sZXMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm9BdXRoMlNlcnZpY2UuZGVsZXRlKHsgdXJsLCBib2R5UGFyYW0gfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGVmZmVjdGl2ZSByb2xlc1xuICAgICAqIEBwYXJhbSBncm91cElkIElkIG9mIHRoZSBncm91cFxuICAgICAqIEByZXR1cm5zIEFycmF5IG9mIGVmZmVjdGl2ZSByb2xlc1xuICAgICAqL1xuICAgIGdldEVmZmVjdGl2ZVJvbGVzKGdyb3VwSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SWRlbnRpdHlSb2xlTW9kZWxbXT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzLyR7Z3JvdXBJZH0vcm9sZS1tYXBwaW5ncy9yZWFsbS9jb21wb3NpdGVgO1xuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmdldCh7IHVybCB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBRdWVyaWVzIGdyb3Vwcy5cbiAgICAgKiBAcmV0dXJucyBBcnJheSBvZiB1c2VyIGluZm9ybWF0aW9uIG9iamVjdHNcbiAgICAgKi9cbiAgICBxdWVyeUdyb3VwcyhyZXF1ZXN0UXVlcnk6IElkZW50aXR5R3JvdXBRdWVyeUNsb3VkUmVxdWVzdE1vZGVsKTogT2JzZXJ2YWJsZTxJZGVudGl0eUdyb3VwUXVlcnlSZXNwb25zZT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzYDtcbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7IGZpcnN0OiByZXF1ZXN0UXVlcnkuZmlyc3QgfHwgMCwgbWF4OiByZXF1ZXN0UXVlcnkubWF4IHx8IDUgfTtcblxuICAgICAgICByZXR1cm4gdGhpcy5nZXRUb3RhbEdyb3Vwc0NvdW50KCkucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgodG90YWxDb3VudDogSWRlbnRpdHlHcm91cENvdW50TW9kZWwpID0+XG4gICAgICAgICAgICB0aGlzLm9BdXRoMlNlcnZpY2UuZ2V0PGFueVtdPih7IHVybCwgcXVlcnlQYXJhbXMgfSkucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8SWRlbnRpdHlHcm91cFF1ZXJ5UmVzcG9uc2U+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXM6IHJlc3BvbnNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBDb3VudDogcmVxdWVzdFF1ZXJ5LmZpcnN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEl0ZW1zOiByZXF1ZXN0UXVlcnkubWF4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiB0b3RhbENvdW50LmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vcmVJdGVtczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxJdGVtczogdG90YWxDb3VudC5jb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgZ3JvdXBzIHRvdGFsIGNvdW50LlxuICAgICAqIEByZXR1cm5zIE51bWJlciBvZiBncm91cHMgY291bnQuXG4gICAgICovXG4gICAgZ2V0VG90YWxHcm91cHNDb3VudCgpOiBPYnNlcnZhYmxlPElkZW50aXR5R3JvdXBDb3VudE1vZGVsPiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuaWRlbnRpdHlIb3N0fS9ncm91cHMvY291bnRgO1xuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmdldCh7IHVybCB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIG5ldyBncm91cC5cbiAgICAgKiBAcGFyYW0gbmV3R3JvdXAgT2JqZWN0IG9mIGNvbnRhaW5pbmcgdGhlIG5ldyBncm91cCBkZXRhaWxzLlxuICAgICAqIEByZXR1cm5zIEVtcHR5IHJlc3BvbnNlIHdoZW4gdGhlIGdyb3VwIGNyZWF0ZWQuXG4gICAgICovXG4gICAgY3JlYXRlR3JvdXAobmV3R3JvdXA6IElkZW50aXR5R3JvdXBNb2RlbCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuaWRlbnRpdHlIb3N0fS9ncm91cHNgO1xuICAgICAgICBjb25zdCBib2R5UGFyYW0gPSBuZXdHcm91cDtcblxuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLnBvc3QoeyB1cmwsIGJvZHlQYXJhbSB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIGdyb3VwIGRldGFpbHMuXG4gICAgICogQHBhcmFtIGdyb3VwSWQgSWQgb2YgdGhlIHRhcmdldGVkIGdyb3VwLlxuICAgICAqIEBwYXJhbSB1cGRhdGVkR3JvdXAgT2JqZWN0IG9mIGNvbnRhaW5pbmcgdGhlIGdyb3VwIGRldGFpbHNcbiAgICAgKiBAcmV0dXJucyBFbXB0eSByZXNwb25zZSB3aGVuIHRoZSBncm91cCB1cGRhdGVkLlxuICAgICAqL1xuICAgIHVwZGF0ZUdyb3VwKGdyb3VwSWQ6IHN0cmluZywgdXBkYXRlZEdyb3VwOiBJZGVudGl0eUdyb3VwTW9kZWwpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzLyR7Z3JvdXBJZH1gO1xuICAgICAgICBjb25zdCBib2R5UGFyYW0gPSBKU09OLnN0cmluZ2lmeSh1cGRhdGVkR3JvdXApO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm9BdXRoMlNlcnZpY2UucHV0KHsgdXJsLCBib2R5UGFyYW0gfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBHcm91cC5cbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBJZCBvZiB0aGUgZ3JvdXAuXG4gICAgICogQHJldHVybnMgRW1wdHkgcmVzcG9uc2Ugd2hlbiB0aGUgZ3JvdXAgZGVsZXRlZC5cbiAgICAgKi9cbiAgICBkZWxldGVHcm91cChncm91cElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzLyR7Z3JvdXBJZH1gO1xuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmRlbGV0ZSh7IHVybCB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyBncm91cHMgZmlsdGVyZWQgYnkgbmFtZS5cbiAgICAgKiBAcGFyYW0gc2VhcmNoUGFyYW1zIE9iamVjdCBjb250YWluaW5nIHRoZSBuYW1lIGZpbHRlciBzdHJpbmdcbiAgICAgKiBAcmV0dXJucyBMaXN0IG9mIGdyb3VwIGluZm9ybWF0aW9uXG4gICAgICovXG4gICAgZmluZEdyb3Vwc0J5TmFtZShzZWFyY2hQYXJhbXM6IElkZW50aXR5R3JvdXBTZWFyY2hQYXJhbSk6IE9ic2VydmFibGU8SWRlbnRpdHlHcm91cE1vZGVsW10+IHtcbiAgICAgICAgaWYgKHNlYXJjaFBhcmFtcy5uYW1lID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIG9mKFtdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzYDtcbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7IHNlYXJjaDogc2VhcmNoUGFyYW1zLm5hbWUgfTtcblxuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmdldCh7IHVybCwgcXVlcnlQYXJhbXMgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBkZXRhaWxzIGZvciBhIHNwZWNpZmllZCBncm91cC5cbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBJZCBvZiB0aGUgdGFyZ2V0IGdyb3VwXG4gICAgICogQHJldHVybnMgR3JvdXAgZGV0YWlsc1xuICAgICAqL1xuICAgIGdldEdyb3VwUm9sZXMoZ3JvdXBJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJZGVudGl0eVJvbGVNb2RlbFtdPiB7XG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuYnVpbGRSb2xlc1VybChncm91cElkKTtcbiAgICAgICAgcmV0dXJuIHRoaXMub0F1dGgyU2VydmljZS5nZXQoeyB1cmwgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgdGhhdCBhIGdyb3VwIGhhcyBvbmUgb3IgbW9yZSByb2xlcyBmcm9tIHRoZSBzdXBwbGllZCBsaXN0LlxuICAgICAqIEBwYXJhbSBncm91cElkIElkIG9mIHRoZSB0YXJnZXQgZ3JvdXBcbiAgICAgKiBAcGFyYW0gcm9sZU5hbWVzIEFycmF5IG9mIHJvbGUgbmFtZXNcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBncm91cCBoYXMgb25lIG9yIG1vcmUgb2YgdGhlIHJvbGVzLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBjaGVja0dyb3VwSGFzUm9sZShncm91cElkOiBzdHJpbmcsIHJvbGVOYW1lczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+ICB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEdyb3VwUm9sZXMoZ3JvdXBJZCkucGlwZShtYXAoKGdyb3VwUm9sZXMpID0+IHtcbiAgICAgICAgICAgIGxldCBoYXNSb2xlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoZ3JvdXBSb2xlcyAmJiBncm91cFJvbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByb2xlTmFtZXMuZm9yRWFjaCgocm9sZU5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlID0gZ3JvdXBSb2xlcy5maW5kKCh7IG5hbWUgfSkgPT4gcm9sZU5hbWUgPT09IG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocm9sZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzUm9sZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBoYXNSb2xlO1xuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgY2xpZW50IElkIHVzaW5nIHRoZSBhcHAgbmFtZS5cbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25OYW1lIE5hbWUgb2YgdGhlIGFwcFxuICAgICAqIEByZXR1cm5zIGNsaWVudCBJZCBzdHJpbmdcbiAgICAgKi9cbiAgICBnZXRDbGllbnRJZEJ5QXBwbGljYXRpb25OYW1lKGFwcGxpY2F0aW9uTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5pZGVudGl0eUhvc3R9L2NsaWVudHNgO1xuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHtjbGllbnRJZDogYXBwbGljYXRpb25OYW1lfTtcblxuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmdldDxhbnlbXT4oeyB1cmwsIHF1ZXJ5UGFyYW1zIH0pLnBpcGUoXG4gICAgICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiByZXNwb25zZSAmJiByZXNwb25zZS5sZW5ndGggPiAwID8gcmVzcG9uc2VbMF0uaWQgOiAnJylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGNsaWVudCByb2xlcy5cbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBJZCBvZiB0aGUgdGFyZ2V0IGdyb3VwXG4gICAgICogQHBhcmFtIGNsaWVudElkIElkIG9mIHRoZSBjbGllbnRcbiAgICAgKiBAcmV0dXJucyBMaXN0IG9mIHJvbGVzXG4gICAgICovXG4gICAgZ2V0Q2xpZW50Um9sZXMoZ3JvdXBJZDogc3RyaW5nLCBjbGllbnRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJZGVudGl0eVJvbGVNb2RlbFtdPiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuaWRlbnRpdHlIb3N0fS9ncm91cHMvJHtncm91cElkfS9yb2xlLW1hcHBpbmdzL2NsaWVudHMvJHtjbGllbnRJZH1gO1xuICAgICAgICByZXR1cm4gdGhpcy5vQXV0aDJTZXJ2aWNlLmdldCh7IHVybCB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYSBncm91cCBoYXMgYSBjbGllbnQgYXBwLlxuICAgICAqIEBwYXJhbSBncm91cElkIElkIG9mIHRoZSB0YXJnZXQgZ3JvdXBcbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgSWQgb2YgdGhlIGNsaWVudFxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGdyb3VwIGhhcyB0aGUgY2xpZW50IGFwcCwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgY2hlY2tHcm91cEhhc0NsaWVudEFwcChncm91cElkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2xpZW50Um9sZXMoZ3JvdXBJZCwgY2xpZW50SWQpLnBpcGUoXG4gICAgICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiByZXNwb25zZSAmJiByZXNwb25zZS5sZW5ndGggPiAwKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGEgZ3JvdXAgaGFzIGFueSBvZiB0aGUgY2xpZW50IGFwcCByb2xlcyBpbiB0aGUgc3VwcGxpZWQgbGlzdC5cbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBJZCBvZiB0aGUgdGFyZ2V0IGdyb3VwXG4gICAgICogQHBhcmFtIGNsaWVudElkIElkIG9mIHRoZSBjbGllbnRcbiAgICAgKiBAcGFyYW0gcm9sZU5hbWVzIEFycmF5IG9mIHJvbGUgbmFtZXMgdG8gY2hlY2tcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBncm91cCBoYXMgb25lIG9yIG1vcmUgb2YgdGhlIHJvbGVzLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBjaGVja0dyb3VwSGFzQW55Q2xpZW50QXBwUm9sZShncm91cElkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcsIHJvbGVOYW1lczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2xpZW50Um9sZXMoZ3JvdXBJZCwgY2xpZW50SWQpLnBpcGUoXG4gICAgICAgICAgICBtYXAoKGNsaWVudFJvbGVzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBoYXNSb2xlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKGNsaWVudFJvbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcm9sZU5hbWVzLmZvckVhY2goKHJvbGVOYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlID0gY2xpZW50Um9sZXMuZmluZCgoeyBuYW1lIH0pID0+IG5hbWUgPT09IHJvbGVOYW1lKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNSb2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaGFzUm9sZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBidWlsZFJvbGVzVXJsKGdyb3VwSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkZW50aXR5SG9zdH0vZ3JvdXBzLyR7Z3JvdXBJZH0vcm9sZS1tYXBwaW5ncy9yZWFsbS9jb21wb3NpdGVgO1xuICAgIH1cbn1cbiJdfQ==