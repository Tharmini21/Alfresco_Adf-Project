import { Injectable } from '@angular/core';
import { Subject, from, throwError } from 'rxjs';
import { AlfrescoApiService } from './alfresco-api.service';
import { SearchConfigurationService } from './search-configuration.service';
import * as i0 from "@angular/core";
import * as i1 from "./alfresco-api.service";
import * as i2 from "./search-configuration.service";
export class SearchService {
    constructor(apiService, searchConfigurationService) {
        this.apiService = apiService;
        this.searchConfigurationService = searchConfigurationService;
        this.dataLoaded = new Subject();
    }
    getNodeQueryResults(term, options) {
        const promise = this.apiService.getInstance().core.queriesApi.findNodes(term, options);
        promise.then((nodePaging) => {
            this.dataLoaded.next(nodePaging);
        }).catch((err) => this.handleError(err));
        return from(promise);
    }
    search(searchTerm, maxResults, skipCount) {
        const searchQuery = Object.assign(this.searchConfigurationService.generateQueryBody(searchTerm, maxResults, skipCount));
        const promise = this.apiService.getInstance().search.searchApi.search(searchQuery);
        promise.then((nodePaging) => {
            this.dataLoaded.next(nodePaging);
        }).catch((err) => this.handleError(err));
        return from(promise);
    }
    searchByQueryBody(queryBody) {
        const promise = this.apiService.getInstance().search.searchApi.search(queryBody);
        promise.then((nodePaging) => {
            this.dataLoaded.next(nodePaging);
        }).catch((err) => this.handleError(err));
        return from(promise);
    }
    handleError(error) {
        return throwError(error || 'Server error');
    }
}
SearchService.ɵprov = i0.ɵɵdefineInjectable({ factory: function SearchService_Factory() { return new SearchService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i2.SearchConfigurationService)); }, token: SearchService, providedIn: "root" });
SearchService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
SearchService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: SearchConfigurationService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlLyIsInNvdXJjZXMiOlsic2VydmljZXMvc2VhcmNoLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOzs7O0FBSzVFLE1BQU0sT0FBTyxhQUFhO0lBSXRCLFlBQW9CLFVBQThCLEVBQzlCLDBCQUFzRDtRQUR0RCxlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QiwrQkFBMEIsR0FBMUIsMEJBQTBCLENBQTRCO1FBSDFFLGVBQVUsR0FBNkIsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUd3QixDQUFDO0lBUTlFLG1CQUFtQixDQUFDLElBQVksRUFBRSxPQUF1QjtRQUNyRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV2RixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBc0IsRUFBRSxFQUFFO1lBQ3BDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRXpDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFTRCxNQUFNLENBQUMsVUFBa0IsRUFBRSxVQUFrQixFQUFFLFNBQWlCO1FBQzVELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN4SCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRW5GLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFzQixFQUFFLEVBQUU7WUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFekMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQU9ELGlCQUFpQixDQUFDLFNBQW9CO1FBQ2xDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFakYsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQXNCLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUV6QyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRU8sV0FBVyxDQUFDLEtBQVU7UUFDMUIsT0FBTyxVQUFVLENBQUMsS0FBSyxJQUFJLGNBQWMsQ0FBQyxDQUFDO0lBQy9DLENBQUM7Ozs7WUE3REosVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7WUFMUSxrQkFBa0I7WUFDbEIsMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTm9kZVBhZ2luZywgUXVlcnlCb2R5LCBSZXN1bHRTZXRQYWdpbmcgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIGZyb20sIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSB9IGZyb20gJy4vYWxmcmVzY28tYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2VhcmNoQ29uZmlndXJhdGlvblNlcnZpY2UgfSBmcm9tICcuL3NlYXJjaC1jb25maWd1cmF0aW9uLnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaFNlcnZpY2Uge1xuXG4gICAgZGF0YUxvYWRlZDogU3ViamVjdDxSZXN1bHRTZXRQYWdpbmc+ID0gbmV3IFN1YmplY3QoKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgc2VhcmNoQ29uZmlndXJhdGlvblNlcnZpY2U6IFNlYXJjaENvbmZpZ3VyYXRpb25TZXJ2aWNlKSB7fVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGxpc3Qgb2Ygbm9kZXMgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gc2VhcmNoIGNyaXRlcmlhLlxuICAgICAqIEBwYXJhbSB0ZXJtIFRlcm0gdG8gc2VhcmNoIGZvclxuICAgICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIGRlbGl2ZXJ5IG9mIHRoZSBzZWFyY2ggcmVzdWx0c1xuICAgICAqIEByZXR1cm5zIExpc3Qgb2Ygbm9kZXMgcmVzdWx0aW5nIGZyb20gdGhlIHNlYXJjaFxuICAgICAqL1xuICAgIGdldE5vZGVRdWVyeVJlc3VsdHModGVybTogc3RyaW5nLCBvcHRpb25zPzogU2VhcmNoT3B0aW9ucyk6IE9ic2VydmFibGU8Tm9kZVBhZ2luZz4ge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuY29yZS5xdWVyaWVzQXBpLmZpbmROb2Rlcyh0ZXJtLCBvcHRpb25zKTtcblxuICAgICAgICBwcm9taXNlLnRoZW4oKG5vZGVQYWdpbmc6IE5vZGVQYWdpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YUxvYWRlZC5uZXh0KG5vZGVQYWdpbmcpO1xuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpO1xuXG4gICAgICAgIHJldHVybiBmcm9tKHByb21pc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGEgc2VhcmNoLlxuICAgICAqIEBwYXJhbSBzZWFyY2hUZXJtIFRlcm0gdG8gc2VhcmNoIGZvclxuICAgICAqIEBwYXJhbSBtYXhSZXN1bHRzIE1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIGluIHRoZSBsaXN0IG9mIHJlc3VsdHNcbiAgICAgKiBAcGFyYW0gc2tpcENvdW50IE51bWJlciBvZiBoaWdoZXItcmFua2VkIGl0ZW1zIHRvIHNraXAgb3ZlciBpbiB0aGUgbGlzdFxuICAgICAqIEByZXR1cm5zIExpc3Qgb2Ygc2VhcmNoIHJlc3VsdHNcbiAgICAgKi9cbiAgICBzZWFyY2goc2VhcmNoVGVybTogc3RyaW5nLCBtYXhSZXN1bHRzOiBudW1iZXIsIHNraXBDb3VudDogbnVtYmVyKTogT2JzZXJ2YWJsZTxSZXN1bHRTZXRQYWdpbmc+IHtcbiAgICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSBPYmplY3QuYXNzaWduKHRoaXMuc2VhcmNoQ29uZmlndXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVRdWVyeUJvZHkoc2VhcmNoVGVybSwgbWF4UmVzdWx0cywgc2tpcENvdW50KSk7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5zZWFyY2guc2VhcmNoQXBpLnNlYXJjaChzZWFyY2hRdWVyeSk7XG5cbiAgICAgICAgcHJvbWlzZS50aGVuKChub2RlUGFnaW5nOiBOb2RlUGFnaW5nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRhdGFMb2FkZWQubmV4dChub2RlUGFnaW5nKTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKTtcblxuICAgICAgICByZXR1cm4gZnJvbShwcm9taXNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHNlYXJjaCB3aXRoIGl0cyBwYXJhbWV0ZXJzIHN1cHBsaWVkIGJ5IGEgUXVlcnlCb2R5IG9iamVjdC5cbiAgICAgKiBAcGFyYW0gcXVlcnlCb2R5IE9iamVjdCBjb250YWluaW5nIHRoZSBzZWFyY2ggcGFyYW1ldGVyc1xuICAgICAqIEByZXR1cm5zIExpc3Qgb2Ygc2VhcmNoIHJlc3VsdHNcbiAgICAgKi9cbiAgICBzZWFyY2hCeVF1ZXJ5Qm9keShxdWVyeUJvZHk6IFF1ZXJ5Qm9keSk6IE9ic2VydmFibGU8UmVzdWx0U2V0UGFnaW5nPiB7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5zZWFyY2guc2VhcmNoQXBpLnNlYXJjaChxdWVyeUJvZHkpO1xuXG4gICAgICAgIHByb21pc2UudGhlbigobm9kZVBhZ2luZzogTm9kZVBhZ2luZykgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYXRhTG9hZGVkLm5leHQobm9kZVBhZ2luZyk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSk7XG5cbiAgICAgICAgcmV0dXJuIGZyb20ocHJvbWlzZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvcjogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3IgfHwgJ1NlcnZlciBlcnJvcicpO1xuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hPcHRpb25zIHtcbiAgICAvKiogVGhlIG51bWJlciBvZiBlbnRpdGllcyB0aGF0IGV4aXN0IGluIHRoZSBjb2xsZWN0aW9uIGJlZm9yZSB0aG9zZSBpbmNsdWRlZCBpbiB0aGlzIGxpc3QuICovXG4gICAgc2tpcENvdW50PzogbnVtYmVyO1xuXG4gICAgLyoqIFRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyB0byByZXR1cm4gaW4gdGhlIGxpc3QuICovXG4gICAgbWF4SXRlbXM/OiBudW1iZXI7XG5cbiAgICAvKiogVGhlIGlkIG9mIHRoZSBub2RlIHRvIHN0YXJ0IHRoZSBzZWFyY2ggZnJvbS4gU3VwcG9ydHMgdGhlIGFsaWFzZXMgLW15LSwgLXJvb3QtIGFuZCAtc2hhcmVkLS4gKi9cbiAgICByb290Tm9kZUlkPzogc3RyaW5nO1xuXG4gICAgLyoqIFJlc3RyaWN0IHRoZSByZXR1cm5lZCByZXN1bHRzIHRvIG9ubHkgdGhvc2Ugb2YgdGhlIGdpdmVuIG5vZGUgdHlwZSBhbmQgaXRzIHN1Yi10eXBlcy4gKi9cbiAgICBub2RlVHlwZT86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBub2RlLiBUaGUgYXZhaWxhYmxlIG9wdGlvbmFsIGZpZWxkcyBhcmU6XG4gICAgICogYGFsbG93YWJsZU9wZXJhdGlvbnNgLCBgYXNwZWN0TmFtZXNgLCBgaXNMaW5rYCwgYGlzTG9ja2VkYCwgYHBhdGhgIGFuZCBgcHJvcGVydGllc2AuXG4gICAgICovXG4gICAgaW5jbHVkZT86IHN0cmluZ1tdO1xuXG4gICAgLyoqXG4gICAgICogU3RyaW5nIHRvIGNvbnRyb2wgdGhlIG9yZGVyIG9mIHRoZSBlbnRpdGllcyByZXR1cm5lZCBpbiBhIGxpc3QuIFlvdSBjYW4gdXNlIHRoaXNcbiAgICAgKiBwYXJhbWV0ZXIgdG8gc29ydCB0aGUgbGlzdCBieSBvbmUgb3IgbW9yZSBmaWVsZHMuIEVhY2ggZmllbGQgaGFzIGEgZGVmYXVsdCBzb3J0IG9yZGVyLFxuICAgICAqIHdoaWNoIGlzIG5vcm1hbGx5IGFzY2VuZGluZyBvcmRlciAoYnV0IHNlZSB0aGUgSlMtQVBJIGRvY3MgdG8gY2hlY2sgaWYgYW55IGZpZWxkcyB1c2VkXG4gICAgICogaW4gYSBtZXRob2QgaGF2ZSBhIGRlc2NlbmRpbmcgZGVmYXVsdCBzZWFyY2ggb3JkZXIpLiBUbyBzb3J0IHRoZSBlbnRpdGllcyBpbiBhIHNwZWNpZmljXG4gICAgICogb3JkZXIsIHlvdSBjYW4gdXNlIHRoZSBcIkFTQ1wiIGFuZCBcIkRFU0NcIiBrZXl3b3JkcyBmb3IgYW55IGZpZWxkLlxuICAgICAqL1xuICAgIG9yZGVyQnk/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGZpZWxkIG5hbWVzLiBZb3UgY2FuIHVzZSB0aGlzIHBhcmFtZXRlciB0byByZXN0cmljdCB0aGUgZmllbGRzIHJldHVybmVkIHdpdGhpblxuICAgICAqIGEgcmVzcG9uc2UgaWYsIGZvciBleGFtcGxlLCB5b3Ugd2FudCB0byBzYXZlIG9uIG92ZXJhbGwgYmFuZHdpZHRoLiBUaGUgbGlzdCBhcHBsaWVzIHRvIGFcbiAgICAgKiByZXR1cm5lZCBpbmRpdmlkdWFsIGVudGl0eSBvciBlbnRyaWVzIHdpdGhpbiBhIGNvbGxlY3Rpb24uIElmIHRoZSBBUEkgbWV0aG9kIGFsc28gc3VwcG9ydHNcbiAgICAgKiB0aGUgYGluY2x1ZGVgIHBhcmFtZXRlciwgdGhlbiB0aGUgZmllbGRzIHNwZWNpZmllZCBpbiB0aGUgaW5jbHVkZSBwYXJhbWV0ZXIgYXJlIHJldHVybmVkIGluXG4gICAgICogYWRkaXRpb24gdG8gdGhvc2Ugc3BlY2lmaWVkIGluIHRoZSBmaWVsZHMgcGFyYW1ldGVyLlxuICAgICAqL1xuICAgIGZpZWxkcz86IHN0cmluZ1tdO1xufVxuIl19