import { Injectable } from '@angular/core';
import { Minimatch } from 'minimatch';
import { Subject } from 'rxjs';
import { AppConfigService } from '../app-config/app-config.service';
import { FileUploadCompleteEvent, FileUploadDeleteEvent, FileUploadErrorEvent, FileUploadEvent } from '../events/file.event';
import { FileUploadStatus } from '../models/file.model';
import { AlfrescoApiService } from './alfresco-api.service';
import { DiscoveryApiService } from './discovery-api.service';
import { filter } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./alfresco-api.service";
import * as i2 from "../app-config/app-config.service";
import * as i3 from "./discovery-api.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './alfresco-api.service';
import * as ɵngcc2 from '../app-config/app-config.service';
import * as ɵngcc3 from './discovery-api.service';
const MIN_CANCELLABLE_FILE_SIZE = 1000000;
const MAX_CANCELLABLE_FILE_PERCENTAGE = 50;
export class UploadService {
    constructor(apiService, appConfigService, discoveryApiService) {
        this.apiService = apiService;
        this.appConfigService = appConfigService;
        this.discoveryApiService = discoveryApiService;
        this.cache = {};
        this.totalComplete = 0;
        this.totalAborted = 0;
        this.totalError = 0;
        this.excludedFileList = [];
        this.excludedFoldersList = [];
        this.matchingOptions = null;
        this.folderMatchingOptions = null;
        this.activeTask = null;
        this.queue = [];
        this.queueChanged = new Subject();
        this.fileUpload = new Subject();
        this.fileUploadStarting = new Subject();
        this.fileUploadCancelled = new Subject();
        this.fileUploadProgress = new Subject();
        this.fileUploadAborted = new Subject();
        this.fileUploadError = new Subject();
        this.fileUploadComplete = new Subject();
        this.fileUploadDeleted = new Subject();
        this.fileDeleted = new Subject();
        this.discoveryApiService.ecmProductInfo$.pipe(filter(info => !!info))
            .subscribe(({ status }) => {
            this.isThumbnailGenerationEnabled = status.isThumbnailGenerationEnabled;
        });
    }
    isUploading() {
        const finishedFileStates = [FileUploadStatus.Complete, FileUploadStatus.Cancelled, FileUploadStatus.Aborted, FileUploadStatus.Error, FileUploadStatus.Deleted];
        return this.queue.reduce((stillUploading, currentFile) => {
            return stillUploading || finishedFileStates.indexOf(currentFile.status) === -1;
        }, false);
    }
    getQueue() {
        return this.queue;
    }
    addToQueue(...files) {
        const allowedFiles = files.filter((currentFile) => this.filterElement(currentFile));
        this.queue = this.queue.concat(allowedFiles);
        this.queueChanged.next(this.queue);
        return allowedFiles;
    }
    filterElement(file) {
        this.excludedFileList = this.appConfigService.get('files.excluded');
        this.excludedFoldersList = this.appConfigService.get('folders.excluded');
        let isAllowed = true;
        if (this.excludedFileList) {
            this.matchingOptions = this.appConfigService.get('files.match-options');
            isAllowed = this.isFileNameAllowed(file);
        }
        if (isAllowed && this.excludedFoldersList) {
            this.folderMatchingOptions = this.appConfigService.get('folders.match-options');
            isAllowed = this.isParentFolderAllowed(file);
        }
        return isAllowed;
    }
    isParentFolderAllowed(file) {
        let isAllowed = true;
        const currentFile = file.file;
        const fileRelativePath = currentFile.webkitRelativePath ? currentFile.webkitRelativePath : file.options.path;
        if (currentFile && fileRelativePath) {
            isAllowed =
                this.excludedFoldersList.filter((folderToExclude) => {
                    return fileRelativePath
                        .split('/')
                        .some((pathElement) => {
                        const minimatch = new Minimatch(folderToExclude, this.folderMatchingOptions);
                        return minimatch.match(pathElement);
                    });
                }).length === 0;
        }
        return isAllowed;
    }
    isFileNameAllowed(file) {
        return (this.excludedFileList.filter((pattern) => {
            const minimatch = new Minimatch(pattern, this.matchingOptions);
            return minimatch.match(file.name);
        }).length === 0);
    }
    uploadFilesInTheQueue(successEmitter, errorEmitter) {
        if (!this.activeTask) {
            const file = this.queue.find((currentFile) => currentFile.status === FileUploadStatus.Pending);
            if (file) {
                this.onUploadStarting(file);
                const promise = this.beginUpload(file, successEmitter, errorEmitter);
                this.activeTask = promise;
                this.cache[file.name] = promise;
                const next = () => {
                    this.activeTask = null;
                    setTimeout(() => this.uploadFilesInTheQueue(successEmitter, errorEmitter), 100);
                };
                promise.next = next;
                promise.then(() => next(), () => next());
            }
        }
    }
    cancelUpload(...files) {
        files.forEach((file) => {
            const promise = this.cache[file.name];
            if (promise) {
                if (this.isSaveToAbortFile(file)) {
                    promise.abort();
                }
                this.abortedFile = file.name;
                delete this.cache[file.name];
                promise.next();
            }
            else {
                const performAction = this.getAction(file);
                performAction();
            }
        });
    }
    clearQueue() {
        this.queue = [];
        this.totalComplete = 0;
        this.totalAborted = 0;
        this.totalError = 0;
    }
    getUploadPromise(file) {
        const opts = {
            include: ['allowableOperations']
        };
        if (this.isThumbnailGenerationEnabled) {
            opts.renditions = 'doclib';
        }
        if (file.options.newVersion === true) {
            opts.overwrite = true;
            opts.majorVersion = file.options.majorVersion;
            opts.comment = file.options.comment;
            opts.name = file.name;
        }
        else {
            opts.autoRename = true;
        }
        if (file.options.nodeType) {
            opts.nodeType = file.options.nodeType;
        }
        if (file.id) {
            return this.apiService
                .getInstance()
                .node.updateNodeContent(file.id, file.file, opts);
        }
        else {
            return this.apiService
                .getInstance()
                .upload.uploadFile(file.file, file.options.path, file.options.parentId, file.options, opts);
        }
    }
    beginUpload(file, successEmitter, errorEmitter) {
        const promise = this.getUploadPromise(file);
        promise
            .on('progress', (progress) => {
            this.onUploadProgress(file, progress);
        })
            .on('abort', () => {
            this.onUploadAborted(file);
            if (successEmitter) {
                successEmitter.emit({ value: 'File aborted' });
            }
        })
            .on('error', (err) => {
            this.onUploadError(file, err);
            if (errorEmitter) {
                errorEmitter.emit({ value: 'Error file uploaded' });
            }
        })
            .on('success', (data) => {
            if (this.abortedFile === file.name) {
                this.onUploadAborted(file);
                if (file.id === undefined) {
                    this.deleteAbortedNode(data.entry.id);
                }
                else {
                    this.deleteAbortedNodeVersion(data.entry.id, data.entry.properties['cm:versionLabel']);
                }
                if (successEmitter) {
                    successEmitter.emit({ value: 'File deleted' });
                }
            }
            else {
                this.onUploadComplete(file, data);
                if (successEmitter) {
                    successEmitter.emit({ value: data });
                }
            }
        })
            .catch(() => { });
        return promise;
    }
    onUploadStarting(file) {
        if (file) {
            file.status = FileUploadStatus.Starting;
            const event = new FileUploadEvent(file, FileUploadStatus.Starting);
            this.fileUpload.next(event);
            this.fileUploadStarting.next(event);
        }
    }
    onUploadProgress(file, progress) {
        if (file) {
            file.progress = progress;
            file.status = FileUploadStatus.Progress;
            const event = new FileUploadEvent(file, FileUploadStatus.Progress);
            this.fileUpload.next(event);
            this.fileUploadProgress.next(event);
        }
    }
    onUploadError(file, error) {
        if (file) {
            file.errorCode = (error || {}).status;
            file.status = FileUploadStatus.Error;
            this.totalError++;
            const promise = this.cache[file.name];
            if (promise) {
                delete this.cache[file.name];
            }
            const event = new FileUploadErrorEvent(file, error, this.totalError);
            this.fileUpload.next(event);
            this.fileUploadError.next(event);
        }
    }
    onUploadComplete(file, data) {
        if (file) {
            file.status = FileUploadStatus.Complete;
            file.data = data;
            this.totalComplete++;
            const promise = this.cache[file.name];
            if (promise) {
                delete this.cache[file.name];
            }
            const event = new FileUploadCompleteEvent(file, this.totalComplete, data, this.totalAborted);
            this.fileUpload.next(event);
            this.fileUploadComplete.next(event);
        }
    }
    onUploadAborted(file) {
        if (file) {
            file.status = FileUploadStatus.Aborted;
            this.totalAborted++;
            const event = new FileUploadEvent(file, FileUploadStatus.Aborted);
            this.fileUpload.next(event);
            this.fileUploadAborted.next(event);
        }
    }
    onUploadCancelled(file) {
        if (file) {
            file.status = FileUploadStatus.Cancelled;
            const event = new FileUploadEvent(file, FileUploadStatus.Cancelled);
            this.fileUpload.next(event);
            this.fileUploadCancelled.next(event);
        }
    }
    onUploadDeleted(file) {
        if (file) {
            file.status = FileUploadStatus.Deleted;
            this.totalComplete--;
            const event = new FileUploadDeleteEvent(file, this.totalComplete);
            this.fileUpload.next(event);
            this.fileUploadDeleted.next(event);
        }
    }
    getAction(file) {
        const actions = {
            [FileUploadStatus.Pending]: () => this.onUploadCancelled(file),
            [FileUploadStatus.Deleted]: () => this.onUploadDeleted(file),
            [FileUploadStatus.Error]: () => this.onUploadError(file, null)
        };
        return actions[file.status];
    }
    deleteAbortedNode(nodeId) {
        this.apiService
            .getInstance()
            .core.nodesApi.deleteNode(nodeId, { permanent: true })
            .then(() => (this.abortedFile = undefined));
    }
    deleteAbortedNodeVersion(nodeId, versionId) {
        this.apiService
            .getInstance()
            .core.versionsApi.deleteVersion(nodeId, versionId)
            .then(() => (this.abortedFile = undefined));
    }
    isSaveToAbortFile(file) {
        return (file.size > MIN_CANCELLABLE_FILE_SIZE &&
            file.progress.percent < MAX_CANCELLABLE_FILE_PERCENTAGE);
    }
}
UploadService.ɵfac = function UploadService_Factory(t) { return new (t || UploadService)(ɵngcc0.ɵɵinject(ɵngcc1.AlfrescoApiService), ɵngcc0.ɵɵinject(ɵngcc2.AppConfigService), ɵngcc0.ɵɵinject(ɵngcc3.DiscoveryApiService)); };
UploadService.ɵprov = i0.ɵɵdefineInjectable({ factory: function UploadService_Factory() { return new UploadService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i2.AppConfigService), i0.ɵɵinject(i3.DiscoveryApiService)); }, token: UploadService, providedIn: "root" });
UploadService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: AppConfigService },
    { type: DiscoveryApiService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }, { type: ɵngcc2.AppConfigService }, { type: ɵngcc3.DiscoveryApiService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL3NlcnZpY2VzL3VwbG9hZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWlCQSxPQUFPLEVBQWdCLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDcEUsT0FBTyxFQUNILHVCQUF1QixFQUN2QixxQkFBcUIsRUFDckIsb0JBQW9CLEVBQ3BCLGVBQWUsRUFDbEIsTUFBTSxzQkFBc0IsQ0FBQztBQUM5QixPQUFPLEVBQWlDLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDO0FBQ29DO0FBQ0c7QUFLN0I7Ozs7O0FBTlYsTUFBTSx5QkFBeUIsR0FBRyxPQUFPLENBQUM7QUFDMUMsTUFBTSwrQkFBK0IsR0FBRyxFQUFFLENBQUM7QUFLM0MsTUFBTSxPQUFPLGFBQWE7QUFDMUIsSUF1Q0ksWUFDYyxVQUE4QixFQUNoQyxnQkFBa0MsRUFDbEMsbUJBQXdDO0FBQ3hELFFBSGtCLGVBQVUsR0FBVixVQUFVLENBQW9CO0FBQUMsUUFDakMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtBQUFDLFFBQ25DLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7QUFBQyxRQTFD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O0FBQ2pELFlBQVksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsK0JBQStCLENBQzFELENBQUM7QUFDVixJQUFJLENBQUM7QUFDTDsrTkFBQztBQUNELDhRQXBaSztBQUFDO0VBSEwsVUFBVSxTQUFDLHJCQUlJLFlBWFAsa0JBQWtCO0tBUXZCLFVBQVUsRUFBRSxNQUFNLHZCQVJTLFlBUnRCLGdCQUFnQjtLQWlCeEIsTEFqQjRCLFlBU3BCLG1CQUFtQjtBQUFHOzs7Ozs7NEpBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWluaW1hdGNoIH0gZnJvbSAnbWluaW1hdGNoJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFwcENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi9hcHAtY29uZmlnL2FwcC1jb25maWcuc2VydmljZSc7XG5pbXBvcnQge1xuICAgIEZpbGVVcGxvYWRDb21wbGV0ZUV2ZW50LFxuICAgIEZpbGVVcGxvYWREZWxldGVFdmVudCxcbiAgICBGaWxlVXBsb2FkRXJyb3JFdmVudCxcbiAgICBGaWxlVXBsb2FkRXZlbnRcbn0gZnJvbSAnLi4vZXZlbnRzL2ZpbGUuZXZlbnQnO1xuaW1wb3J0IHsgRmlsZU1vZGVsLCBGaWxlVXBsb2FkUHJvZ3Jlc3MsIEZpbGVVcGxvYWRTdGF0dXMgfSBmcm9tICcuLi9tb2RlbHMvZmlsZS5tb2RlbCc7XG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UgfSBmcm9tICcuL2FsZnJlc2NvLWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7IERpc2NvdmVyeUFwaVNlcnZpY2UgfSBmcm9tICcuL2Rpc2NvdmVyeS1hcGkuc2VydmljZSc7XG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmNvbnN0IE1JTl9DQU5DRUxMQUJMRV9GSUxFX1NJWkUgPSAxMDAwMDAwO1xuY29uc3QgTUFYX0NBTkNFTExBQkxFX0ZJTEVfUEVSQ0VOVEFHRSA9IDUwO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFVwbG9hZFNlcnZpY2Uge1xuICAgIHByaXZhdGUgY2FjaGU6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBwcml2YXRlIHRvdGFsQ29tcGxldGU6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSB0b3RhbEFib3J0ZWQ6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSB0b3RhbEVycm9yOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgZXhjbHVkZWRGaWxlTGlzdDogc3RyaW5nW10gPSBbXTtcbiAgICBwcml2YXRlIGV4Y2x1ZGVkRm9sZGVyc0xpc3Q6IHN0cmluZ1tdID0gW107XG4gICAgcHJpdmF0ZSBtYXRjaGluZ09wdGlvbnM6IGFueSA9IG51bGw7XG4gICAgcHJpdmF0ZSBmb2xkZXJNYXRjaGluZ09wdGlvbnM6IGFueSA9IG51bGw7XG4gICAgcHJpdmF0ZSBhYm9ydGVkRmlsZTogc3RyaW5nO1xuICAgIHByaXZhdGUgaXNUaHVtYm5haWxHZW5lcmF0aW9uRW5hYmxlZDogYm9vbGVhbjtcblxuICAgIGFjdGl2ZVRhc2s6IFByb21pc2U8YW55PiA9IG51bGw7XG4gICAgcXVldWU6IEZpbGVNb2RlbFtdID0gW107XG5cbiAgICBxdWV1ZUNoYW5nZWQ6IFN1YmplY3Q8RmlsZU1vZGVsW10+ID0gbmV3IFN1YmplY3Q8RmlsZU1vZGVsW10+KCk7XG4gICAgZmlsZVVwbG9hZDogU3ViamVjdDxGaWxlVXBsb2FkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8RmlsZVVwbG9hZEV2ZW50PigpO1xuICAgIGZpbGVVcGxvYWRTdGFydGluZzogU3ViamVjdDxGaWxlVXBsb2FkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8XG4gICAgICAgIEZpbGVVcGxvYWRFdmVudFxuICAgID4oKTtcbiAgICBmaWxlVXBsb2FkQ2FuY2VsbGVkOiBTdWJqZWN0PEZpbGVVcGxvYWRFdmVudD4gPSBuZXcgU3ViamVjdDxcbiAgICAgICAgRmlsZVVwbG9hZEV2ZW50XG4gICAgPigpO1xuICAgIGZpbGVVcGxvYWRQcm9ncmVzczogU3ViamVjdDxGaWxlVXBsb2FkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8XG4gICAgICAgIEZpbGVVcGxvYWRFdmVudFxuICAgID4oKTtcbiAgICBmaWxlVXBsb2FkQWJvcnRlZDogU3ViamVjdDxGaWxlVXBsb2FkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8XG4gICAgICAgIEZpbGVVcGxvYWRFdmVudFxuICAgID4oKTtcbiAgICBmaWxlVXBsb2FkRXJyb3I6IFN1YmplY3Q8RmlsZVVwbG9hZEVycm9yRXZlbnQ+ID0gbmV3IFN1YmplY3Q8XG4gICAgICAgIEZpbGVVcGxvYWRFcnJvckV2ZW50XG4gICAgPigpO1xuICAgIGZpbGVVcGxvYWRDb21wbGV0ZTogU3ViamVjdDxGaWxlVXBsb2FkQ29tcGxldGVFdmVudD4gPSBuZXcgU3ViamVjdDxcbiAgICAgICAgRmlsZVVwbG9hZENvbXBsZXRlRXZlbnRcbiAgICA+KCk7XG4gICAgZmlsZVVwbG9hZERlbGV0ZWQ6IFN1YmplY3Q8RmlsZVVwbG9hZERlbGV0ZUV2ZW50PiA9IG5ldyBTdWJqZWN0PFxuICAgICAgICBGaWxlVXBsb2FkRGVsZXRlRXZlbnRcbiAgICA+KCk7XG4gICAgZmlsZURlbGV0ZWQ6IFN1YmplY3Q8c3RyaW5nPiA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcm90ZWN0ZWQgYXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFwcENvbmZpZ1NlcnZpY2U6IEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZGlzY292ZXJ5QXBpU2VydmljZTogRGlzY292ZXJ5QXBpU2VydmljZSkge1xuXG4gICAgICAgIHRoaXMuZGlzY292ZXJ5QXBpU2VydmljZS5lY21Qcm9kdWN0SW5mbyQucGlwZShmaWx0ZXIoaW5mbyA9PiAhIWluZm8pKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoeyBzdGF0dXMgfSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNUaHVtYm5haWxHZW5lcmF0aW9uRW5hYmxlZCA9IHN0YXR1cy5pc1RodW1ibmFpbEdlbmVyYXRpb25FbmFibGVkO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHdoZXRoZXIgdGhlIHNlcnZpY2Ugc3RpbGwgaGFzIGZpbGVzIHVwbG9hZGluZyBvciBhd2FpdGluZyB1cGxvYWQuXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiBmaWxlcyBpbiB0aGUgcXVldWUgYXJlIHN0aWxsIHVwbG9hZGluZywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaXNVcGxvYWRpbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGZpbmlzaGVkRmlsZVN0YXRlcyA9IFtGaWxlVXBsb2FkU3RhdHVzLkNvbXBsZXRlLCBGaWxlVXBsb2FkU3RhdHVzLkNhbmNlbGxlZCwgRmlsZVVwbG9hZFN0YXR1cy5BYm9ydGVkLCBGaWxlVXBsb2FkU3RhdHVzLkVycm9yLCBGaWxlVXBsb2FkU3RhdHVzLkRlbGV0ZWRdO1xuICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZS5yZWR1Y2UoKHN0aWxsVXBsb2FkaW5nOiBib29sZWFuLCBjdXJyZW50RmlsZTogRmlsZU1vZGVsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc3RpbGxVcGxvYWRpbmcgfHwgZmluaXNoZWRGaWxlU3RhdGVzLmluZGV4T2YoY3VycmVudEZpbGUuc3RhdHVzKSA9PT0gLTE7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBmaWxlIFF1ZXVlXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgZmlsZXMgdGhhdCBmb3JtIHRoZSBxdWV1ZVxuICAgICAqL1xuICAgIGdldFF1ZXVlKCk6IEZpbGVNb2RlbFtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVldWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBmaWxlcyB0byB0aGUgdXBsb2FkaW5nIHF1ZXVlIHRvIGJlIHVwbG9hZGVkXG4gICAgICogQHBhcmFtIGZpbGVzIE9uZSBvciBtb3JlIHNlcGFyYXRlIHBhcmFtZXRlcnMgb3IgYW4gYXJyYXkgb2YgZmlsZXMgdG8gcXVldWVcbiAgICAgKiBAcmV0dXJucyBBcnJheSBvZiBmaWxlcyB0aGF0IHdlcmUgbm90IGJsb2NrZWQgZnJvbSB1cGxvYWQgYnkgdGhlIGlnbm9yZSBsaXN0XG4gICAgICovXG4gICAgYWRkVG9RdWV1ZSguLi5maWxlczogRmlsZU1vZGVsW10pOiBGaWxlTW9kZWxbXSB7XG4gICAgICAgIGNvbnN0IGFsbG93ZWRGaWxlcyA9IGZpbGVzLmZpbHRlcigoY3VycmVudEZpbGUpID0+XG4gICAgICAgICAgICB0aGlzLmZpbHRlckVsZW1lbnQoY3VycmVudEZpbGUpXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmNvbmNhdChhbGxvd2VkRmlsZXMpO1xuICAgICAgICB0aGlzLnF1ZXVlQ2hhbmdlZC5uZXh0KHRoaXMucXVldWUpO1xuICAgICAgICByZXR1cm4gYWxsb3dlZEZpbGVzO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyRWxlbWVudChmaWxlOiBGaWxlTW9kZWwpIHtcbiAgICAgICAgdGhpcy5leGNsdWRlZEZpbGVMaXN0ID0gPHN0cmluZ1tdPiB0aGlzLmFwcENvbmZpZ1NlcnZpY2UuZ2V0KCdmaWxlcy5leGNsdWRlZCcpO1xuICAgICAgICB0aGlzLmV4Y2x1ZGVkRm9sZGVyc0xpc3QgPSA8c3RyaW5nW10+IHRoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQoJ2ZvbGRlcnMuZXhjbHVkZWQnKTtcbiAgICAgICAgbGV0IGlzQWxsb3dlZCA9IHRydWU7XG5cbiAgICAgICAgaWYgKHRoaXMuZXhjbHVkZWRGaWxlTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5tYXRjaGluZ09wdGlvbnMgPSB0aGlzLmFwcENvbmZpZ1NlcnZpY2UuZ2V0KCdmaWxlcy5tYXRjaC1vcHRpb25zJyk7XG4gICAgICAgICAgICBpc0FsbG93ZWQgPSB0aGlzLmlzRmlsZU5hbWVBbGxvd2VkKGZpbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzQWxsb3dlZCAmJiB0aGlzLmV4Y2x1ZGVkRm9sZGVyc0xpc3QpIHtcbiAgICAgICAgICAgIHRoaXMuZm9sZGVyTWF0Y2hpbmdPcHRpb25zID0gdGhpcy5hcHBDb25maWdTZXJ2aWNlLmdldCgnZm9sZGVycy5tYXRjaC1vcHRpb25zJyk7XG4gICAgICAgICAgICBpc0FsbG93ZWQgPSB0aGlzLmlzUGFyZW50Rm9sZGVyQWxsb3dlZChmaWxlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNBbGxvd2VkO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNQYXJlbnRGb2xkZXJBbGxvd2VkKGZpbGU6IEZpbGVNb2RlbCk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgaXNBbGxvd2VkOiBib29sZWFuID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgY3VycmVudEZpbGU6IGFueSA9IGZpbGUuZmlsZTtcbiAgICAgICAgY29uc3QgZmlsZVJlbGF0aXZlUGF0aCA9IGN1cnJlbnRGaWxlLndlYmtpdFJlbGF0aXZlUGF0aCA/IGN1cnJlbnRGaWxlLndlYmtpdFJlbGF0aXZlUGF0aCA6IGZpbGUub3B0aW9ucy5wYXRoO1xuICAgICAgICBpZiAoY3VycmVudEZpbGUgJiYgZmlsZVJlbGF0aXZlUGF0aCkge1xuICAgICAgICAgICAgaXNBbGxvd2VkID1cbiAgICAgICAgICAgICAgICB0aGlzLmV4Y2x1ZGVkRm9sZGVyc0xpc3QuZmlsdGVyKChmb2xkZXJUb0V4Y2x1ZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVSZWxhdGl2ZVBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCgnLycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc29tZSgocGF0aEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW5pbWF0Y2ggPSBuZXcgTWluaW1hdGNoKGZvbGRlclRvRXhjbHVkZSwgdGhpcy5mb2xkZXJNYXRjaGluZ09wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtaW5pbWF0Y2gubWF0Y2gocGF0aEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoID09PSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc0FsbG93ZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZpbGVOYW1lQWxsb3dlZChmaWxlOiBGaWxlTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHRoaXMuZXhjbHVkZWRGaWxlTGlzdC5maWx0ZXIoKHBhdHRlcm4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW5pbWF0Y2ggPSBuZXcgTWluaW1hdGNoKHBhdHRlcm4sIHRoaXMubWF0Y2hpbmdPcHRpb25zKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWluaW1hdGNoLm1hdGNoKGZpbGUubmFtZSk7XG4gICAgICAgICAgICB9KS5sZW5ndGggPT09IDBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyBhbGwgdGhlIGZpbGVzIGluIHRoZSBxdWV1ZSB0aGF0IGFyZSBub3QgeWV0IHVwbG9hZGVkIGFuZCB1cGxvYWRzIHRoZW0gaW50byB0aGUgZGlyZWN0b3J5IGZvbGRlci5cbiAgICAgKiBAcGFyYW0gc3VjY2Vzc0VtaXR0ZXIgRW1pdHRlciB0byBpbnZva2Ugb24gZmlsZSBzdWNjZXNzIHN0YXR1cyBjaGFuZ2VcbiAgICAgKiBAcGFyYW0gZXJyb3JFbWl0dGVyIEVtaXR0ZXIgdG8gaW52b2tlIG9uIGZpbGUgZXJyb3Igc3RhdHVzIGNoYW5nZVxuICAgICAqL1xuICAgIHVwbG9hZEZpbGVzSW5UaGVRdWV1ZShzdWNjZXNzRW1pdHRlcj86IEV2ZW50RW1pdHRlcjxhbnk+LCBlcnJvckVtaXR0ZXI/OiBFdmVudEVtaXR0ZXI8YW55Pik6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlVGFzaykge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMucXVldWUuZmluZChcbiAgICAgICAgICAgICAgICAoY3VycmVudEZpbGUpID0+IGN1cnJlbnRGaWxlLnN0YXR1cyA9PT0gRmlsZVVwbG9hZFN0YXR1cy5QZW5kaW5nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uVXBsb2FkU3RhcnRpbmcoZmlsZSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5iZWdpblVwbG9hZChmaWxlLCBzdWNjZXNzRW1pdHRlciwgZXJyb3JFbWl0dGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2sgPSBwcm9taXNlO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVbZmlsZS5uYW1lXSA9IHByb21pc2U7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2sgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBsb2FkRmlsZXNJblRoZVF1ZXVlKHN1Y2Nlc3NFbWl0dGVyLCBlcnJvckVtaXR0ZXIpLCAxMDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBwcm9taXNlLm5leHQgPSBuZXh0O1xuXG4gICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKFxuICAgICAgICAgICAgICAgICAgICAoKSA9PiBuZXh0KCksXG4gICAgICAgICAgICAgICAgICAgICgpID0+IG5leHQoKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYW5jZWxzIHVwbG9hZGluZyBvZiBmaWxlcy5cbiAgICAgKiBJZiB0aGUgZmlsZSBpcyBzbWFsbGVyIHRoYW4gMSBNQiB0aGUgZmlsZSB3aWxsIGJlIHVwbG9hZGVkIGFuZCB0aGVuIHRoZSBub2RlIGRlbGV0ZWRcbiAgICAgKiB0byBwcmV2ZW50IGhhdmluZyBmaWxlcyB0aGF0IHdlcmUgYWJvcnRlZCBidXQgc3RpbGwgdXBsb2FkZWQuXG4gICAgICogQHBhcmFtIGZpbGVzIE9uZSBvciBtb3JlIHNlcGFyYXRlIHBhcmFtZXRlcnMgb3IgYW4gYXJyYXkgb2YgZmlsZXMgc3BlY2lmeWluZyB1cGxvYWRzIHRvIGNhbmNlbFxuICAgICAqL1xuICAgIGNhbmNlbFVwbG9hZCguLi5maWxlczogRmlsZU1vZGVsW10pIHtcbiAgICAgICAgZmlsZXMuZm9yRWFjaCgoZmlsZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRoaXMuY2FjaGVbZmlsZS5uYW1lXTtcbiAgICAgICAgICAgIGlmIChwcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNTYXZlVG9BYm9ydEZpbGUoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5hYm9ydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmFib3J0ZWRGaWxlID0gZmlsZS5uYW1lO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2ZpbGUubmFtZV07XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5uZXh0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBlcmZvcm1BY3Rpb24gPSB0aGlzLmdldEFjdGlvbihmaWxlKTtcbiAgICAgICAgICAgICAgICBwZXJmb3JtQWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKiBDbGVhcnMgdGhlIHVwbG9hZCBxdWV1ZSAqL1xuICAgIGNsZWFyUXVldWUoKSB7XG4gICAgICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICAgICAgdGhpcy50b3RhbENvbXBsZXRlID0gMDtcbiAgICAgICAgdGhpcy50b3RhbEFib3J0ZWQgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsRXJyb3IgPSAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYW4gdXBsb2FkIHByb21pc2UgZm9yIGEgZmlsZS5cbiAgICAgKiBAcGFyYW0gZmlsZSBUaGUgdGFyZ2V0IGZpbGVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgaWYgdGhlIHVwbG9hZCBpcyBzdWNjZXNzZnVsIG9yIGVycm9yIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGdldFVwbG9hZFByb21pc2UoZmlsZTogRmlsZU1vZGVsKTogYW55IHtcbiAgICAgICAgY29uc3Qgb3B0czogYW55ID0ge1xuICAgICAgICAgICAgaW5jbHVkZTogWydhbGxvd2FibGVPcGVyYXRpb25zJ11cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5pc1RodW1ibmFpbEdlbmVyYXRpb25FbmFibGVkKSB7XG4gICAgICAgICAgICBvcHRzLnJlbmRpdGlvbnMgPSAnZG9jbGliJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmaWxlLm9wdGlvbnMubmV3VmVyc2lvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgb3B0cy5vdmVyd3JpdGUgPSB0cnVlO1xuICAgICAgICAgICAgb3B0cy5tYWpvclZlcnNpb24gPSBmaWxlLm9wdGlvbnMubWFqb3JWZXJzaW9uO1xuICAgICAgICAgICAgb3B0cy5jb21tZW50ID0gZmlsZS5vcHRpb25zLmNvbW1lbnQ7XG4gICAgICAgICAgICBvcHRzLm5hbWUgPSBmaWxlLm5hbWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvcHRzLmF1dG9SZW5hbWUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZpbGUub3B0aW9ucy5ub2RlVHlwZSkge1xuICAgICAgICAgICAgb3B0cy5ub2RlVHlwZSA9IGZpbGUub3B0aW9ucy5ub2RlVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmaWxlLmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hcGlTZXJ2aWNlXG4gICAgICAgICAgICAgICAgLmdldEluc3RhbmNlKClcbiAgICAgICAgICAgICAgICAubm9kZS51cGRhdGVOb2RlQ29udGVudChmaWxlLmlkLCBmaWxlLmZpbGUsIG9wdHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBpU2VydmljZVxuICAgICAgICAgICAgICAgIC5nZXRJbnN0YW5jZSgpXG4gICAgICAgICAgICAgICAgLnVwbG9hZC51cGxvYWRGaWxlKFxuICAgICAgICAgICAgICAgICAgICBmaWxlLmZpbGUsXG4gICAgICAgICAgICAgICAgICAgIGZpbGUub3B0aW9ucy5wYXRoLFxuICAgICAgICAgICAgICAgICAgICBmaWxlLm9wdGlvbnMucGFyZW50SWQsXG4gICAgICAgICAgICAgICAgICAgIGZpbGUub3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgb3B0c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGJlZ2luVXBsb2FkKGZpbGU6IEZpbGVNb2RlbCwgc3VjY2Vzc0VtaXR0ZXI/OiBFdmVudEVtaXR0ZXI8YW55PiwgZXJyb3JFbWl0dGVyPzogRXZlbnRFbWl0dGVyPGFueT4pOiBhbnkge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5nZXRVcGxvYWRQcm9taXNlKGZpbGUpO1xuICAgICAgICBwcm9taXNlXG4gICAgICAgICAgICAub24oJ3Byb2dyZXNzJywgKHByb2dyZXNzOiBGaWxlVXBsb2FkUHJvZ3Jlc3MpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uVXBsb2FkUHJvZ3Jlc3MoZmlsZSwgcHJvZ3Jlc3MpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignYWJvcnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblVwbG9hZEFib3J0ZWQoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3NFbWl0dGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NFbWl0dGVyLmVtaXQoeyB2YWx1ZTogJ0ZpbGUgYWJvcnRlZCcgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblVwbG9hZEVycm9yKGZpbGUsIGVycik7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yRW1pdHRlcikge1xuICAgICAgICAgICAgICAgICAgICBlcnJvckVtaXR0ZXIuZW1pdCh7IHZhbHVlOiAnRXJyb3IgZmlsZSB1cGxvYWRlZCcgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignc3VjY2VzcycsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWJvcnRlZEZpbGUgPT09IGZpbGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uVXBsb2FkQWJvcnRlZChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuaWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxldGVBYm9ydGVkTm9kZShkYXRhLmVudHJ5LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlQWJvcnRlZE5vZGVWZXJzaW9uKGRhdGEuZW50cnkuaWQsIGRhdGEuZW50cnkucHJvcGVydGllc1snY206dmVyc2lvbkxhYmVsJ10pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzRW1pdHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0VtaXR0ZXIuZW1pdCh7IHZhbHVlOiAnRmlsZSBkZWxldGVkJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25VcGxvYWRDb21wbGV0ZShmaWxlLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3NFbWl0dGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzRW1pdHRlci5lbWl0KHsgdmFsdWU6IGRhdGEgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKCgpID0+IHt9KTtcblxuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uVXBsb2FkU3RhcnRpbmcoZmlsZTogRmlsZU1vZGVsKTogdm9pZCB7XG4gICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBmaWxlLnN0YXR1cyA9IEZpbGVVcGxvYWRTdGF0dXMuU3RhcnRpbmc7XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBGaWxlVXBsb2FkRXZlbnQoZmlsZSwgRmlsZVVwbG9hZFN0YXR1cy5TdGFydGluZyk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWQubmV4dChldmVudCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWRTdGFydGluZy5uZXh0KGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb25VcGxvYWRQcm9ncmVzcyhcbiAgICAgICAgZmlsZTogRmlsZU1vZGVsLFxuICAgICAgICBwcm9ncmVzczogRmlsZVVwbG9hZFByb2dyZXNzXG4gICAgKTogdm9pZCB7XG4gICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gICAgICAgICAgICBmaWxlLnN0YXR1cyA9IEZpbGVVcGxvYWRTdGF0dXMuUHJvZ3Jlc3M7XG5cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEZpbGVVcGxvYWRFdmVudChmaWxlLCBGaWxlVXBsb2FkU3RhdHVzLlByb2dyZXNzKTtcbiAgICAgICAgICAgIHRoaXMuZmlsZVVwbG9hZC5uZXh0KGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZmlsZVVwbG9hZFByb2dyZXNzLm5leHQoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblVwbG9hZEVycm9yKGZpbGU6IEZpbGVNb2RlbCwgZXJyb3I6IGFueSk6IHZvaWQge1xuICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgZmlsZS5lcnJvckNvZGUgPSAoZXJyb3IgfHwge30pLnN0YXR1cztcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gRmlsZVVwbG9hZFN0YXR1cy5FcnJvcjtcbiAgICAgICAgICAgIHRoaXMudG90YWxFcnJvcisrO1xuXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5jYWNoZVtmaWxlLm5hbWVdO1xuICAgICAgICAgICAgaWYgKHByb21pc2UpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jYWNoZVtmaWxlLm5hbWVdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBGaWxlVXBsb2FkRXJyb3JFdmVudChcbiAgICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgICAgIHRoaXMudG90YWxFcnJvclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZmlsZVVwbG9hZC5uZXh0KGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZmlsZVVwbG9hZEVycm9yLm5leHQoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblVwbG9hZENvbXBsZXRlKGZpbGU6IEZpbGVNb2RlbCwgZGF0YTogYW55KTogdm9pZCB7XG4gICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBmaWxlLnN0YXR1cyA9IEZpbGVVcGxvYWRTdGF0dXMuQ29tcGxldGU7XG4gICAgICAgICAgICBmaWxlLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgdGhpcy50b3RhbENvbXBsZXRlKys7XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5jYWNoZVtmaWxlLm5hbWVdO1xuICAgICAgICAgICAgaWYgKHByb21pc2UpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jYWNoZVtmaWxlLm5hbWVdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBGaWxlVXBsb2FkQ29tcGxldGVFdmVudChcbiAgICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICAgIHRoaXMudG90YWxDb21wbGV0ZSxcbiAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgIHRoaXMudG90YWxBYm9ydGVkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5maWxlVXBsb2FkLm5leHQoZXZlbnQpO1xuICAgICAgICAgICAgdGhpcy5maWxlVXBsb2FkQ29tcGxldGUubmV4dChldmVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uVXBsb2FkQWJvcnRlZChmaWxlOiBGaWxlTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gRmlsZVVwbG9hZFN0YXR1cy5BYm9ydGVkO1xuICAgICAgICAgICAgdGhpcy50b3RhbEFib3J0ZWQrKztcblxuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgRmlsZVVwbG9hZEV2ZW50KGZpbGUsIEZpbGVVcGxvYWRTdGF0dXMuQWJvcnRlZCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWQubmV4dChldmVudCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWRBYm9ydGVkLm5leHQoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblVwbG9hZENhbmNlbGxlZChmaWxlOiBGaWxlTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gRmlsZVVwbG9hZFN0YXR1cy5DYW5jZWxsZWQ7XG5cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEZpbGVVcGxvYWRFdmVudChmaWxlLCBGaWxlVXBsb2FkU3RhdHVzLkNhbmNlbGxlZCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWQubmV4dChldmVudCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVVcGxvYWRDYW5jZWxsZWQubmV4dChldmVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uVXBsb2FkRGVsZXRlZChmaWxlOiBGaWxlTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gRmlsZVVwbG9hZFN0YXR1cy5EZWxldGVkO1xuICAgICAgICAgICAgdGhpcy50b3RhbENvbXBsZXRlLS07XG5cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEZpbGVVcGxvYWREZWxldGVFdmVudChmaWxlLCB0aGlzLnRvdGFsQ29tcGxldGUpO1xuICAgICAgICAgICAgdGhpcy5maWxlVXBsb2FkLm5leHQoZXZlbnQpO1xuICAgICAgICAgICAgdGhpcy5maWxlVXBsb2FkRGVsZXRlZC5uZXh0KGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QWN0aW9uKGZpbGU6IEZpbGVNb2RlbCkge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0ge1xuICAgICAgICAgICAgW0ZpbGVVcGxvYWRTdGF0dXMuUGVuZGluZ106ICgpID0+IHRoaXMub25VcGxvYWRDYW5jZWxsZWQoZmlsZSksXG4gICAgICAgICAgICBbRmlsZVVwbG9hZFN0YXR1cy5EZWxldGVkXTogKCkgPT4gdGhpcy5vblVwbG9hZERlbGV0ZWQoZmlsZSksXG4gICAgICAgICAgICBbRmlsZVVwbG9hZFN0YXR1cy5FcnJvcl06ICgpID0+IHRoaXMub25VcGxvYWRFcnJvcihmaWxlLCBudWxsKVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBhY3Rpb25zW2ZpbGUuc3RhdHVzXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlbGV0ZUFib3J0ZWROb2RlKG5vZGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYXBpU2VydmljZVxuICAgICAgICAgICAgLmdldEluc3RhbmNlKClcbiAgICAgICAgICAgIC5jb3JlLm5vZGVzQXBpLmRlbGV0ZU5vZGUobm9kZUlkLCB7IHBlcm1hbmVudDogdHJ1ZSB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gKHRoaXMuYWJvcnRlZEZpbGUgPSB1bmRlZmluZWQpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlbGV0ZUFib3J0ZWROb2RlVmVyc2lvbihub2RlSWQ6IHN0cmluZywgdmVyc2lvbklkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hcGlTZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0SW5zdGFuY2UoKVxuICAgICAgICAgICAgLmNvcmUudmVyc2lvbnNBcGkuZGVsZXRlVmVyc2lvbihub2RlSWQsIHZlcnNpb25JZClcbiAgICAgICAgICAgIC50aGVuKCgpID0+ICh0aGlzLmFib3J0ZWRGaWxlID0gdW5kZWZpbmVkKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1NhdmVUb0Fib3J0RmlsZShmaWxlOiBGaWxlTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGZpbGUuc2l6ZSA+IE1JTl9DQU5DRUxMQUJMRV9GSUxFX1NJWkUgJiZcbiAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MucGVyY2VudCA8IE1BWF9DQU5DRUxMQUJMRV9GSUxFX1BFUkNFTlRBR0VcbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=