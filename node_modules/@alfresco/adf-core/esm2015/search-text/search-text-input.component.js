/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ViewEncapsulation, Component, Input, ViewChild, ElementRef, Output, EventEmitter } from '@angular/core';
import { Subject, Observable } from 'rxjs';
import { debounceTime, takeUntil, filter } from 'rxjs/operators';
import { searchAnimation } from './animations';
import { UserPreferencesService } from '../services/user-preferences.service';
import { SearchTextStateEnum } from '../models/search-text-input.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/user-preferences.service';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@angular/material/form-field';
import * as ɵngcc4 from '@angular/material/input';
import * as ɵngcc5 from '@angular/forms';
import * as ɵngcc6 from './search-trigger.directive';
import * as ɵngcc7 from '@angular/material/button';
import * as ɵngcc8 from '@angular/material/icon';
import * as ɵngcc9 from '@ngx-translate/core';

const _c0 = ["searchInput"];
function SearchTextInputComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 5);
    ɵngcc0.ɵɵlistener("click", function SearchTextInputComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(); return ctx_r2.toggleSearchBar(); })("keyup.enter", function SearchTextInputComponent_button_2_Template_button_keyup_enter_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.toggleSearchBar(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelementStart(2, "mat-icon");
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵtext(4, "search");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(1, 2, "SEARCH.BUTTON.TOOLTIP"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(3, 4, "SEARCH.BUTTON.ARIA-LABEL"));
} }
export class SearchTextInputComponent {
    constructor(userPreferencesService) {
        this.userPreferencesService = userPreferencesService;
        this.autocomplete = false;
        this.expandable = true;
        this.inputType = 'text';
        this.liveSearchEnabled = true;
        this.searchAutocomplete = false;
        this.searchTerm = '';
        this.debounceTime = 0;
        this.collapseOnSubmit = true;
        this.defaultState = SearchTextStateEnum.collapsed;
        this.searchChange = new EventEmitter();
        this.submit = new EventEmitter();
        this.selectResult = new EventEmitter();
        this.reset = new EventEmitter();
        this.animationStates = {
            ltr: {
                active: { value: 'active', params: { 'margin-left': 13 } },
                inactive: { value: 'inactive', params: { 'transform': 'translateX(82%)' } }
            },
            rtl: {
                active: { value: 'active', params: { 'margin-right': 13 } },
                inactive: { value: 'inactive', params: { 'transform': 'translateX(-82%)' } }
            }
        };
        this.dir = 'ltr';
        this.onDestroy$ = new Subject();
        this.toggleSearch = new Subject();
        this.valueChange = new Subject();
        this.toggleSearch
            .pipe(debounceTime(200), takeUntil(this.onDestroy$))
            .subscribe(() => {
            if (this.expandable) {
                this.subscriptAnimationState = this.toggleAnimation();
                if (this.subscriptAnimationState.value === 'inactive') {
                    this.searchTerm = '';
                    this.reset.emit(true);
                    if (document.activeElement.id === this.searchInput.nativeElement.id) {
                        this.searchInput.nativeElement.blur();
                    }
                }
            }
        });
    }
    ngOnInit() {
        this.userPreferencesService
            .select('textOrientation')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((direction) => {
            this.dir = direction;
            this.subscriptAnimationState = this.getDefaultState(this.dir);
        });
        this.subscriptAnimationState = this.getDefaultState(this.dir);
        this.setValueChangeHandler();
        this.setupFocusEventHandlers();
    }
    applySearchFocus(animationDoneEvent) {
        if (animationDoneEvent.toState === 'active' && this.defaultState !== SearchTextStateEnum.expanded) {
            this.searchInput.nativeElement.focus();
        }
    }
    getAutoComplete() {
        return this.autocomplete ? 'on' : 'off';
    }
    toggleAnimation() {
        if (this.dir === 'ltr') {
            return this.subscriptAnimationState.value === 'inactive' ?
                { value: 'active', params: { 'margin-left': 13 } } :
                { value: 'inactive', params: { 'transform': 'translateX(82%)' } };
        }
        else {
            return this.subscriptAnimationState.value === 'inactive' ?
                { value: 'active', params: { 'margin-right': 13 } } :
                { value: 'inactive', params: { 'transform': 'translateX(-82%)' } };
        }
    }
    getDefaultState(dir) {
        if (this.dir) {
            return this.getAnimationState(dir);
        }
        return this.animationStates.ltr.inactive;
    }
    getAnimationState(dir) {
        if (this.expandable && this.defaultState === SearchTextStateEnum.expanded) {
            return this.animationStates[dir].active;
        }
        else if (this.expandable) {
            return this.animationStates[dir].inactive;
        }
        else {
            return { value: 'no-animation' };
        }
    }
    setupFocusEventHandlers() {
        if (this.focusListener) {
            const focusEvents = this.focusListener
                .pipe(debounceTime(50), filter(($event) => {
                return this.isSearchBarActive() && ($event.type === 'blur' || $event.type === 'focusout' || $event.type === 'focus');
            }), takeUntil(this.onDestroy$));
            this.focusSubscription = focusEvents.subscribe((event) => {
                if (event.type === 'focus') {
                    this.searchInput.nativeElement.focus();
                }
                else {
                    this.toggleSearchBar();
                }
            });
        }
    }
    setValueChangeHandler() {
        this.valueChange.pipe(debounceTime(this.debounceTime), takeUntil(this.onDestroy$)).subscribe((value) => {
            this.searchChange.emit(value);
        });
    }
    selectFirstResult($event) {
        this.selectResult.emit($event);
    }
    onBlur($event) {
        if (!$event.relatedTarget && this.defaultState === SearchTextStateEnum.collapsed) {
            this.searchTerm = '';
            this.subscriptAnimationState = this.animationStates[this.dir].inactive;
        }
    }
    inputChange($event) {
        this.valueChange.next($event);
    }
    toggleSearchBar() {
        if (this.toggleSearch) {
            this.toggleSearch.next();
        }
    }
    searchSubmit(event) {
        this.submit.emit(event);
        if (this.collapseOnSubmit) {
            this.toggleSearchBar();
        }
    }
    activateToolbar() {
        if (!this.isSearchBarActive()) {
            this.toggleSearchBar();
        }
        return false;
    }
    isSearchBarActive() {
        return this.subscriptAnimationState.value === 'active' && this.liveSearchEnabled;
    }
    ngOnDestroy() {
        if (this.toggleSearch) {
            this.toggleSearch.complete();
            this.toggleSearch = null;
        }
        if (this.focusSubscription) {
            this.focusSubscription.unsubscribe();
            this.focusSubscription = null;
            this.focusListener = null;
        }
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
SearchTextInputComponent.ɵfac = function SearchTextInputComponent_Factory(t) { return new (t || SearchTextInputComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.UserPreferencesService)); };
SearchTextInputComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: SearchTextInputComponent, selectors: [["adf-search-text-input"]], viewQuery: function SearchTextInputComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.searchInput = _t.first);
    } }, hostAttrs: [1, "adf-search-text-input"], inputs: { autocomplete: "autocomplete", expandable: "expandable", inputType: "inputType", liveSearchEnabled: "liveSearchEnabled", searchAutocomplete: "searchAutocomplete", searchTerm: "searchTerm", debounceTime: "debounceTime", collapseOnSubmit: "collapseOnSubmit", defaultState: "defaultState", focusListener: "focusListener" }, outputs: { searchChange: "searchChange", submit: "submit", selectResult: "selectResult", reset: "reset" }, decls: 7, vars: 10, consts: [[1, "adf-search-container"], ["mat-icon-button", "", "id", "adf-search-button", "class", "adf-search-button", 3, "title", "click", "keyup.enter", 4, "ngIf"], [1, "adf-input-form-field-divider"], ["matInput", "", "id", "adf-control-input", 3, "autocomplete", "ngModel", "searchAutocomplete", "ngModelChange", "focus", "blur", "keyup.escape", "keyup.arrowdown", "keyup.enter"], ["searchInput", ""], ["mat-icon-button", "", "id", "adf-search-button", 1, "adf-search-button", 3, "title", "click", "keyup.enter"]], template: function SearchTextInputComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div");
        ɵngcc0.ɵɵlistener("@transitionMessages.done", function SearchTextInputComponent_Template_div_animation_transitionMessages_done_1_listener($event) { return ctx.applySearchFocus($event); });
        ɵngcc0.ɵɵtemplate(2, SearchTextInputComponent_button_2_Template, 5, 6, "button", 1);
        ɵngcc0.ɵɵelementStart(3, "mat-form-field", 2);
        ɵngcc0.ɵɵelementStart(4, "input", 3, 4);
        ɵngcc0.ɵɵlistener("ngModelChange", function SearchTextInputComponent_Template_input_ngModelChange_4_listener($event) { return ctx.searchTerm = $event; })("focus", function SearchTextInputComponent_Template_input_focus_4_listener() { return ctx.activateToolbar(); })("blur", function SearchTextInputComponent_Template_input_blur_4_listener($event) { return ctx.onBlur($event); })("keyup.escape", function SearchTextInputComponent_Template_input_keyup_escape_4_listener() { return ctx.toggleSearchBar(); })("keyup.arrowdown", function SearchTextInputComponent_Template_input_keyup_arrowdown_4_listener($event) { return ctx.selectFirstResult($event); })("ngModelChange", function SearchTextInputComponent_Template_input_ngModelChange_4_listener($event) { return ctx.inputChange($event); })("keyup.enter", function SearchTextInputComponent_Template_input_keyup_enter_4_listener($event) { return ctx.searchSubmit($event); });
        ɵngcc0.ɵɵpipe(6, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("state", ctx.subscriptAnimationState.value);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("@transitionMessages", ctx.subscriptAnimationState);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expandable);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("autocomplete", ctx.getAutoComplete())("ngModel", ctx.searchTerm)("searchAutocomplete", ctx.searchAutocomplete ? ctx.searchAutocomplete : null);
        ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(6, 8, "SEARCH.INPUT.ARIA-LABEL"))("type", ctx.inputType);
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.MatFormField, ɵngcc4.MatInput, ɵngcc5.DefaultValueAccessor, ɵngcc6.SearchTriggerDirective, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc7.MatButton, ɵngcc8.MatIcon], pipes: [ɵngcc9.TranslatePipe], encapsulation: 2, data: { animation: [searchAnimation] } });
SearchTextInputComponent.ctorParameters = () => [
    { type: UserPreferencesService }
];
SearchTextInputComponent.propDecorators = {
    autocomplete: [{ type: Input }],
    expandable: [{ type: Input }],
    inputType: [{ type: Input }],
    liveSearchEnabled: [{ type: Input }],
    searchAutocomplete: [{ type: Input }],
    searchTerm: [{ type: Input }],
    debounceTime: [{ type: Input }],
    focusListener: [{ type: Input }],
    collapseOnSubmit: [{ type: Input }],
    defaultState: [{ type: Input }],
    searchChange: [{ type: Output }],
    submit: [{ type: Output }],
    selectResult: [{ type: Output }],
    reset: [{ type: Output }],
    searchInput: [{ type: ViewChild, args: ['searchInput', { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SearchTextInputComponent, [{
        type: Component,
        args: [{
                selector: 'adf-search-text-input',
                template: "<div class=\"adf-search-container\" [attr.state]=\"subscriptAnimationState.value\">\n    <div [@transitionMessages]=\"subscriptAnimationState\"\n         (@transitionMessages.done)=\"applySearchFocus($event)\">\n        <button mat-icon-button\n                *ngIf=\"expandable\"\n                id=\"adf-search-button\"\n                class=\"adf-search-button\"\n                [title]=\"'SEARCH.BUTTON.TOOLTIP' | translate\"\n                (click)=\"toggleSearchBar()\"\n                (keyup.enter)=\"toggleSearchBar()\">\n            <mat-icon [attr.aria-label]=\"'SEARCH.BUTTON.ARIA-LABEL' | translate\">search</mat-icon>\n        </button>\n        <mat-form-field class=\"adf-input-form-field-divider\">\n            <input matInput\n                   #searchInput\n                   [attr.aria-label]=\"'SEARCH.INPUT.ARIA-LABEL' | translate\"\n                   [attr.type]=\"inputType\"\n                   [autocomplete]=\"getAutoComplete()\"\n                   id=\"adf-control-input\"\n                   [(ngModel)]=\"searchTerm\"\n                   (focus)=\"activateToolbar()\"\n                   (blur)=\"onBlur($event)\"\n                   (keyup.escape)=\"toggleSearchBar()\"\n                   (keyup.arrowdown)=\"selectFirstResult($event)\"\n                   (ngModelChange)=\"inputChange($event)\"\n                   [searchAutocomplete]=\"searchAutocomplete ? searchAutocomplete : null\"\n                   (keyup.enter)=\"searchSubmit($event)\">\n        </mat-form-field>\n    </div>\n</div> ",
                animations: [searchAnimation],
                encapsulation: ViewEncapsulation.None,
                host: {
                    'class': 'adf-search-text-input'
                }
            }]
    }], function () { return [{ type: ɵngcc1.UserPreferencesService }]; }, { autocomplete: [{
            type: Input
        }], expandable: [{
            type: Input
        }], inputType: [{
            type: Input
        }], liveSearchEnabled: [{
            type: Input
        }], searchAutocomplete: [{
            type: Input
        }], searchTerm: [{
            type: Input
        }], debounceTime: [{
            type: Input
        }], collapseOnSubmit: [{
            type: Input
        }], defaultState: [{
            type: Input
        }], searchChange: [{
            type: Output
        }], submit: [{
            type: Output
        }], selectResult: [{
            type: Output
        }], reset: [{
            type: Output
        }], focusListener: [{
            type: Input
        }], searchInput: [{
            type: ViewChild,
            args: ['searchInput', { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXRleHQtaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS9zZWFyY2gtdGV4dC9zZWFyY2gtdGV4dC1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFhLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNwSSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFakUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMvQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM5RSxPQUFPLEVBQUUsbUJBQW1CLEVBQWtELE1BQU0sbUNBQW1DLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXeEgsTUFBTSxPQUFPLHdCQUF3QjtBQUFHLElBd0ZwQyxZQUNZLHNCQUE4QztBQUMzRCxRQURhLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7QUFDOUQsUUF0RkksaUJBQVksR0FBWSxLQUFLLENBQUM7QUFDbEMsUUFLSSxlQUFVLEdBQVksSUFBSSxDQUFDO0FBQy9CLFFBR0ksY0FBUyxHQUFXLE1BQU0sQ0FBQztBQUMvQixRQUdJLHNCQUFpQixHQUFZLElBQUksQ0FBQztBQUN0QyxR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UiwrQkFHRyxLQUFLO0FBQ1IsMkJBR0ksS0FBSztBQUNULDJCQU9HLE1BQU07QUFDVCxxQkFLRyxNQUFNO0FBQ1QsMkJBR0csTUFBTTtBQUNULG9CQUdHLE1BQU07QUFDVCwwQkFFRyxTQUFTLFNBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtBQUMxQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgVmlld0VuY2Fwc3VsYXRpb24sIENvbXBvbmVudCwgSW5wdXQsIE9uRGVzdHJveSwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgdGFrZVVudGlsLCBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XG5pbXBvcnQgeyBzZWFyY2hBbmltYXRpb24gfSBmcm9tICcuL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3VzZXItcHJlZmVyZW5jZXMuc2VydmljZSc7XG5pbXBvcnQgeyBTZWFyY2hUZXh0U3RhdGVFbnVtLCBTZWFyY2hBbmltYXRpb25TdGF0ZSwgU2VhcmNoQW5pbWF0aW9uRGlyZWN0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC10ZXh0LWlucHV0Lm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtc2VhcmNoLXRleHQtaW5wdXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtdGV4dC1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gICAgYW5pbWF0aW9uczogW3NlYXJjaEFuaW1hdGlvbl0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBob3N0OiB7XG4gICAgICAgICdjbGFzcyc6ICdhZGYtc2VhcmNoLXRleHQtaW5wdXQnXG4gICAgfVxufSlcbmV4cG9ydCBjbGFzcyBTZWFyY2hUZXh0SW5wdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgICAvKiogVG9nZ2xlcyBhdXRvLWNvbXBsZXRpb24gb2YgdGhlIHNlYXJjaCBpbnB1dCBmaWVsZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGF1dG9jb21wbGV0ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciB0byB1c2UgYW4gZXhwYW5kaW5nIHNlYXJjaCBjb250cm9sLiBJZiBmYWxzZVxuICAgICAqIHRoZW4gYSByZWd1bGFyIGlucHV0IGlzIHVzZWQuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBleHBhbmRhYmxlOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUeXBlIG9mIHRoZSBpbnB1dCBmaWVsZCB0byByZW5kZXIsIGUuZy4gXCJzZWFyY2hcIiBvciBcInRleHRcIiAoZGVmYXVsdCkuICovXG4gICAgQElucHV0KClcbiAgICBpbnB1dFR5cGU6IHN0cmluZyA9ICd0ZXh0JztcblxuICAgIC8qKiBUb2dnbGVzIFwiZmluZC1hcy15b3UtdHlwZVwiIHN1Z2dlc3Rpb25zIGZvciBwb3NzaWJsZSBtYXRjaGVzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbGl2ZVNlYXJjaEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFRyaWdnZXIgYXV0b2NvbXBsZXRlIHJlc3VsdHMgb24gaW5wdXQgY2hhbmdlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2VhcmNoQXV0b2NvbXBsZXRlOiBhbnkgPSBmYWxzZTtcblxuICAgIC8qKiBTZWFyY2ggdGVybSBwcmVzZWxlY3RlZCAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2VhcmNoVGVybTogc3RyaW5nID0gJyc7XG5cbiAgICAvKiogRGVib3VuY2UgdGltZSBpbiBtaWxsaXNlY29uZHMuICovXG4gICAgQElucHV0KClcbiAgICBkZWJvdW5jZVRpbWU6IG51bWJlciA9IDA7XG5cbiAgICAgLyoqIExpc3RlbmVyIGZvciByZXN1bHRzLWxpc3QgZXZlbnRzIChmb2N1cywgYmx1ciBhbmQgZm9jdXNvdXQpLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZm9jdXNMaXN0ZW5lcjogT2JzZXJ2YWJsZTxGb2N1c0V2ZW50PjtcblxuICAgIC8qKiBDb2xsYXBzZSBzZWFyY2ggYmFyIG9uIHN1Ym1pdC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGNvbGxhcHNlT25TdWJtaXQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIERlZmF1bHQgc3RhdGUgZXhwYW5kZWQgb3IgQ29sbGFwc2VkLiAqL1xuICAgICBASW5wdXQoKVxuICAgIGRlZmF1bHRTdGF0ZTogU2VhcmNoVGV4dFN0YXRlRW51bSA9IFNlYXJjaFRleHRTdGF0ZUVudW0uY29sbGFwc2VkO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgc2VhcmNoIHRlcm0gaXMgY2hhbmdlZC4gVGhlIHNlYXJjaCB0ZXJtIGlzIHByb3ZpZGVkXG4gICAgICogaW4gdGhlICd2YWx1ZScgcHJvcGVydHkgb2YgdGhlIHJldHVybmVkIG9iamVjdC4gIElmIHRoZSB0ZXJtIGlzIGxlc3NcbiAgICAgKiB0aGFuIHRocmVlIGNoYXJhY3RlcnMgaW4gbGVuZ3RoIHRoZW4gaXQgaXMgdHJ1bmNhdGVkIHRvIGFuIGVtcHR5XG4gICAgICogc3RyaW5nLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNlYXJjaENoYW5nZTogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBzZWFyY2ggaXMgc3VibWl0dGVkIGJ5IHByZXNzaW5nIHRoZSBFTlRFUiBrZXkuXG4gICAgICogVGhlIHNlYXJjaCB0ZXJtIGlzIHByb3ZpZGVkIGFzIHRoZSB2YWx1ZSBvZiB0aGUgZXZlbnQuXG4gICAgICovXG4gICAgQE91dHB1dCgpXG4gICAgc3VibWl0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIC8qKiAgRW1pdHRlZCB3aGVuIHRoZSByZXN1bHQgbGlzdCBpcyBzZWxlY3RlZCAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNlbGVjdFJlc3VsdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAvKiogIEVtaXR0ZWQgd2hlbiB0aGUgcmVzdWx0IGxpc3QgaXMgcmVzZXQgKi9cbiAgICBAT3V0cHV0KClcbiAgICByZXNldDogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQFZpZXdDaGlsZCgnc2VhcmNoSW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIHNlYXJjaElucHV0OiBFbGVtZW50UmVmO1xuXG4gICAgc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGU6IGFueTtcblxuICAgIGFuaW1hdGlvblN0YXRlczogU2VhcmNoQW5pbWF0aW9uRGlyZWN0aW9uID0ge1xuICAgICAgICBsdHIgOiB7XG4gICAgICAgICAgICBhY3RpdmU6IHsgdmFsdWU6ICdhY3RpdmUnLCBwYXJhbXM6IHsgJ21hcmdpbi1sZWZ0JzogMTMgfSB9LFxuICAgICAgICAgICAgaW5hY3RpdmU6IHsgdmFsdWU6ICdpbmFjdGl2ZScsIHBhcmFtczogeyAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoODIlKScgfSB9XG4gICAgICAgIH0sXG4gICAgICAgIHJ0bDoge1xuICAgICAgICAgICAgYWN0aXZlOiAgeyB2YWx1ZTogJ2FjdGl2ZScsIHBhcmFtczogeyAnbWFyZ2luLXJpZ2h0JzogMTMgfSB9LFxuICAgICAgICAgICAgaW5hY3RpdmU6IHsgdmFsdWU6ICdpbmFjdGl2ZScsIHBhcmFtczogeyAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoLTgyJSknIH0gfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgZGlyID0gJ2x0cic7XG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgICBwcml2YXRlIHRvZ2dsZVNlYXJjaCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgICBwcml2YXRlIGZvY3VzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gICAgcHJpdmF0ZSB2YWx1ZUNoYW5nZSA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgcHJpdmF0ZSB1c2VyUHJlZmVyZW5jZXNTZXJ2aWNlOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMjAwKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhwYW5kYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlID0gdGhpcy50b2dnbGVBbmltYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGUudmFsdWUgPT09ICdpbmFjdGl2ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldC5lbWl0KHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmlkID09PSB0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMudXNlclByZWZlcmVuY2VzU2VydmljZVxuICAgICAgICAgICAgLnNlbGVjdCgndGV4dE9yaWVudGF0aW9uJylcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoZGlyZWN0aW9uOiBEaXJlY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpciA9IGRpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlID0gdGhpcy5nZXREZWZhdWx0U3RhdGUodGhpcy5kaXIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRBbmltYXRpb25TdGF0ZSA9IHRoaXMuZ2V0RGVmYXVsdFN0YXRlKHRoaXMuZGlyKTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZUNoYW5nZUhhbmRsZXIoKTtcbiAgICAgICAgdGhpcy5zZXR1cEZvY3VzRXZlbnRIYW5kbGVycygpO1xuICAgIH1cblxuICAgIGFwcGx5U2VhcmNoRm9jdXMoYW5pbWF0aW9uRG9uZUV2ZW50KSB7XG4gICAgICAgIGlmIChhbmltYXRpb25Eb25lRXZlbnQudG9TdGF0ZSA9PT0gJ2FjdGl2ZScgJiYgdGhpcy5kZWZhdWx0U3RhdGUgIT09IFNlYXJjaFRleHRTdGF0ZUVudW0uZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0QXV0b0NvbXBsZXRlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmF1dG9jb21wbGV0ZSA/ICdvbicgOiAnb2ZmJztcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZUFuaW1hdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlyID09PSAnbHRyJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGUudmFsdWUgPT09ICdpbmFjdGl2ZScgP1xuICAgICAgICAgICAgICAgIHsgdmFsdWU6ICdhY3RpdmUnLCBwYXJhbXM6IHsgJ21hcmdpbi1sZWZ0JzogMTMgfSB9IDpcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAnaW5hY3RpdmUnLCBwYXJhbXM6IHsgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKDgyJSknIH0gfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlLnZhbHVlID09PSAnaW5hY3RpdmUnID9cbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAnYWN0aXZlJywgcGFyYW1zOiB7ICdtYXJnaW4tcmlnaHQnOiAxMyB9IH0gOlxuICAgICAgICAgICAgICAgIHsgdmFsdWU6ICdpbmFjdGl2ZScsIHBhcmFtczogeyAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoLTgyJSknIH0gfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFN0YXRlKGRpcjogc3RyaW5nKTogU2VhcmNoQW5pbWF0aW9uU3RhdGUge1xuICAgICAgICBpZiAodGhpcy5kaXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFuaW1hdGlvblN0YXRlKGRpcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0aW9uU3RhdGVzLmx0ci5pbmFjdGl2ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEFuaW1hdGlvblN0YXRlKGRpcjogc3RyaW5nKTogU2VhcmNoQW5pbWF0aW9uU3RhdGUge1xuICAgICAgICBpZiAoIHRoaXMuZXhwYW5kYWJsZSAmJiB0aGlzLmRlZmF1bHRTdGF0ZSA9PT0gU2VhcmNoVGV4dFN0YXRlRW51bS5leHBhbmRlZCApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvblN0YXRlc1tkaXJdLmFjdGl2ZTtcbiAgICAgICAgfSBlbHNlIGlmICggdGhpcy5leHBhbmRhYmxlICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0aW9uU3RhdGVzW2Rpcl0uaW5hY3RpdmU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogJ25vLWFuaW1hdGlvbicgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc2V0dXBGb2N1c0V2ZW50SGFuZGxlcnMoKSB7XG4gICAgICAgIGlmICggdGhpcy5mb2N1c0xpc3RlbmVyICkge1xuICAgICAgICAgICAgY29uc3QgZm9jdXNFdmVudHM6IE9ic2VydmFibGU8Rm9jdXNFdmVudD4gPSB0aGlzLmZvY3VzTGlzdGVuZXJcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKCgkZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1NlYXJjaEJhckFjdGl2ZSgpICYmICgkZXZlbnQudHlwZSA9PT0gJ2JsdXInIHx8ICRldmVudC50eXBlID09PSAnZm9jdXNvdXQnIHx8ICRldmVudC50eXBlID09PSAnZm9jdXMnKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdGhpcy5mb2N1c1N1YnNjcmlwdGlvbiA9IGZvY3VzRXZlbnRzLnN1YnNjcmliZSggKGV2ZW50OiBGb2N1c0V2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCBldmVudC50eXBlID09PSAnZm9jdXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoQmFyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFZhbHVlQ2hhbmdlSGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5waXBlKFxuICAgICAgICAgICAgZGVib3VuY2VUaW1lKHRoaXMuZGVib3VuY2VUaW1lKSxcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICAgICkuc3Vic2NyaWJlKCAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hDaGFuZ2UuZW1pdCh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNlbGVjdEZpcnN0UmVzdWx0KCRldmVudCkge1xuICAgICAgICB0aGlzLnNlbGVjdFJlc3VsdC5lbWl0KCRldmVudCk7XG4gICAgfVxuXG4gICAgb25CbHVyKCRldmVudCkge1xuICAgICAgICBpZiAoISRldmVudC5yZWxhdGVkVGFyZ2V0ICYmIHRoaXMuZGVmYXVsdFN0YXRlID09PSBTZWFyY2hUZXh0U3RhdGVFbnVtLmNvbGxhcHNlZCkge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hUZXJtID0gJyc7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlID0gdGhpcy5hbmltYXRpb25TdGF0ZXNbdGhpcy5kaXJdLmluYWN0aXZlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5wdXRDaGFuZ2UoJGV2ZW50OiBhbnkpIHtcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5uZXh0KCRldmVudCk7XG4gICAgfVxuXG4gICAgdG9nZ2xlU2VhcmNoQmFyKCkge1xuICAgICAgICBpZiAodGhpcy50b2dnbGVTZWFyY2gpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoLm5leHQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlYXJjaFN1Ym1pdChldmVudDogYW55KSB7XG4gICAgICAgIHRoaXMuc3VibWl0LmVtaXQoZXZlbnQpO1xuICAgICAgICBpZiAodGhpcy5jb2xsYXBzZU9uU3VibWl0KSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaEJhcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYWN0aXZhdGVUb29sYmFyKCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNTZWFyY2hCYXJBY3RpdmUoKSkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVTZWFyY2hCYXIoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNTZWFyY2hCYXJBY3RpdmUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlLnZhbHVlID09PSAnYWN0aXZlJyAmJiB0aGlzLmxpdmVTZWFyY2hFbmFibGVkO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy50b2dnbGVTZWFyY2gpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5mb2N1c1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5mb2N1c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5mb2N1c1N1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmZvY3VzTGlzdGVuZXIgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cbn1cbiJdfQ==